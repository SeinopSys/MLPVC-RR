{"version":3,"sources":["jquery.uploadzone.js"],"names":["defaults","requestKey","title","accept","target","helper","$","fn","uploadZone","opt","extend","$this","this","first","$input","mk","attr","type","name","$helper","addClass","on","_","path","Dialog","close","prev","children","fadeTo","e","stopPropagation","preventDefault","files","originalEvent","dataTransfer","File","trigger","removeClass","fd","FormData","append","getCSRFToken","ajaxOpts","url","contentType","processData","cache","data","success","mkAjaxHandler","removeAttr","val","status","fail","message","error","xhr","xhrobj","ajaxSettings","upload","addEventListener","event","lengthComputable","complete","loaded","position","total","Math","round","ajax","jQuery"],"mappings":"CACA,WACC,GAAIA,IACHC,WAAY,OACZC,MAAO,eACPC,OAAQ,UACRC,OAAQ,GACRC,QAAQ,EAGTC,GAAEC,GAAGC,WAAa,SAASC,GAC1BA,EAAMH,EAAEI,QAAO,KAAQV,EAASS,EAEhC,IAAIP,GAAQO,EAAIP,MACfS,EAAQL,EAAEM,MAAMC,QAChBC,EAASR,EAAES,GAAG,SAASC,MACtBC,KAAQ,OACRC,KAAQT,EAAIR,WACZE,OAAUM,EAAIN,QAGhB,IAAIM,EAAIJ,OAAQ,GAAIc,GAAUb,EAAES,GAAG,OAAOK,SAAS,SAqEnD,OAnEAN,GAAOO,GAAG,YAAY,SAASC,EAAGC,GACjCjB,EAAEkB,OAAOC,MAAM,WACdX,EAAOY,OAAOV,KAAK,OAAQO,GAAMI,SAAS,OAAOC,OAAO,IAAI,EAAE,WAC7D,GAAIjB,GAAQL,EAAEM,KACdD,GAAMK,KAAK,MAAMO,GAAMF,GAAG,OAAO,WAChCV,EAAMiB,OAAO,IAAI,WAKrBd,EAAOO,GAAG,sBAAsB,SAASQ,GACxCA,EAAEC,kBACFD,EAAEE,iBAEFpB,EAAiB,cAAXkB,EAAEZ,KAAuB,WAAa,eAAe,UAE5DH,EAAOO,GAAG,cAAc,SAASQ,GAChC,GAAIG,GAAQH,EAAEzB,OAAO4B,OAASH,EAAEI,cAAcC,aAAaF,KAE3D,IAAwB,mBAAbA,GAAM,MAAwBA,EAAM,YAAcG,OAC5D,OAAO,CAERxB,GAAMyB,QAAQ,kBAAkBC,YAAY,QAAQjB,SAAS,YAE7D,IAAIkB,GAAK,GAAIC,SACbD,GAAGE,OAAO,SAAUR,EAAM,IAC1BM,EAAGE,OAAO,aAAclC,EAAEmC,eAE1B,IAAIC,IACHC,IAAKlC,EAAIL,OACTa,KAAM,OACN2B,aAAa,EACbC,aAAa,EACbC,OAAO,EACPC,KAAMT,EACNU,QAAS1C,EAAE2C,cAAc,WACxBtC,EAAM0B,YAAY,aAClBlB,EAAQ+B,WAAW,iBACnBpC,EAAOqC,IAAI,IACPvC,KAAKwC,OACRtC,EAAOsB,QAAQ,aAAcxB,KAAKW,OAC9BjB,EAAEkB,OAAO6B,KAAKnD,EAAMU,KAAK0C,WAE/BC,MAAO,SAASC,GACI,MAAfA,EAAIJ,QAAiC,MAAfI,EAAIJ,QAC9B9C,EAAEkB,OAAO6B,KAAKnD,EAAM,uBAAuBsD,EAAIJ,OAAO,MAGpD3C,GAAIJ,SAAQqC,EAAc,IAAI,WACjC,GAAIe,GAASnD,EAAEoD,aAAaF,KAU5B,OATIC,GAAOE,QACVF,EAAOE,OAAOC,iBAAiB,WAAY,SAAUC,GACpD,IAAKA,EAAMC,iBAAkB,OAAO,CAEpC,IAAIC,GAAWF,EAAMG,QAAUH,EAAMI,SACpCC,EAAQL,EAAMK,KACf/C,GAAQH,KAAK,gBAAiBmD,KAAKC,MAAML,EAAWG,EAAQ,QAC1D,GAEGT,IAERnD,EAAE+D,KAAK3B,KAGR/B,EAAM6B,OAAO1B,GACTL,EAAIJ,QAAQM,EAAM6B,OAAOrB,GAEtBR,IAEN2D","file":"jquery.uploadzone.min.js","sourcesContent":["/* Image upload plugin w/ drag'n'drop support | by @DJDavid98 | for gh:ponydevs/MLPVC-RR */\r\n(function(){\r\n\tvar defaults = {\r\n\t\trequestKey: 'file',\r\n\t\ttitle: 'Image upload',\r\n\t\taccept: 'image/*',\r\n\t\ttarget: '',\r\n\t\thelper: true,\r\n\t};\r\n\r\n\t$.fn.uploadZone = function(opt){\r\n\t\topt = $.extend(true,{},defaults,opt);\r\n\r\n\t\tvar title = opt.title,\r\n\t\t\t$this = $(this).first(),\r\n\t\t\t$input = $.mk('input').attr({\r\n\t\t\t\t'type': 'file',\r\n\t\t\t\t'name': opt.requestKey,\r\n\t\t\t\t'accept': opt.accept,\r\n\t\t\t});\r\n\r\n\t\tif (opt.helper) var $helper = $.mk('div').addClass('helper');\r\n\r\n\t\t$input.on('set-image',function(_, path){\r\n\t\t\t$.Dialog.close(function(){\r\n\t\t\t\t$input.prev().attr('href', path).children('img').fadeTo(200,0,function(){\r\n\t\t\t\t\tvar $this = $(this);\r\n\t\t\t\t\t$this.attr('src',path).on('load',function(){\r\n\t\t\t\t\t\t$this.fadeTo(200,1);\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t});\r\n\t\t$input.on('dragenter dragleave',function(e){\r\n\t\t\te.stopPropagation();\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\t$this[e.type === 'dragenter' ? 'addClass' : 'removeClass']('drop');\r\n\t\t});\r\n\t\t$input.on('change drop',function(e){\r\n\t\t\tvar files = e.target.files || e.originalEvent.dataTransfer.files;\r\n\r\n\t\t\tif (typeof files[0] === 'undefined' || !(files[0] instanceof File))\r\n\t\t\t\treturn true;\r\n\r\n\t\t\t$this.trigger('uz-uploadstart').removeClass('drop').addClass('uploading');\r\n\r\n\t\t\tvar fd = new FormData();\r\n\t\t\tfd.append('sprite', files[0]);\r\n\t\t\tfd.append('CSRF_TOKEN', $.getCSRFToken());\r\n\r\n\t\t\tvar ajaxOpts = {\r\n\t\t\t\turl: opt.target,\r\n\t\t\t\ttype: \"POST\",\r\n\t\t\t\tcontentType: false,\r\n\t\t\t\tprocessData: false,\r\n\t\t\t\tcache: false,\r\n\t\t\t\tdata: fd,\r\n\t\t\t\tsuccess: $.mkAjaxHandler(function(){\r\n\t\t\t\t\t$this.removeClass('uploading');\r\n\t\t\t\t\t$helper.removeAttr('data-progress');\r\n\t\t\t\t\t$input.val('');\r\n\t\t\t\t\tif (this.status)\r\n\t\t\t\t\t\t$input.trigger('set-image', [this.path]);\r\n\t\t\t\t\telse $.Dialog.fail(title,this.message);\r\n\t\t\t\t}),\r\n\t\t\t\terror: function(xhr){\r\n\t\t\t\t\tif (xhr.status === 500 || xhr.status === 401) return;\r\n\t\t\t\t\t$.Dialog.fail(title,'Upload failed (HTTP '+xhr.status+')');\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tif (opt.helper) ajaxOpts['xhr'] = function () {\r\n\t\t\t\tvar xhrobj = $.ajaxSettings.xhr();\r\n\t\t\t\tif (xhrobj.upload)\r\n\t\t\t\t\txhrobj.upload.addEventListener('progress', function (event) {\r\n\t\t\t\t\t\tif (!event.lengthComputable) return true;\r\n\r\n\t\t\t\t\t\tvar complete = event.loaded || event.position,\r\n\t\t\t\t\t\t\ttotal = event.total;\r\n\t\t\t\t\t\t$helper.attr('data-progress', Math.round(complete / total * 100));\r\n\t\t\t\t\t}, false);\r\n\r\n\t\t\t\treturn xhrobj;\r\n\t\t\t};\r\n\t\t\t$.ajax(ajaxOpts);\r\n\t\t});\r\n\r\n\t\t$this.append($input);\r\n\t\tif (opt.helper) $this.append($helper);\r\n\r\n\t\treturn $this;\r\n\t};\r\n})(jQuery);\r\n"],"sourceRoot":"/source/"}