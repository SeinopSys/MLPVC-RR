{"version":3,"sources":["episode.js"],"names":["DocReady","push","Bind","$li","id","type","children","off","on","$this","$","this","title","Dialog","wait","post","mkAjaxHandler","status","close","nextAll","remove","btnhtml","insertAfter","fail","message","e","preventDefault","handlehash","hash","history","replaceState","href","$actions","find","filter","confirm","sure","parent","prev","addBack","appendTo","request","$form","$ErrorNotice","hide","deviation","val","handleError","html","show","$w","trigger","attr","length","Error","data","updateSection","call","callback","success","SEASON","EPISODE","$unfinishBtn","deleteOnly","hasClass","Type","charAt","toUpperCase","substring","$unbind","prepend","first","checked","css","append","unbind","prop","$btn","closest","mk","class","$button","parents","_split","split","postdata","$Form","text","maxlength","pattern","name","required","$label","$type","label","value","$group","getTimeValue","el","Date","getTime","sort","a","b","dis","replace","$section","$newChilds","render","empty","rebindHandlers","formBind","window","updateTimes","location","reload","hlhash","$anchor","removeClass","addClass","setTimeout","$body","animate","scrollTop","offset","top","$navbar","outerHeight","idstr","placeholder","$yt","$dm","yt","dm","center","$epSection","$content","epsection","insertBefore","$voting","$voteButton","$both","siblings","epid","vote","newhtml","diff","past","removeData","fn","each","parseInt","fluidbox","immediateOpen","imgCheckDisabler","disable","prevurl","$formImgInput","samevalue","trim","$formImgCheck","removeAttr","outgoing","test","$formImgPreview","$formDescInput","$formTitleInput","$notice","noticeHTML","$previewIMG","Image","is","focus","CHECK_BTN","url","image_url","load","attempts","preview","screwchanges","sanityCheck","triggerHandler","indexOf","mkData","what","episode","season","$imgs","total","loaded","$progress","max","display","width","marginTop","last","imagesLoaded","progress","_","img","isLoaded","always"],"mappings":"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","file":"episode.min.js","sourcesContent":["DocReady.push(function Episode(){\r\n\tvar SEASON = window.SEASON,\r\n\t\tEPISODE = window.EPISODE,\r\n\t\tidstr = 'S'+SEASON+'E'+EPISODE;\r\n\r\n\t$('#video').on('click',function(){\r\n\t\tvar title = 'Video links';\r\n\t\t$.Dialog.wait(title, 'Requesting links from the server');\r\n\r\n\t\t$.post('/episode/getvideos/'+idstr,$.mkAjaxHandler(function(){\r\n\t\t\tvar data = this;\r\n\r\n\t\t\tif (!data.status) $.Dialog.fail(title, data.message);\r\n\r\n\t\t\tvar $form = $.mk('form').attr('id','vidlinks').append(\r\n\t\t\t\t$.mk('p').addClass('align-center').text('Enter vido links below, leave any input blank to remove that video from the episode page.'),\r\n\t\t\t\t$.mk('input').attr({name:'yt',placeholder:'YouTube'}),\r\n\t\t\t\t$.mk('input').attr({name:'dm',placeholder:'Dailymotion'})\r\n\t\t\t);\r\n\t\t\t$.Dialog.request(title, $form,'vidlinks','Save',function($form){\r\n\t\t\t\tvar $yt = $form.find('[name=yt]'),\r\n\t\t\t\t\t$dm = $form.find('[name=dm]');\r\n\t\t\t\tif (data.yt) $yt.val(data.yt);\r\n\t\t\t\tif (data.dm) $dm.val(data.dm);\r\n\t\t\t\tif (data.yt || data.dm){\r\n\t\t\t\t\t$form.find('p').show();\r\n\t\t\t\t\t$.Dialog.center();\r\n\t\t\t\t}\r\n\t\t\t\t$form.on('submit',function(e){\r\n\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t$.Dialog.wait(title, 'Saving links');\r\n\t\t\t\t\t\r\n\t\t\t\t\t$.post('/episode/setvideos/'+idstr,{yt: $yt.val(), dm: $dm.val()},$.mkAjaxHandler(function(){\r\n\t\t\t\t\t\tif (this.status){\r\n\t\t\t\t\t\t\tvar $epSection = $content.children('section.episode');\r\n\t\t\t\t\t\t\tif (this.epsection){\r\n\t\t\t\t\t\t\t\tif (!$epSection.length)\r\n\t\t\t\t\t\t\t\t\t$epSection = $.mk('section')\r\n\t\t\t\t\t\t\t\t\t\t.addClass('episode')\r\n\t\t\t\t\t\t\t\t\t\t.insertBefore($content.children('section').first());\r\n\t\t\t\t\t\t\t\t$epSection.html($(this.epsection).filter('section').html());\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse if ($epSection.length) $epSection.remove();\r\n\t\t\t\t\t\t\t$.Dialog.close();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse $.Dialog.fail(title, this.message);\r\n\t\t\t\t\t}));\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}));\r\n\t});\r\n\r\n\tvar $voting = $('#voting'),\r\n\t\t$voteButton = $voting.find('button');\r\n\t$voting.on('click','button',function(e){\r\n\t\te.preventDefault();\r\n\t\tvar $this = $(this),\r\n\t\t\t$both = $this.siblings('button').addBack(),\r\n\t\t\tvalue = $this.hasClass('green') ? 1 : -1,\r\n\t\t\tepid = ''+idstr,\r\n\t\t\ttitle = (value > 0?'Up':'Down')+'voting '+epid;\r\n\r\n\t\t$both.attr('disabled', true);\r\n\r\n\t\t$.post('/episode/vote/'+epid,{vote:value},$.mkAjaxHandler(function(){\r\n\t\t\tif (this.status){\r\n\t\t\t\t$.Dialog.close();\r\n\t\t\t\tvar $section = $this.closest('section');\r\n\t\t\t\t$section.children('h2').nextAll().remove();\r\n\t\t\t\t$section.append(this.newhtml);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t$.Dialog.fail(title,this.message);\r\n\t\t\t\t$both.attr('disabled', false);\r\n\t\t\t}\r\n\t\t}));\r\n\t});\r\n\r\n\t$voting.find('time').data('dyntime-beforeupdate',function(diff){\r\n\t\tif (diff.past !== true) return;\r\n\r\n\t\tif (!$voteButton.length){\r\n\t\t\t$.post('/episode/vote/'+idstr+'?html',$.mkAjaxHandler(function(){\r\n\t\t\t\tif (this.status){\r\n\t\t\t\t\t$voting.children('h2').nextAll().remove();\r\n\t\t\t\t\t$voting.append(this.html);\r\n\t\t\t\t}\r\n\t\t\t\telse $.Dialog.fail('Display voting buttons',this.message);\r\n\t\t\t}));\r\n\t\t\t$(this).removeData('dyntime-beforeupdate');\r\n\t\t\treturn false;\r\n\t\t}\r\n\t});\r\n\r\n\t$.fn.rebindHandlers = function(){\r\n\t\tvar $this = $(this);\r\n\t\t$this.find('li[id]').each(function(){\r\n\t\t\tvar $li = $(this),\r\n\t\t\t\tid = parseInt($li.attr('id').replace(/\\D/g,'')),\r\n\t\t\t\ttype = $li.closest('section[id]').attr('id');\r\n\t\t\t\t\r\n\t\t\t$('section .unfinished .screencap > a')\r\n\t\t\t\t.fluidbox({ immediateOpen: true })\r\n\t\t\t\t.on('openstart',function(){\r\n\t\t\t\t\t$body.addClass('no-distractions');\r\n\t\t\t\t})\r\n\t\t\t\t.on('closestart', function() {\r\n\t\t\t\t\t$body.removeClass('no-distractions');\r\n\t\t\t\t});\r\n\r\n\t\t\tBind($li, id, type);\r\n\t\t});\r\n\t\treturn $this;\r\n\t};\r\n\t$('#requests, #reservations').rebindHandlers();\r\n\tfunction Bind($li, id, type){\r\n\t\t$li.children('button.reserve-request').off('click').on('click',function(){\r\n\t\t\tvar $this = $(this),\r\n\t\t\t\ttitle = 'Reserving request';\r\n\r\n\t\t\t$.Dialog.wait(title,'Sending reservation to the server');\r\n\r\n\t\t\t$.post(\"/reserving/request/\"+id,$.mkAjaxHandler(function(){\r\n\t\t\t\tif (this.status){\r\n\t\t\t\t\t$.Dialog.close();\r\n\t\t\t\t\t$this.nextAll().remove();\r\n\t\t\t\t\t$(this.btnhtml).insertAfter($this);\r\n\t\t\t\t\tBind($li, id, type);\r\n\t\t\t\t\t$this.remove();\r\n\t\t\t\t}\r\n\t\t\t\telse $.Dialog.fail(title,this.message);\r\n\t\t\t}));\r\n\t\t});\r\n\t\t$li.children('em').children('a').on('click',function(e){\r\n\t\t\te.preventDefault();\r\n\t\t\thandlehash(this.hash);\r\n\t\t\thistory.replaceState({},'',this.href);\r\n\t\t});\r\n\t\tvar $actions = $li.find('.actions').children();\r\n\t\t$actions.filter('.cancel').off('click').on('click',function(){\r\n\t\t\tvar $this = $(this),\r\n\t\t\t\ttitle = 'Cancel reservation';\r\n\r\n\t\t\t$.Dialog.confirm(title,'Are you sure you want to cancel this reservation?',function(sure){\r\n\t\t\t\tif (!sure) return;\r\n\r\n\t\t\t\t$.Dialog.wait(title,'Cancelling reservation');\r\n\r\n\t\t\t\t$.post('/reserving/'+type+'/'+id+'?cancel',$.mkAjaxHandler(function(){\r\n\t\t\t\t\tif (this.status){\r\n\t\t\t\t\t\t$.Dialog.close();\r\n\t\t\t\t\t\tif (this.remove === true) return $li.remove();\r\n\t\t\t\t\t\t$this.parent().prev().nextAll().addBack().remove();\r\n\t\t\t\t\t\t$(this.btnhtml).appendTo($li);\r\n\r\n\t\t\t\t\t\tBind($li, id, type);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse $.Dialog.fail(title,this.message);\r\n\t\t\t\t}));\r\n\t\t\t});\r\n\t\t});\r\n\t\t$actions.filter('.finish').off('click').on('click',function(){\r\n\t\t\tvar title = 'Finish reservation';\r\n\r\n\t\t\t$.Dialog.request(title,'<form id=\"finish-res\"><div class=\"notice fail\"><label>Error</label><p></p></div><input type=\"text\" name=\"deviation\" placeholder=\"Deviation URL\"></form>','finish-res','Finish',function(){\r\n\t\t\t\tvar $form = $('#finish-res'),\r\n\t\t\t\t\t$ErrorNotice = $form.find('.notice p');\r\n\t\t\t\t$ErrorNotice.parent().hide();\r\n\t\t\t\t$form.on('submit',function(e){\r\n\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\tvar deviation = $form.find('[name=deviation]').val(),\r\n\t\t\t\t\t\thandleError = function(e){\r\n\t\t\t\t\t\t\t$ErrorNotice.html(e.message).parent().show();\r\n\t\t\t\t\t\t\t$w.trigger('resize');\r\n\t\t\t\t\t\t\t$form.find('input').attr('disabled', false);\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tif (typeof deviation !== 'string' || deviation.length === 0)\r\n\t\t\t\t\t\t\tthrow new Error('Please enter a deviation URL');\r\n\r\n\t\t\t\t\t\t$.post('/reserving/'+type+'/'+id+'?finish',{deviation:deviation},$.mkAjaxHandler(function(){\r\n\t\t\t\t\t\t\tvar data = this;\r\n\t\t\t\t\t\t\tif (data.status) updateSection.call({callback:function(){\r\n\t\t\t\t\t\t\t\tif (typeof data.message === 'string')\r\n\t\t\t\t\t\t\t\t\t$.Dialog.success(title,data.message,true);\r\n\t\t\t\t\t\t\t\telse $.Dialog.close();\r\n\t\t\t\t\t\t\t}}, type, SEASON, EPISODE);\r\n\t\t\t\t\t\t\telse handleError(data);\r\n\t\t\t\t\t\t}));\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcatch(e){ handleError(e) }\r\n\t\t\t\t});\r\n\t\t\t})\r\n\t\t});\r\n\t\t$actions.filter('.unfinish').off('click').on('click',function(){\r\n\t\t\tvar $unfinishBtn = $(this),\r\n\t\t\t\tdeleteOnly = $unfinishBtn.hasClass('delete-only'),\r\n\t\t\t\ttitle = (deleteOnly?'Delete':'Un-finish')+' reservation',\r\n\t\t\t\tType = type.charAt(0).toUpperCase()+type.substring(1);\r\n\r\n\t\t\t$.Dialog.request(title,'<form id=\"unbind-check\"><p>Are you sure you want to '+(deleteOnly?'delete this reservation':'mark this reservation as unfinished')+'?</p><hr><label><input type=\"checkbox\" name=\"unbind\"> Unbind reservation from user</label></form>','unbind-check','Un-finish',function(){\r\n\t\t\t\tvar $form = $('#unbind-check'),\r\n\t\t\t\t\t$unbind = $form.find('[name=unbind]');\r\n\r\n\t\t\t\tif (!deleteOnly)\r\n\t\t\t\t\t$form.prepend('<div class=\"notice info\">By removing the \"finished\" flag, the deviation will be moved back to the \"List of '+Type+'\" section</div>');\r\n\r\n\t\t\t\tif (type === 'reservations'){\r\n\t\t\t\t\t$unbind.on('click',function(){\r\n\t\t\t\t\t\t$('#dialogButtons').children().first().val(this.checked ? 'Delete' : 'Un-finish')\r\n\t\t\t\t\t});\r\n\t\t\t\t\tif (deleteOnly)\r\n\t\t\t\t\t\t$unbind.trigger('click').off('click').on('click keydown touchstart', function(){return false}).css('pointer-events','none').parent().hide();\r\n\t\t\t\t\t$form.append('<div class=\"notice warn\">Because this '+(!deleteOnly?'is a reservation, unbinding it from the user will <strong>delete</strong> it permanently.':'reservation was added directly, it cannot be marked un-finished, only deleted.')+'</div>');\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t\t$form.append('<div class=\"notice info\">If this is checked, any user will be able to reserve this request again afterwards. If left unchecked, only the current reserver <em>(and Vector Inspectors)</em> will be able to mark it as finished until the reservation is cancelled.</div>');\r\n\t\t\t\t$w.trigger('resize');\r\n\t\t\t\t$form.on('submit',function(e){\r\n\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\tvar unbind = $unbind.prop('checked');\r\n\r\n\t\t\t\t\t$.Dialog.wait(title,'Removing \"finished\" flag'+(unbind?' & unbinding from user':''));\r\n\r\n\t\t\t\t\t$.post('/reserving/'+type+'/'+id+'?unfinish'+(unbind?'&unbind':''),$.mkAjaxHandler(function(){\r\n\t\t\t\t\t\tif (this.status){\r\n\t\t\t\t\t\t\t$.Dialog.success(title, typeof this.message !== 'undefined' ? this.message : '\"finished\" flag removed successfully');\r\n\t\t\t\t\t\t\tupdateSection(type, SEASON, EPISODE);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse $.Dialog.fail(title,this.message);\r\n\t\t\t\t\t}));\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t});\r\n\t\t$actions.filter('.lock').off('click').on('click',function(){\r\n\t\t\tvar title = 'Approve post',\r\n\t\t\t\t$btn = $(this);\r\n\r\n\t\t\t$.Dialog.confirm(title, \"By approving this post, you can prevent any additional modifications, such as un-finishing. This mark is <strong>permanent</strong>, and can only be removed by the developer. <strong>This should be used when the image has been added to the group gallery.</strong><br><br>After approving the post, it'll count towards the user's badges/achievements/points/whatever (once implemented) and the image will receive a small green checkmark on the site. <strong>This action will be logged.</strong><br><br>Are you <em>absolutely</em> sure you want to approve this post, and with that, prevent futher actions?\",['Approve it','Nevermind'],function(sure){\r\n\t\t\t\tif (!sure) return;\r\n\r\n\t\t\t\t$.Dialog.wait(title, 'Approving post');\r\n\r\n\t\t\t\t$.post('/reserving/'+type+'/'+id+'?lock', $.mkAjaxHandler(function(){\r\n\t\t\t\t\tif (!this.status) return $.Dialog.fail(title, data.message);\r\n\r\n\t\t\t\t\t$btn.closest('li').children('.image').children('a').append(\r\n\t\t\t\t\t\t$.mk('span').attr({\r\n\t\t\t\t\t\t\t'class': 'typcn typcn-tick',\r\n\t\t\t\t\t\t\ttitle: \"This submission has been accepted into the group gallery\"\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t);\r\n\t\t\t\t\t$btn.parent().remove();\r\n\r\n\t\t\t\t\tif (this.message){\r\n\t\t\t\t\t\t$.Dialog.success(title, data.message, true);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse $.Dialog.close();\r\n\t\t\t\t}));\r\n\t\t\t});\r\n\t\t});\r\n\t\t$actions.filter('.delete').on('click',function(){\r\n\t\t\tvar $this = $(this),\r\n\t\t\t\ttitle = 'Deleteing request';\r\n\r\n\t\t\t$.Dialog.confirm(title, 'You are about to permanently delete this request.<br>Are you sure about this?', function(sure){\r\n\t\t\t\tif (!sure) return;\r\n\r\n\t\t\t\t$.post('/reserving/request/'+id+'?delete',$.mkAjaxHandler(function(){\r\n\t\t\t\t\tif (this.status){\r\n\t\t\t\t\t\t$.Dialog.close();\r\n\t\t\t\t\t\t$this.closest('li').remove();\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse $.Dialog.fail(title,this.message);\r\n\t\t\t\t}));\r\n\t\t\t});\r\n\t\t});\r\n\t\t$actions.filter('.edit').on('click',function(){\r\n\t\t\tvar $button = $(this),\r\n\t\t\t\t$li = $button.parents('li'),\r\n\t\t\t\t_split = $li.attr('id').split('-'),\r\n\t\t\t\tid = _split[1],\r\n\t\t\t\ttype = _split[0],\r\n\t\t\t\ttitle = 'Editing '+type+' #'+id;\r\n\r\n\t\t\t$.Dialog.wait(title, 'Retrieving '+type+' details');\r\n\r\n\t\t\t$.post('/post/get-'+type+'/'+id,$.mkAjaxHandler(function(){\r\n\t\t\t\tif (!this.status) return $.Dialog.fail(title, this.message);\r\n\r\n\t\t\t\tvar postdata = this,\r\n\t\t\t\t\t$Form = $.mk('form').attr('id', 'post-edit-form').append(\r\n\t\t\t\t\t\t$.mk('label').append(\r\n\t\t\t\t\t\t\t$.mk('span').text('Description (3-255 chars.'+(type==='reservation'?', optional':'')+')'),\r\n\t\t\t\t\t\t\t$.mk('input').attr({\r\n\t\t\t\t\t\t\t\ttype: 'text',\r\n\t\t\t\t\t\t\t\tmaxlength: 255,\r\n\t\t\t\t\t\t\t\tpattern: \"^.{3,255}$\",\r\n\t\t\t\t\t\t\t\tname: 'label',\r\n\t\t\t\t\t\t\t\trequired: type !== 'reservation',\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\tif (type === 'request')\r\n\t\t\t\t\t$Form.append(\r\n\t\t\t\t\t\t$.mk('label').append(\r\n\t\t\t\t\t\t\t$.mk('span').text('Request type'),\r\n\t\t\t\t\t\t\t$.mk('select').attr({\r\n\t\t\t\t\t\t\t\tname: 'type',\r\n\t\t\t\t\t\t\t\trequired: true,\r\n\t\t\t\t\t\t\t}).append(\r\n\t\t\t\t\t\t\t\t$.mk('option').attr('value','chr').text('Character'),\r\n\t\t\t\t\t\t\t\t$.mk('option').attr('value','obj').text('Object'),\r\n\t\t\t\t\t\t\t\t$.mk('option').attr('value','bg').text('Backgound')\r\n\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t$.Dialog.request(title, $Form, 'post-edit-form', 'Save', function($form){\r\n\t\t\t\t\tvar $label = $form.find('[name=label]'),\r\n\t\t\t\t\t\t$type = $form.find('[name=type]');\r\n\t\t\t\t\tif (postdata.label)\r\n\t\t\t\t\t\t$label.val(postdata.label);\r\n\t\t\t\t\tif (postdata.type)\r\n\t\t\t\t\t\t$type.children('option').filter(function(){\r\n\t\t\t\t\t\t\treturn this.value === postdata.type;\r\n\t\t\t\t\t\t}).attr('selected', true);\r\n\t\t\t\t\t$form.on('submit',function(e){\r\n\t\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t\t$.Dialog.wait('Saving changes');\r\n\t\t\t\t\t\tvar data = { label: $label.val() };\r\n\t\t\t\t\t\tif (type === 'request')\r\n\t\t\t\t\t\t\tdata.type = $type.val();\r\n\t\t\t\t\t\t$.post('/post/edit-'+type+'/'+id,data, $.mkAjaxHandler(function(){\r\n\t\t\t\t\t\t\tif (!this.status) return $.Dialog.fail(title, this.message);\r\n\r\n\t\t\t\t\t\t\tif (this.label)\r\n\t\t\t\t\t\t\t\t$li.children('.label').text(this.label);\r\n\t\t\t\t\t\t\tif (this.type && !$li.parent().parent().hasClass('finished')){\r\n\t\t\t\t\t\t\t\tvar $group = $('#group-'+this.type).children('ul'),\r\n\t\t\t\t\t\t\t\t\tgetTimeValue = function(el){\r\n\t\t\t\t\t\t\t\t\t\treturn new Date($(el).children('em').find('time').attr('datetime')).getTime();\r\n\t\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\t$group.append($li);\r\n\t\t\t\t\t\t\t\t$group.children().sort(function(a,b){\r\n\t\t\t\t\t\t\t\t\treturn getTimeValue(a) - getTimeValue(b);\r\n\t\t\t\t\t\t\t\t}).appendTo($group);\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t$.Dialog.close();\r\n\t\t\t\t\t\t}));\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}));\r\n\t\t});\r\n\t}\r\n\r\n\t$.fn.formBind = function (){\r\n\t\tvar $form = $(this),\r\n\t\t\t$formImgCheck = $form.find('.check-img'),\r\n\t\t\t$formImgPreview = $form.find('.img-preview'),\r\n\t\t\t$formDescInput = $form.find('[name=label]'),\r\n\t\t\t$formImgInput = $form.find('[name=image_url]'),\r\n\t\t\t$formTitleInput = $form.find('[name=label]'),\r\n\t\t\t$notice = $formImgPreview.children('.notice'),\r\n\t\t\tnoticeHTML = $notice.html(),\r\n\t\t\t$previewIMG = $formImgPreview.children('img'),\r\n\t\t\ttype = $form.data('type'), Type = type.charAt(0).toUpperCase()+type.substring(1);\r\n\r\n\t\tif ($previewIMG.length === 0) $previewIMG = $(new Image()).appendTo($formImgPreview);\r\n\t\t$('#'+type+'-btn').on('click',function(){\r\n\t\t\tif (!$form.is(':visible')){\r\n\t\t\t\t$form.show();\r\n\t\t\t\t$formDescInput.focus();\r\n\t\t\t\t$body.animate({scrollTop: $form.offset().top - $navbar.outerHeight() - 10 }, 500);\r\n\t\t\t}\r\n\t\t});\r\n\t\tif (type === 'reservation') $('#add-reservation-btn').on('click',function(){\r\n\t\t\tvar title = 'Add a reservation';\r\n\t\t\t$.Dialog.request(title,'<form id=\"add-reservation\"><div class=\"notice fail\"><label>Error</label><p></p></div><div class=\"notice info\">This feature should only be used when the vector was made before the episode was displayed here, and all you want to do is link your already-made vector under the newly posted episode.</div><div class=\"notice warn\">If you already posted the reservation, use the <strong class=\"typcn typcn-attachment\">I\\'m done</strong> button to mark it as finished instead of adding it here.</div><input type=\"text\" name=\"deviation\" placeholder=\"Deviation URL\"></form>','add-reservation','Finish',function(){\r\n\t\t\t\tvar $form = $('#add-reservation'),\r\n\t\t\t\t\t$ErrorNotice = $form.find('.notice.fail').hide().children('p');\r\n\t\t\t\t$form.on('submit',function(e){\r\n\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\tvar deviation = $form.find('[name=deviation]').val(),\r\n\t\t\t\t\t\thandleError = function(e){\r\n\t\t\t\t\t\t\t$ErrorNotice.html(e.message).parent().show();\r\n\t\t\t\t\t\t\t$w.trigger('resize');\r\n\t\t\t\t\t\t\t$form.find('input').attr('disabled', false);\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tif (typeof deviation !== 'string' || deviation.length === 0)\r\n\t\t\t\t\t\t\tthrow new Error('Please enter a deviation URL');\r\n\r\n\t\t\t\t\t\t$.Dialog.wait('Adding reservation');\r\n\r\n\t\t\t\t\t\t$.post('/reserving/reservation?add='+idstr,{deviation:deviation},$.mkAjaxHandler(function(){\r\n\t\t\t\t\t\t\tif (this.status){\r\n\t\t\t\t\t\t\t\t$.Dialog.success(title,this.message);\r\n\t\t\t\t\t\t\t\tupdateSection(type, SEASON, EPISODE);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse  handleError(this);\r\n\t\t\t\t\t\t}));\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcatch(e){ handleError(e) }\r\n\t\t\t\t});\r\n\t\t\t})\r\n\t\t});\r\n\t\t$formImgInput.on('keyup change paste',imgCheckDisabler);\r\n\t\tvar outgoing =  /^https?:\\/\\/www\\.deviantart\\.com\\/users\\/outgoing\\?/;\r\n\t\tfunction imgCheckDisabler(disable){\r\n\t\t\tvar prevurl = $formImgInput.data('prev-url'),\r\n\t\t\t\tsamevalue = typeof prevurl === 'string' && prevurl.trim() === $formImgInput.val().trim();\r\n\t\t\t$formImgCheck.attr('disabled',disable === true || samevalue);\r\n\t\t\tif (disable === true || samevalue) $formImgCheck.attr('title', 'You need to change the URL before chacking again.');\r\n\t\t\telse $formImgCheck.removeAttr('title');\r\n\r\n\t\t\tif (disable.type === 'keyup'){\r\n\t\t\t\tvar val = $formImgInput.val();\r\n\t\t\t\tif (outgoing.test(val))\r\n\t\t\t\t\t$formImgInput.val($formImgInput.val().replace(outgoing,''));\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar CHECK_BTN = '<strong class=\"typcn typcn-arrow-repeat\" style=\"display:inline-block\">Check image</strong>';\r\n\t\t$formImgCheck.on('click',function(e){\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\t$formImgCheck.removeClass('red');\r\n\t\t\timgCheckDisabler(true);\r\n\t\t\tvar url = $formImgInput.val(),\r\n\t\t\t\ttitle = Type+' process';\r\n\r\n\t\t\t$.Dialog.wait(Type+' process','Checking image');\r\n\r\n\t\t\t$.post('/post', { image_url: url }, $.mkAjaxHandler(function(){\r\n\t\t\t\tvar data = this;\r\n\t\t\t\tif (!data.status){\r\n\t\t\t\t\t$notice.html(data.message).show();\r\n\t\t\t\t\t$previewIMG.hide();\r\n\t\t\t\t\treturn $.Dialog.close();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction load(data, attempts){\r\n\t\t\t\t\t$.Dialog.wait(title,'Checking image availability');\r\n\r\n\t\t\t\t\t$previewIMG.attr('src',data.preview).show().off('load error').on('load',function(){\r\n\t\t\t\t\t\t$notice.hide();\r\n\r\n\t\t\t\t\t\t$formImgInput.data('prev-url', url);\r\n\r\n\t\t\t\t\t\tif (!!data.title && !$formTitleInput.val().trim())\r\n\t\t\t\t\t\t\t$.Dialog.confirm(\r\n\t\t\t\t\t\t\t\t'Confirm '+type+' title',\r\n\t\t\t\t\t\t\t\t'The image you just checked had the following title:<br><br><p class=\"align-center\"><strong>'+data.title+'</strong></p>'\r\n\t\t\t\t\t\t\t\t +'<br>Would you like to use this as the '+type+'\\'s description?<br>Keep in mind that it should describe the thing(s) '\r\n\t\t\t\t\t\t\t\t +(type==='request'?'being requested':'you plan to vector')+'.'\r\n\t\t\t\t\t\t\t\t +'<p>This dialog will not appear if you give your '+type+' a description before clicking the '+CHECK_BTN+' button.</p>',\r\n\t\t\t\t\t\t\t\tfunction(sure){\r\n\t\t\t\t\t\t\t\t\tif (!sure) return $form.find('input[name=label]').focus();\r\n\t\t\t\t\t\t\t\t\t$formTitleInput.val(data.title);\r\n\t\t\t\t\t\t\t\t\t$.Dialog.close();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\telse $.Dialog.close(function(){\r\n\t\t\t\t\t\t\t$form.find('input[name=label]').focus();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}).on('error',function(){\r\n\t\t\t\t\t\tvar title = \"Can't load image\";\r\n\t\t\t\t\t\tif (attempts < 1){\r\n\t\t\t\t\t\t\t$.Dialog.wait(title,'Image could not be loaded, retrying in 2 seconds...');\r\n\t\t\t\t\t\t\tsetTimeout(function(){\r\n\t\t\t\t\t\t\t\tload(data, attempts+1);\r\n\t\t\t\t\t\t\t}, 2000);\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t$.Dialog.fail(title,\"There was an error while attempting to load the image. Make sure the URL is correct and try again!\");\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tload(data, 0);\r\n\t\t\t}));\r\n\t\t});\r\n\t\t$form.on('submit',function(e, screwchanges, sanityCheck){\r\n\t\t\te.preventDefault();\r\n\t\t\tvar title = Type+' process';\r\n\r\n\t\t\tif (!screwchanges && $formImgInput.data('prev-url') !== $formImgInput.val())\r\n\t\t\t\treturn $.Dialog.confirm(\r\n\t\t\t\t\ttitle,\r\n\t\t\t\t\t'You modified the image URL without clicking the '+CHECK_BTN+' button.<br>Do you want to continue with the last checked URL?',\r\n\t\t\t\t\tfunction(sure){\r\n\t\t\t\t\t\tif (!sure) return;\r\n\r\n\t\t\t\t\t\t$form.triggerHandler('submit',[true]);\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\r\n\t\t\tif (typeof $formImgInput.data('prev-url') === 'undefined')\r\n\t\t\t\treturn $.Dialog.fail(title, 'Please click the '+CHECK_BTN+' button before submitting your '+type+'!');\r\n\r\n\t\t\tif (!sanityCheck && type === 'request'){\r\n\t\t\t\tvar label = $formDescInput.val(),\r\n\t\t\t\t\t$type = $form.find('select');\r\n\r\n\t\t\t\tif (label.indexOf('character') > -1 && $type.val() !== 'chr')\r\n\t\t\t\t\treturn $.Dialog.confirm(title, 'Your request label contains the word \"character\", but the request type isn\\'t set to Character.<br>Are you sure you\\'re not requesting one (or more) character(s)?',['Let me change the type', 'Carray on'],function(sure){\r\n\t\t\t\t\t\tif (!sure) return $form.triggerHandler('submit',[screwchanges, true]);\r\n\r\n\t\t\t\t\t\t$.Dialog.close(function(){\r\n\t\t\t\t\t\t\t$type.focus();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tvar data = $form.mkData({\r\n\t\t\t\twhat: type,\r\n\t\t\t\tepisode: EPISODE,\r\n\t\t\t\tseason: SEASON,\r\n\t\t\t\timage_url: $formImgInput.data('prev-url'),\r\n\t\t\t});\r\n\r\n\t\t\t$.Dialog.wait(title,'Submitting '+type);\r\n\r\n\t\t\t$.post('/post',data,$.mkAjaxHandler(function(){\r\n\t\t\t\tif (this.status){\r\n\t\t\t\t\t$.Dialog.success(title, Type+' posted successfully');\r\n\t\t\t\t\tupdateSection(type, SEASON, EPISODE);\r\n\t\t\t\t}\r\n\t\t\t\telse $.Dialog.fail(title, this.message);\r\n\t\t\t}));\r\n\t\t}).on('reset',function(){\r\n\t\t\t$formImgCheck.attr('disabled', false).addClass('red');\r\n\t\t\t$notice.html(noticeHTML).show();\r\n\t\t\t$previewIMG.hide();\r\n\t\t\t$formImgInput.removeData('prev-url');\r\n\t\t\t$(this).hide();\r\n\t\t});\r\n\t};\r\n\tfunction updateSection(type, SEASON, EPISODE){\r\n\t\tvar Type = type.charAt(0).toUpperCase()+type.substring(1), dis = this;\r\n\t\t$.Dialog.wait(Type, 'Updating list');\r\n\t\t$.post('/episode/'+type.replace(/([^s])$/,'$1s')+'/S'+SEASON+'E'+EPISODE,$.mkAjaxHandler(function(){\r\n\t\t\tif (this.status){\r\n\t\t\t\tvar $section = $('#'+type.replace(/([^s])$/,'$1s')),\r\n\t\t\t\t\t$newChilds = $(this.render).filter('section').children();\r\n\t\t\t\t$section.empty().append($newChilds).rebindHandlers();\r\n\t\t\t\t$section.find('.post-form').data('type',type).formBind();\r\n\t\t\t\twindow.updateTimes();\r\n\t\t\t\tif (typeof dis === 'object' && typeof dis.callback == 'function') dis.callback();\r\n\t\t\t\telse $.Dialog.close();\r\n\t\t\t}\r\n\t\t\telse window.location.reload();\r\n\t\t}));\r\n\t}\r\n\t$('.post-form').each($.fn.formBind);\r\n\r\n\tfunction hlhash(e){\r\n\t\tif (typeof e === 'object' && typeof e.preventDefault === 'function')\r\n\t\t\te.preventDefault();\r\n\r\n\t\t$.Dialog.close();\r\n\r\n\t\thandlehash(location.hash, e);\r\n\t}\r\n\tfunction handlehash(hash, e){\r\n\t\tvar $anchor = $(hash);\r\n\r\n\t\t$('.highlight').removeClass('highlight');\r\n\t\tif (!$anchor.length) return;\r\n\r\n\t\t$anchor.addClass('highlight');\r\n\t\tsetTimeout(function(){\r\n\t\t\t$body.animate({scrollTop: $anchor.offset().top - $navbar.outerHeight() - 10 }, 500,function(){\r\n\t\t\t\tif (typeof e === 'object' && e.type === 'load') $.Dialog.close();\r\n\t\t\t});\r\n\t\t}, 1);\r\n\t}\r\n\t$w.on('hashchange', hlhash);\r\n\tif (location.hash.length){\r\n\t\tvar $imgs = $content.find('img'),\r\n\t\t\ttotal = $imgs.length, loaded = 0;\r\n\r\n\t\tif (total > 0 && $(location.hash).length > 0){\r\n\t\t\t$.Dialog.wait('Scroll post into view','Waiting for page to load');\r\n\t\t\tvar $progress = $.mk('progress').attr({max:total,value:0}).css({display:'block',width:'100%',marginTop:'5px'});\r\n\t\t\t$('#dialogContent').children('div:not([id])').last().addClass('align-center').append($progress);\r\n\t\t\t$content.imagesLoaded()\r\n\t\t\t\t.progress(function(_, img){\r\n\t\t\t\t\tif (img.isLoaded){\r\n\t\t\t\t\t\tloaded++;\r\n\t\t\t\t\t\t$progress.attr('value', loaded);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\ttotal--;\r\n\t\t\t\t\t\t$progress.attr('max', total);\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t.always(function(){\r\n\t\t\t\t\tsetTimeout(function(){\r\n\t\t\t\t\t\t$.Dialog.close();\r\n\t\t\t\t\t\thlhash({type:'load'});\r\n\t\t\t\t\t},1);\r\n\t\t\t\t});\r\n\t\t}\r\n\t\telse hlhash();\r\n\t}\r\n});\r\n"],"sourceRoot":"/source/"}