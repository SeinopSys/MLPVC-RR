DocReady.push(function(){"use strict";!function o(){var i=$(".pending-reservations");i.length&&i.on("click","button.cancel",function(){var t=$(this),n=t.prev();$.Dialog.confirm("Cancel reservation","Are you sure you want to cancel this reservation?",function(e){if(e){$.Dialog.wait(!1,"Cancelling reservation");var a=n.prop("hash").substring(1).split("-");$.post("/post/cancel-"+a[0]+"/"+a[1],{FROM_PROFILE:!0},$.mkAjaxHandler(function(){if(!this.status)return $.Dialog.fail(!1,this.message);var n=this.pendingReservations;t.closest("li").fadeOut(1e3,function(){$(this).remove(),n&&(i.replaceWith(n),window.updateTimes(),o())}),$.Dialog.close()}))}})})}();var i=$("#signout"),t=$content.children("h1").children().eq(1),n=$(".session-list"),e=t.text().trim(),a=e===$sidebar.children(".welcome").find(".un").text().trim();n.find("button.remove").off("click").on("click",function(t){t.preventDefault();var n="Deleting session",o=$(this),s=o.closest("li"),l=s.children(".browser").text().trim(),r=s.children(".platform"),c=r.length?" on <em>"+r.children("strong").text().trim()+"</em>":"";if(0===s.index()&&-1!==s.children().last().text().indexOf("Current"))return i.triggerHandler("click");var g=s.attr("id").replace(/\D/g,"");return"undefined"==typeof g||isNaN(g)||!isFinite(g)?$.Dialog.fail(n,"Could not locate Session ID, please reload the page and try again."):void $.Dialog.confirm(n,(a?"You":e)+" will be signed out of <em>"+l+"</em>"+c+".<br>Continue?",function(i){i&&($.Dialog.wait(n,"Signing out of "+l),$.post("/user/sessiondel/"+g,$.mkAjaxHandler(function(){return this.status?0!==s.siblings().length?(s.remove(),$.Dialog.close()):($.Dialog.wait(!1,"Reloading page",!0),void $.Navigation.reload(function(){$.Dialog.close()})):$.Dialog.fail(n,this.message)})))})}),n.find("button.useragent").on("click",function(i){i.preventDefault();var t=$(this);$.Dialog.info("User Agent string for session #"+t.parents("li").attr("id").replace(/\D/g,""),"<code>"+t.data("agent")+"</code>")}),$("#signout-everywhere").on("click",function(){$.Dialog.confirm("Sign out from ALL sessions","This will invalidate ALL sessions. Continue?",function(i){i&&($.Dialog.wait(!1,"Signing out"),$.post("/signout?everywhere",{username:e},$.mkAjaxHandler(function(){return this.status?($.Dialog.wait(!1,"Reloading page",!0),void $.Navigation.reload(function(){$.Dialog.close()})):$.Dialog.fail(!1,this.message)})))})}),$("#unlink").on("click",function(){var i="Unlink account & sign out";$.Dialog.confirm(i,"Are you sure you want to unlink your account?",function(t){t&&($.Dialog.wait(i,"Removing account link"),$.post("/signout?unlink",$.mkAjaxHandler(function(){return this.status?($.Dialog.wait(!1,"Reloading page",!0),void $.Navigation.reload(function(){$.Dialog.close()})):$.Dialog.fail(!1,this.message)})))})}),$("#awaiting-deviations").children("li").children(":last-child").children("button.check").on("click",function(i){i.preventDefault();var t=$(this).parents("li"),n=t.attr("id").split("-"),e=n[0],a=n[1];$.Dialog.wait("Deviation acceptance status","Checking"),$.post("/post/lock-"+e+"/"+a,$.mkAjaxHandler(function(){if(!this.status)return $.Dialog.fail(!1,this.message);var i=this.message;$.Dialog.wait(!1,"Reloading page"),$.Navigation.reload(function(){$.Dialog.success(!1,i,!0)})}))}),$("#settings").find("form").on("submit",function(i){i.preventDefault();var t=$(this),n=t.attr("action"),e=t.mkData(),a=t.find('[name="value"]');$.Dialog.wait("Saving setting","Please wait"),$.post(n,e,$.mkAjaxHandler(function(){return this.status?(a.val(this.value).data("orig",this.value).triggerHandler("change"),void $.Dialog.close()):$.Dialog.fail(!1,this.message)}))}).children("label").children("input,textarea,select").each(function(){!function(i){i.data("orig",i.val()).on("keydown change",function(){i.siblings(".save").attr("disabled",i.val().trim()===i.data("orig"))})}($(this))})});
//# sourceMappingURL=user.min.js.map
