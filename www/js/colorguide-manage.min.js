$(function(){function t(t){t.children().sort(function(t,e){var i=/^.*typ-([a-z]+).*$/;return t=[t.className.replace(i,"$1"),t.innerHTML.trim()],e=[e.className.replace(i,"$1"),e.innerHTML.trim()],t[0]===e[0]?t[1].localeCompare(e[1]):t[0].localeCompare(e[0])}).appendTo(t)}function e(){u.children(":not(.ctxmenu-bound)").ctxmenu([{text:"Edit tag",icon:"pencil",click:function(){var e=$(this),i=e.text().trim(),a=e.attr("class").match(/id-(\d+)(?:\s|$)/)[1],n="Editing tag: "+i;$.Dialog.wait(n,"Retrieveing tag details from server"),$.post("/colorguide/gettag/"+a,$.mkAjaxHandler(function(){var e=this;this.status?$.Dialog.request(n,s.clone(!0,!0),"edit-tag","Save",function(){var i=$("#edit-tag"),n=i.children(".notice").children("p"),o=function(){n.html(this.message).parent().removeClass("info").addClass("fail").show(),i.find("input, texarea").attr("disabled",!1),$.Dialog.center()};i.find("input[name=type][value="+e.type+"]").prop("checked",!0),i.find("input[type=text][name], textarea[name]").each(function(){var t=$(this);t.val(e[t.attr("name")])}),i.on("submit",function(e){e.preventDefault();var i=$(this).serializeArray(),r={};$.each(i,function(t,e){r[e.name]=e.value}),n.text("Saving changes...").parent().removeClass("fail").addClass("info").show(),$.Dialog.center(),$.post("/colorguide/settag/"+a,r,$.mkAjaxHandler(function(){if(this.status){var e=$(".id-"+this.tid);e.qtip("destroy",!0),this.title?e.attr("title",this.title):e.removeAttr("title"),e.attr("class","tag id-"+this.tid+(this.type?" typ-"+this.type:"")).text(this.name).data("ctxmenu-items").eq(0).text("Tag: "+this.name),e.parent().each(function(){t($(this))}),window.tooltips(),$.Dialog.close()}else o.call(this)}))})}):$.Dialog.fail(n,this.message)}))}},{text:"Remove tag",icon:"minus",click:function(){var t=$(this),e=t.closest("li").attr("id").replace(/\D/g,""),i=t.text().trim(),a=t.attr("class").match(/id-(\d+)(?:\s|$)/)[1],n="Remove tag: "+i;$.Dialog.confirm(n,"The tag "+i+" will be removed from this appearance.<br>Are you sure?",["Remove it","Nope"],function(i){i&&($.Dialog.wait(n,"Removing tag"),$.post("/colorguide/untag/"+e,{tag:a},$.mkAjaxHandler(function(){this.status?(t.qtip("destroy",!0),t.remove(),$.Dialog.close()):$.Dialog.fail(n,this.message)})))})}},{text:"Delete tag",icon:"trash",click:function(){var t=$(this),e=t.text().trim(),i=t.attr("class").match(/id-(\d+)(?:\s|$)/)[1],a="Detele tag: "+e;$.Dialog.confirm(a,"By deleting this tag, it'll be removed from every appearance where it's been used.<br>Are you sure?",["Delete it","Nope"],function(t){t&&($.Dialog.wait(a,"Sending removal request"),$.post("/colorguide/deltag/"+i,$.mkAjaxHandler(function(){if(this.status){var t=$(".id-"+i);t.qtip("destroy",!0),t.remove(),$.Dialog.close()}else $.Dialog.fail(a,this.message)})))})}},!0,{text:"Create new tag",icon:"plus",click:function(){var t="Create new tag",i=$(this),a=i.closest("li"),n=i.closest("div:not([class])"),o=n.children(".tags"),r=a.attr("id").replace(/\D/g,""),l=n.children("strong").text().trim();$.Dialog.request(t,s.clone(!0,!0),"edit-tag","Create",function(){var t=$("#edit-tag"),i=t.children(".notice").children("p"),a=function(){i.html(this.message).parent().removeClass("info").addClass("fail").show(),t.find("input, texarea").attr("disabled",!1),$.Dialog.center()};t.append($(document.createElement("label")).append("<input type=checkbox name=addto value="+r+'> Add this tag to the appearance "'+l+'" after creation')),$.Dialog.center(),t.on("submit",function(n){n.preventDefault();var r=t.serializeArray(),l={};$.each(r,function(t,e){l[e.name]=e.value}),i.text("Creating tag...").parent().removeClass("fail").addClass("info").show(),$.Dialog.center(),$.post("/colorguide/maketag",l,$.mkAjaxHandler(function(){this.status?(this.tags&&(o.children("[data-hasqtip]").qtip("destroy",!0),o.html(this.tags),window.tooltips(),e()),$.Dialog.close()):a.call(this)}))})})}}],function(t){return"Tag: "+t.text().trim()});var o=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("value"),queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:"/colorguide/gettags?s=%QUERY",wildcard:"%QUERY"}}),r=[13,188];u.children(".addtag").each(function(){var t=$(this),i=t.parents("li").attr("id").substring(1);t.typeahead(null,{name:"tags",display:"name",source:o,templates:{suggestion:Handlebars.compile('<span class="tag id-{{tid}} typ-{{type}}">{{name}}</span>')}}),t.on("keydown",function(a){if(-1!==r.indexOf(a.keyCode)){a.preventDefault();var n=t.val().trim(),o=t.parents(".tags"),l=o.children(".tag"),c="Adding tag: "+n;if(l.filter(function(){return this.innerHTML.trim()===n}).length>0)return $.Dialog.fail(c,"This appearance already has this tag");t.attr("disabled",!0),$.post("/colorguide/tag/"+i,{tag_name:t.val()},$.mkAjaxHandler(function(){this.status?(o.children("[data-hasqtip]").qtip("destroy",!0),o.html(this.tags),window.tooltips(),e(),$("#p"+i).find(".addtag").focus()):$.Dialog.fail(c,this.message),t.removeAttribute("disabled").focus()}))}}),t.nextAll(".tt-menu").on("click",".tag",function(){t.trigger({type:"keydown",keyCode:13})})}),i=$("ul.colors").children("li"),i.filter(":not(.ctxmenu-bound)").ctxmenu([{text:"Edit "+n+" group (TBI)",icon:"pencil",click:function(){return void $.Dialog.info("Edit "+n+" group triggered","yay")}},{text:"Delete "+n+" group (TBI)",icon:"trash",click:function(){$.Dialog.info("Delete "+n+" group triggered","yay")}},{text:"Add new group (TBI)",icon:"folder-add",click:function(){$.Dialog.info("Add new group triggered","yay")}},{text:"Add new "+n+" (TBI)",icon:"plus",click:function(){$.Dialog.info("Add new color triggered","yay")}}],function(t){return a+" group: "+t.children().first().text().trim().replace(":","")}),i.children("span:not(:first-child)").off("click").on("click",function(t){t.preventDefault(),$.copy(this.innerHTML.trim())}).filter(":not(.ctxmenu-bound)").ctxmenu([{text:"Copy "+n,icon:"clipboard","default":!0,click:function(){$.copy(this.innerHTML.trim())}},{text:"Edit "+n+" (TBI)",icon:"pencil (TBI)",click:function(){$.Dialog.info("Edit "+n+" triggered","yay")}},!0,{text:"Edit "+n+" group (TBI)",icon:"pencil",click:function(){$.ctxmenu.triggerItem($(this).parent(),1)}},{text:"Delete "+n+" group (TBI)",icon:"trash",click:function(){$.ctxmenu.triggerItem($(this).parent(),2)}},{text:"Add new group (TBI)",icon:"folder-add",click:function(){$.ctxmenu.triggerItem($(this).parent(),3)}},{text:"Add new "+n+" (TBI)",icon:"plus",click:function(){$.ctxmenu.triggerItem($(this).parent(),4)}}],function(t){return"Color: "+t.attr("oldtitle")})}var i,a=window.Color,n=window.color,o=window.TAG_TYPES_ASSOC,r="WebkitAppearance"in document.documentElement.style,l=$(document.createElement("form")).attr("id","sprite-img").html("<p class=align-center><a href=#upload>Click here to upload a file</a> or enter a URL below.</p><label><input type=text name=image_url placeholder=\"External image URL\" required></label><p class=align-center>The URL will be checked against the supported provider list, and if an image is found, it'll be downloaded to the server and set as this appearance's sprite image.</p>");$(".upload-wrap").each(function(){var t=$(this),e=t.closest("li").attr("id").substring(1);t.uploadZone({requestKey:"sprite",title:"Upload sprite",accept:"image/png",target:"/colorguide/setsprite/"+e}).on("uz-uploadstart",function(){$.Dialog.close()}).ctxmenu([{text:"Open image in new tab",icon:"arrow-forward","default":!0,attr:{href:t.find("img").attr("src"),target:"_blank"}},{text:"Copy image URL",icon:"clipboard",click:function(){$.copy($.urlToAbsolute(t.find("img").attr("src")))}},{text:"Upload new sprite",icon:"upload",click:function(){var e="Upload sprite image",i=t.closest("li").attr("id").substring(1),a=t.find('input[type="file"]');$.Dialog.request(e,l.clone(),"sprite-img","Download image",function(){var t=$("#sprite-img"),n=t.find("input[name=image_url]");t.find("a").on("click",function(t){t.preventDefault(),t.stopPropagation(),a.trigger("click",[!0])}),t.on("submit",function(t){t.preventDefault();var o=n.val();$.Dialog.wait(e,"Downloading external image to the server"),$.post("/colorguide/setsprite/"+i,{image_url:o},$.mkAjaxHandler(function(){this.status?a.trigger("set-image",[this.path]):$.Dialog.fail(e,this.message)}))})})}}],"Sprite image").attr("title",r?" ":"").on("click",function(e,i){return i===!0?!0:(e.preventDefault(),void t.data("ctxmenu-items").eq(1).children().get(0).click())})});var c=$("#list");c.find("button.edit").on("click",function(){$.Dialog.info("Edit mode triggered","yay")}).next().on("click",function(){var t=$(this),e=t.closest("li"),i=e.attr("id").substring(1),a=t.parent().text().trim(),n="Deleting appearance: "+a;$.Dialog.confirm(n,"Deleting this appearance will remove <strong>ALL</strong> of its color groups, the colors within them, and the sprite file, if any.<br>Delete anyway?",function(t){t&&($.Dialog.wait(n,"Sending removal request"),$.post("/colorguide/delete/"+i,$.mkAjaxHandler(function(){this.status?(e.remove(),$.Dialog.close()):$.Dialog.fail(n,this.message)})))})});var s=$(document.createElement("form")).attr("id","edit-tag");s.append("<label><span>Tag name (4-30 chars.)</span><input type=text name=name required pattern=^.{4,30}$ maxlength=30></label>");var d=$(document.createElement("div")).addClass("type-selector");$.each(o,function(t,e){var i=$(document.createElement("label")),a=$(document.createElement("input")).attr({type:"checkbox",name:"type",value:t}).on("click",function(){this.checked&&$(this).parent().siblings().find("input").prop("checked",!1)});i.append(a,$(document.createElement("span")).addClass("tag typ-"+t).text(e)).appendTo(d)}),s.append($(document.createElement("div")).addClass("align-center").append("<span>Tag type (optional)</span><br>",d)).append($(document.createElement("label")).append("<span>Tag description (max 255 chars., optional)</span><br><textarea name=title maxlength=255></textarea>")).append($(document.createElement("div")).attr("class","notice").hide().html("<p></p>"));var u=$(".tags");e(),window.ctxmenus=function(){e()}});
//# sourceMappingURL=colorguide-manage.min.js.map