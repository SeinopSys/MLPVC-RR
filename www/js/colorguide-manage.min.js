$(function(){function t(t){t.children().sort(function(t,e){var i=/^.*typ-([a-z]+).*$/;return t=[t.className.replace(i,"$1"),t.innerHTML.trim()],e=[e.className.replace(i,"$1"),e.innerHTML.trim()],t[0]===e[0]?t[1].localeCompare(e[1]):t[0].localeCompare(e[0])}).appendTo(t)}function e(){p.children(":not(.ctxmenu-bound)").ctxmenu([{text:"Edit tag",icon:"pencil",click:function(){var e=$(this),i=e.text().trim(),n=e.attr("class").match(/id-(\d+)(?:\s|$)/)[1],a="Editing tag: "+i;$.Dialog.wait(a,"Retrieveing tag details from server"),$.post("/colorguide/gettag/"+n,$.mkAjaxHandler(function(){var e=this;this.status?$.Dialog.request(a,s.clone(!0,!0),"edit-tag","Save",function(){var i=$("#edit-tag"),a=i.children(".notice").children("p"),r=function(){a.html(this.message).parent().removeClass("info").addClass("fail").show(),i.find("input, texarea").attr("disabled",!1),$.Dialog.center()};i.find("input[name=type][value="+e.type+"]").prop("checked",!0),i.find("input[type=text][name], textarea[name]").each(function(){var t=$(this);t.val(e[t.attr("name")])}),i.on("submit",function(e){e.preventDefault();var i=$(this).serializeArray(),o={};$.each(i,function(t,e){o[e.name]=e.value}),a.text("Saving changes...").parent().removeClass("fail").addClass("info").show(),$.Dialog.center(),$.post("/colorguide/settag/"+n,o,$.mkAjaxHandler(function(){if(this.status){var e=$(".id-"+this.tid);e.qtip("destroy",!0),this.title?e.attr("title",this.title):e.removeAttr("title"),e.attr("class","tag id-"+this.tid+(this.type?" typ-"+this.type:"")).text(this.name),e.parent().each(function(){t($(this))}),window.tooltips(),$.Dialog.close()}else r.call(this)}))})}):$.Dialog.fail(a,this.message)}))}},{text:"Delete tag",icon:"trash",click:function(){var t=$(this),e=t.text().trim(),i=t.attr("class").match(/id-(\d+)(?:\s|$)/)[1],n="Detele tag: "+e;$.Dialog.confirm(n,"By deleting this tag, it'll be removed from every appearance where it's been used.<br>Are you sure?",["Delete it","Nope"],function(t){t&&($.Dialog.wait(n,"Sending removal request"),$.post("/colorguide/deltag/"+i,$.mkAjaxHandler(function(){if(this.status){var t=$(".id-"+i);t.qtip("destroy",!0),t.remove(),$.Dialog.close()}else $.Dialog.fail(n,this.message)})))})}},!0,{text:"Create new tag",icon:"plus",click:function(){var t="Create new tag",i=$(this),n=i.closest("li"),a=i.closest("div:not([class])"),r=a.children(".tags"),o=n.attr("id").replace(/\D/g,""),l=a.children("strong").text().trim();$.Dialog.request(t,s.clone(!0,!0),"edit-tag","Create",function(){var t=$("#edit-tag"),i=t.children(".notice").children("p"),n=function(){i.html(this.message).parent().removeClass("info").addClass("fail").show(),t.find("input, texarea").attr("disabled",!1),$.Dialog.center()};t.append($(document.createElement("label")).append("<input type=checkbox name=addto value="+o+'> Add this tag to the appearance "'+l+'" after creation')),$.Dialog.center(),t.on("submit",function(a){a.preventDefault();var o=t.serializeArray(),l={};$.each(o,function(t,e){l[e.name]=e.value}),i.text("Creating tag...").parent().removeClass("fail").addClass("info").show(),$.Dialog.center(),$.post("/colorguide/maketag",l,$.mkAjaxHandler(function(){this.status?(this.tags&&(r.children("[data-hasqtip]").qtip("destroy",!0),r.html(this.tags),window.tooltips(),e()),$.Dialog.close()):n.call(this)}))})})}},{text:"Enable edit mode (TBI)",icon:"edit",click:function(){$(this).parent().prevAll("strong").children("button.edit").triggerHandler("click")}}],function(t){return"Tag: "+t.text().trim()}),i=$("ul.colors").children("li"),i.filter(":not(.ctxmenu-bound)").ctxmenu([{text:"Edit "+a+" group (TBI)",icon:"pencil",click:function(){return void $.Dialog.info("Edit "+a+" group triggered","yay")}},{text:"Delete "+a+" group (TBI)",icon:"trash",click:function(){$.Dialog.info("Delete "+a+" group triggered","yay")}},{text:"Add new group (TBI)",icon:"folder-add",click:function(){$.Dialog.info("Add new group triggered","yay")}},{text:"Add new "+a+" (TBI)",icon:"plus",click:function(){$.Dialog.info("Add new color triggered","yay")}}],function(t){return n+" group: "+t.children().first().text().trim().replace(":","")}),i.children("span:not(:first-child)").off("click").on("click",function(t){t.preventDefault(),$.copy(this.innerHTML.trim())}).filter(":not(.ctxmenu-bound)").ctxmenu([{text:"Copy "+a,icon:"clipboard","default":!0,click:function(){$.copy(this.innerHTML.trim())}},{text:"Edit "+a+" (TBI)",icon:"pencil (TBI)",click:function(){$.Dialog.info("Edit "+a+" triggered","yay")}},!0,{text:"Edit "+a+" group (TBI)",icon:"pencil",click:function(){$.ctxmenu.triggerItem($(this).parent(),1)}},{text:"Delete "+a+" group (TBI)",icon:"trash",click:function(){$.ctxmenu.triggerItem($(this).parent(),2)}},{text:"Add new group (TBI)",icon:"folder-add",click:function(){$.ctxmenu.triggerItem($(this).parent(),3)}},{text:"Add new "+a+" (TBI)",icon:"plus",click:function(){$.ctxmenu.triggerItem($(this).parent(),4)}}],function(t){return"Color: "+t.attr("oldtitle")})}var i,n=window.Color,a=window.color,r=window.TAG_TYPES_ASSOC,o="WebkitAppearance"in document.documentElement.style,l=$(document.createElement("form")).attr("id","sprite-img").html('<p class=align-center><a href=#upload>Click here to upload a file</a> or enter a URL below.</p><label><input type=text name=image_url placeholder="External image URL" required></label>');$(".upload-wrap").each(function(){var t=$(this),e=t.closest("li").attr("id").substring(1);t.uploadZone({requestKey:"sprite",title:"Upload sprite",accept:"image/png",target:"/colorguide/setsprite/"+e}).on("uz-uploadstart",function(){$.Dialog.close()}).ctxmenu([{text:"Open image in new tab",icon:"arrow-forward","default":!0,attr:{href:t.find("img").attr("src"),target:"_blank"}},{text:"Copy image URL",icon:"clipboard",click:function(){$.copy($.urlToAbsolute(t.find("img").attr("src")))}},{text:"Upload new sprite",icon:"upload",click:function(){var e="Upload sprite image",i=t.closest("li").attr("id").substring(1),n=t.find('input[type="file"]');$.Dialog.request(e,l.clone(),"sprite-img","Download image",function(){var t=$("#sprite-img"),a=t.find("input[name=image_url]");t.find("a").on("click",function(t){t.preventDefault(),t.stopPropagation(),n.trigger("click",[!0])}),t.on("submit",function(t){t.preventDefault();var r=a.val();$.Dialog.wait(e,"Downloading external image to the server"),$.post("/colorguide/setsprite/"+i,{image_url:r},$.mkAjaxHandler(function(){this.status?n.trigger("set-image",[this.path]):$.Dialog.fail(e,this.message)}))})})}}],"Sprite image").attr("title",o?" ":"").on("click",function(e,i){return i===!0?!0:(e.preventDefault(),void t.data("ctxmenu-items").eq(1).children().get(0).click())})});var c=$("#list");c.find("button.edit").on("click",function(){$.Dialog.info("Edit mode triggered","yay")}).next().on("click",function(){var t=$(this),e=t.closest("li"),i=e.attr("id").substring(1),n=t.parent().text().trim(),a="Deleting appearance: "+n;$.Dialog.confirm(a,"Deleting this appearance will remove <strong>ALL</strong> of its color groups, the colors within them, and the sprite file, if any.<br>Delete anyway?",function(t){t&&($.Dialog.wait(a,"Sending removal request"),$.post("/colorguide/delete/"+i,$.mkAjaxHandler(function(){this.status?(e.remove(),$.Dialog.close()):$.Dialog.fail(a,this.message)})))})});var s=$(document.createElement("form")).attr("id","edit-tag");s.append("<label><span>Tag name (4-30 chars.)</span><input type=text name=name required pattern=^.{4,30}$ maxlength=30></label>");var d=$(document.createElement("div")).addClass("type-selector");$.each(r,function(t,e){var i=$(document.createElement("label")),n=$(document.createElement("input")).attr({type:"checkbox",name:"type",value:t}).on("click",function(){this.checked&&$(this).parent().siblings().find("input").prop("checked",!1)});i.append(n,$(document.createElement("span")).addClass("tag typ-"+t).text(e)).appendTo(d)}),s.append($(document.createElement("div")).addClass("align-center").append("<span>Tag type (optional)</span><br>",d)).append($(document.createElement("label")).append("<span>Tag description (max 255 chars., optional)</span><br><textarea name=title maxlength=255></textarea>")).append($(document.createElement("div")).attr("class","notice").hide().html("<p></p>"));var p=$(".tags");e(),window.ctxmenus=function(){e()}});
//# sourceMappingURL=colorguide-manage.min.js.map