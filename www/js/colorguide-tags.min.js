$(function(){var e=window.TAG_TYPES_ASSOC,t=$("#tags").children("tbody"),a=function(e,a){e.remove(),$.Dialog.success(a,this.message);var i=window.location.pathname;0===t.children().length&&(i=i.replace(/(\d+)$/,function(e){return e>1?e-1:e})),$.toPage(i,!0,!0)};t.on("click","button",function(t){t.preventDefault();var i,n=$(this),r=n.parents("tr"),o=n.parent().prev().text(),s=parseInt(r.children().first().text().trim(),10);switch(this.className.split(" ").pop()){case"delete":i="Detele tag: "+o,$.Dialog.confirm(i,"Deleting this tag will also remove it from every appearance where it's been used.<br>Are you sure?",["Delete it","Nope"],function(e){e&&($.Dialog.wait(i,"Sending removal request"),$.post("/colorguide/deltag/"+s,$.mkAjaxHandler(function(){this.status||$.Dialog.fail(i,this.message),a.call(this,r,i)})))});break;case"merge":i="Merge "+o+" into another tag",$.Dialog.wait(i,"Retrieving tag list from server"),$.post("/colorguide/gettags",{not:s},$.mkAjaxHandler(function(){if(!this.length)return $.Dialog.fail(i,this.message);var t=$.mk("form").attr("id","tag-merge"),n=$.mk("select").attr("required",!0).attr("name","targetid"),l={},g=[];$.each(this,function(t,a){var i=a.type,r=$.mk("option").attr("value",a.tid).text(a.name);return i?("undefined"==typeof l[i]&&(l[i]=$.mk("optgroup").attr("label",e[i]),g.push(i)),void l[i].append(r)):n.append(r)}),$.each(g,function(e,t){n.append(l[t])}),t.append($.mk("p").text("Merging a tag into another will permanently delete it, while replacing it with the merge target on every appearance which used it."),$.mk("label").append($.mk("span").html("Merge <strong>"+o+"</strong> into the following:"),n),$.mk("div").attr("class","notice").hide().html("<p></p>")),$.Dialog.request(i,t,"tag-merge","Merge",function(e){var t=e.children(".notice").children("p"),n=function(){t.html(this.message).parent().removeClass("info").addClass("fail").show(),e.find("select").attr("disabled",!1),$.Dialog.center()};e.on("submit",function(o){o.preventDefault(),t.text("Merging tags...").parent().removeClass("fail").addClass("info").show(),$.Dialog.center(),$.post("/colorguide/mergetag/"+s,e.mkData(),function(){this.status||n.call(this),a.call(this,r,i)})})})}))}})});
//# sourceMappingURL=colorguide-tags.min.js.map