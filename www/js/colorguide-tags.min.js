DocReady.push(function(){"use strict";var e=window.TAG_TYPES_ASSOC,t=$("#tags").children("tbody"),a=function(e,a){e.remove(),$.Dialog.success(a,this.message);var i=window.location.pathname;0===t.children().length&&(i=i.replace(/(\d+)$/,function(e){return e>1?e-1:e})),$.toPage(i,!0,!0)};t.on("click","button",function(t){t.preventDefault();var n,r=$(this),s=r.parents("tr"),o=s.children().eq(1).text().trim(),l=parseInt(s.children().first().text().trim(),10);switch(this.className.split(" ").pop()){case"delete":n="Detele tag: "+o,$.Dialog.confirm(n,"Deleting this tag will also remove it from every appearance where it's been used.<br>Are you sure?",["Delete it","Nope"],function(e){e&&($.Dialog.wait(n,"Sending removal request"),$.post("/colorguide/deltag/"+l,$.mkAjaxHandler(function(){this.status||$.Dialog.fail(n,this.message),a.call(this,s,n)})))});break;case"merge":n="Merge "+o+" into another tag",$.Dialog.wait(n,"Retrieving tag list from server"),$.post("/colorguide/gettags",{not:l},$.mkAjaxHandler(function(){if(!this.length)return $.Dialog.fail(n,this.message);var t=$.mk("form").attr("id","tag-merge"),i=$.mk("select").attr("required",!0).attr("name","targetid"),r={},c=[];$.each(this,function(t,a){var n=a.type,s=$.mk("option").attr("value",a.tid).text(a.name);return n?("undefined"==typeof r[n]&&(r[n]=$.mk("optgroup").attr("label",e[n]),c.push(n)),void r[n].append(s)):i.append(s)}),$.each(c,function(e,t){i.append(r[t])}),t.append($.mk("p").text("Merging a tag into another will permanently delete it, while replacing it with the merge target on every appearance which used it."),$.mk("label").append($.mk("span").html("Merge <strong>"+o+"</strong> into the following:"),i),$.mk("div").attr("class","notice").hide().html("<p></p>")),$.Dialog.request(n,t,"tag-merge","Merge",function(e){e.on("submit",function(t){t.preventDefault(),$.Dialog.wait(!1,"Merging tags"),$.post("/colorguide/mergetag/"+l,e.mkData(),function(){return this.status?void a.call(this,s,n):$.Dialog.fail(!1,this.message)})})})}));break;case"refresh":n="Refresh use count of "+o,$.Dialog.wait(n,"Updating use count"),$.post("/colorguide/recounttag",{tagids:l},i(n))}});var i=function(e,a){return $.mkAjaxHandler(function(){if(this.status||$.Dialog.fail(e,this.message),this.counts){var i=this.counts;t.children().each(function(){var e=$(this).children(),t=parseInt(e.first().text().trim(),10);"undefined"!=typeof i[t]&&e.last().children("span").text(i[t])})}a?$.Dialog.success(e,this.message,!0):$.Dialog.close()})};$(".refresh-all").on("click",function(){var e=[],a="Recalculate tag usage data";t.children().each(function(){e.push($(this).children().first().text().trim())}),$.Dialog.wait(a,"Updating use count"+(1!==e.length?"s":"")),$.post("/colorguide/recounttag",{tagids:e.join(",")},i(a,!0))})});
//# sourceMappingURL=colorguide-tags.min.js.map
