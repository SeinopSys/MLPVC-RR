!function(t){"use strict";var e="poly-",o=t(document);t.fn.polyEditor=function(n){function a(t,e){console.group("topleft");var o=k(),n=t.left,a=t.top,i=o.left,r=o.top;console.log("TX=%f TY=%f FX=%f FY=%f Z2/Z1=%f",n,a,i,r,e);var l=i+e*(n-i),s=r+e*(a-r);return console.log("NTX=%f NTY=%f",l,s),console.groupEnd(),{top:s,left:l}}if(!n.image)throw new Error("Missing image");var i,r,l,s,f=t(new Image).attr({src:n.image,"class":e+"image"}).attr("class",e+"image-element"),p=t(document.createElementNS("http://www.w3.org/2000/svg","svg")).attr({"class":e+"svg-element",version:"1.1",xmlns:"http://www.w3.org/2000/svg"}),c=t.mk("div").attr("class",e+"svg-wrap").append(p),u=this.first().addClass(e+"wrap"),d=t.mk("span").attr("title","Mouse position").attr("class",e+"mousepos").text("?, ?"),m=t.mk("span").attr("title","Image top left").attr("class",e+"imgtl").text("?, ?"),h=t.mk("span").attr("title","Image center").attr("class",e+"imgc").text("?, ?"),g=t.mk("span").attr("title","Wrapper center").attr("class",e+"wrapc").text("?, ?"),w=t.mk("cpan").attr("class",e+"imgc-expected"),v=function(t){return{top:t.top-l.top,left:t.left-l.left}},y=function(t,e){return{top:t.top-l.top+e.height/2,left:t.left-l.left+e.width/2}},k=function(){return{top:i/2,left:r/2}},x=function(e,o){var n=k();p.empty().append(t(document.createElementNS("http://www.w3.org/2000/svg","line")).attr({x1:e.left,y1:e.top,x2:n.left,y2:n.top,fill:"none",stroke:"blue","stroke-width":"5","stroke-miterlimit":"10"}),t(document.createElementNS("http://www.w3.org/2000/svg","line")).attr({x1:o.left,y1:o.top,x2:n.left,y2:n.top,fill:"none",stroke:"red","stroke-width":"5","stroke-miterlimit":"10"}))},b=function(e,o,n){if(E.text(t.roundTo(100*T,2)+"%"),document.activeElement.blur(),X[.1>=T?"disable":"enable"](),D[T>=2.5?"disable":"enable"](),"number"==typeof e){m.text(t.roundTo(e,2)+","+t.roundTo(o,2));var a=y(f.offset(),n);h.text(t.roundTo(a.top,2)+","+t.roundTo(a.left,2)),w.css({top:a.top-5,left:a.left-5});var i=k();g.text(t.roundTo(i.top,2)+","+t.roundTo(i.left,2))}},T=1,z=function(e){var o=f.data("size");if("object"==typeof o){var n,i,r=t.rangeLimit(e,!1,.1,2.5);r!==T?(n=t.scaleResize(o.width,o.height,{scale:r}),i=T,T=n.scale):(n={width:f.width(),height:f.height()},i=T);var l=f.offset(),s=a(v(l),r/i);x(l,s),H.add(f).css({top:s.top,left:s.left,width:n.width,height:n.height}),b(s.top,s.left,n)}},E=t.mk("span").attr({"class":e+"zoom-perc",contenteditable:!0}).text("100%").on("keydown",function(e){if(t.isKey(Key.Enter,e)){e.preventDefault();var o=parseFloat(E.text(),10);isNaN(o)||z(o/100),b()}}).on("click",function(){E.select()}).on("blur",function(){t.clearSelection()}),N=t.mk("button").attr("class",e+"zoom-fit typcn typcn typcn-arrow-minimise").on("click",function(e){var o=f.data("size");if("object"==typeof o){e.preventDefault();var n=o.width>o.height,a=t.scaleResize(o.width,o.height,n?{height:i}:{width:r}),l=n?0:(i-a.height)/2,s=n?(r-a.width)/2:0;H.add(f).css({top:l,left:s,width:a.width,height:a.height}),T=a.scale,z(T)}}),D=t.mk("button").attr("class",e+"zoom-in typcn typcn-zoom-in").on("click",function(t){t.preventDefault(),z((Math.floor(10*T)+1)/10)}),X=t.mk("button").attr("class",e+"zoom-out typcn typcn-zoom-out").on("click",function(t){t.preventDefault(),z((Math.floor(10*T)-1)/10)}),Y=t.mk("div").attr("class",e+"actions "+e+"actions-bl").append(D,X,N,E,m,h,g,d).on("mousedown",function(t){t.stopPropagation(),E.triggerHandler("blur")}),H=t.mk("div").attr("class",e+"image-overlay").appendTo(u),M=t.mk("div").attr("class",e+"loader").html("Loading&hellip;"),S=t.throttle(250,function(t){r=u.innerWidth(),i=u.innerHeight(),l=u.offset(),l.top-=(i-u.outerHeight())/2,l.left-=(r-u.outerWidth())/2,"number"==typeof T&&z(T);var e=k();g.text(e.top+","+e.left),p.attr("viewBox","0 0 "+r+" "+i)});return $w.on("resize",S),S(),u.append(Y,M,w,c),f.on("load",function(){H.css("opacity",0),f.appendTo(u).data("size",{width:f.width(),height:f.height()}),M.detach(),N.triggerHandler("click"),H.fadeTo(500,1);var e,n;s=t.throttle(100,function(t){t.preventDefault();var o={top:t.pageY,left:t.pageX},i=e.top+(o.top-n.top)-l.top,r=e.left+(o.left-n.left)-l.left;H.add(f).css({top:i,left:r});var s={width:f.width(),height:f.height()},p=f.offset();x(p,a(v(p),1)),b(i,r,s)}),o.on("mousedown",function(a){t(a.target).is(H)&&(a.preventDefault(),e=H.offset(),n={top:a.pageY,left:a.pageX},o.on("mousemove",s))}),o.on("mouseup mouseleave blur",function(){o.off("mousemove",s)})}),o.on("mousemove",t.throttle(50,function(t){d.text(t.pageX-l.left+","+(t.pageY-l.top))})),{destroy:function(){"function"==typeof s&&o.off("mousemove",s),$w.off("resize",S),u.empty().removeClass(e+"wrap")}}}}(jQuery);
//# sourceMappingURL=poly-editor.min.js.map
