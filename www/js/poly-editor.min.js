!function(t){"use strict";var e="poly-",o=t(document);t.fn.polyEditor=function(n){function a(t,e){console.group("topleft");var o=y(),n=t.left,a=t.top,i=o.left,r=o.top;console.log("TX=%f TY=%f FX=%f FY=%f Z2/Z1=%f",n,a,i,r,e);var l=i+e*(n-i),s=r+e*(a-r);return console.log("NTX=%f NTY=%f",l,s),console.groupEnd(),{top:s,left:l}}if(!n.image)throw new Error("Missing image");var i,r,l,s=t(new Image).attr({src:n.image,"class":e+"image"}).attr("class",e+"image-element"),f=t(document.createElementNS("http://www.w3.org/2000/svg","svg")).attr({"class":e+"svg-element",version:"1.1",xmlns:"http://www.w3.org/2000/svg"}),c=t.mk("div").attr("class",e+"svg-wrap").append(f),p=this.first().addClass(e+"wrap"),u=t.mk("span").attr("title","Mouse position").attr("class",e+"mousepos").text("?, ?"),d=t.mk("span").attr("title","Image top left").attr("class",e+"imgtl").text("?, ?"),h=t.mk("span").attr("title","Image center").attr("class",e+"imgc").text("?, ?"),m=t.mk("span").attr("title","Wrapper center").attr("class",e+"wrapc").text("?, ?"),g=t.mk("cpan").attr("class",e+"imgc-expected"),v=function(t){var e=k();return{top:t.top-e.top,left:t.left-e.left}},w=function(t,e){var o=k();return{top:t.top-o.top+e.height/2,left:t.left-o.left+e.width/2}},y=function(){return{top:r/2,left:i/2}},k=function(){var t=p.offset();return t.top-=(r-p.outerHeight())/2,t.left-=(i-p.outerWidth())/2,t},b=function(e,o,n){if(z.text(t.roundTo(100*x,2)+"%"),document.activeElement.blur(),X[.1>=x?"disable":"enable"](),E[x>=2.5?"disable":"enable"](),"number"==typeof e){d.text(t.roundTo(e,2)+","+t.roundTo(o,2));var a=w(s.offset(),n);h.text(t.roundTo(a.top,2)+","+t.roundTo(a.left,2)),g.css({top:a.top-5,left:a.left-5});var i=y();m.text(t.roundTo(i.top,2)+","+t.roundTo(i.left,2))}},x=1,T=function(e){var o=s.data("size");if("object"==typeof o){var n,i,r=t.rangeLimit(e,!1,.1,2.5);r!==x?(n=t.scaleResize(o.width,o.height,{scale:r}),i=x,x=n.scale):(n={width:s.width(),height:s.height()},i=x);var l=s.offset(),f=a(v(l),r/i);N.add(s).css({top:f.top,left:f.left,width:n.width,height:n.height}),b(f.top,f.left,n)}},z=t.mk("span").attr({"class":e+"zoom-perc",contenteditable:!0}).text("100%").on("keydown",function(e){if(t.isKey(Key.Enter,e)){e.preventDefault();var o=parseFloat(z.text(),10);isNaN(o)||T(o/100),b()}}).on("click",function(){z.select()}).on("blur",function(){t.clearSelection()}),D=t.mk("button").attr("class",e+"zoom-fit typcn typcn typcn-arrow-minimise").on("click",function(e){var o=s.data("size");if("object"==typeof o){e.preventDefault();var n=o.width>o.height,a=t.scaleResize(o.width,o.height,n?{height:r}:{width:i}),l=n?0:(r-a.height)/2,f=n?(i-a.width)/2:0;N.add(s).css({top:l,left:f,width:a.width,height:a.height}),x=a.scale,T(x)}}),E=t.mk("button").attr("class",e+"zoom-in typcn typcn-zoom-in").on("click",function(t){t.preventDefault(),T((Math.floor(10*x)+1)/10)}),X=t.mk("button").attr("class",e+"zoom-out typcn typcn-zoom-out").on("click",function(t){t.preventDefault(),T((Math.floor(10*x)-1)/10)}),Y=t.mk("div").attr("class",e+"actions "+e+"actions-bl").append(E,X,D,z,d,h,m,u).on("mousedown",function(t){t.stopPropagation(),z.triggerHandler("blur")}),N=t.mk("div").attr("class",e+"image-overlay").appendTo(p),H=t.mk("div").attr("class",e+"loader").html("Loading&hellip;"),M=t.throttle(250,function(t){i=p.innerWidth(),r=p.innerHeight(),"number"==typeof x&&T(x);var e=y();m.text(e.top+","+e.left),f.attr("viewBox","0 0 "+i+" "+r)});return $w.on("resize",M),M(),p.append(Y,H,g,c),s.on("load",function(){N.css("opacity",0),s.appendTo(p).data("size",{width:s.width(),height:s.height()}),H.detach(),D.triggerHandler("click"),N.fadeTo(500,1);var e,n;l=t.throttle(100,function(t){t.preventDefault();var o={top:t.pageY,left:t.pageX},a=k(),i=e.top+(o.top-n.top)-a.top,r=e.left+(o.left-n.left)-a.left;N.add(s).css({top:i,left:r});var l={width:s.width(),height:s.height()};s.offset();b(i,r,l)}),o.on("mousedown",function(a){t(a.target).is(N)&&(a.preventDefault(),e=N.offset(),n={top:a.pageY,left:a.pageX},o.on("mousemove",l))}),o.on("mouseup mouseleave blur",function(){o.off("mousemove",l)})}),o.on("mousemove",t.throttle(50,function(t){var e=k();u.text(t.pageX-e.left+","+(t.pageY-e.top))})),{destroy:function(){"function"==typeof l&&o.off("mousemove",l),$w.off("resize",M),p.empty().removeClass(e+"wrap")}}}}(jQuery);
//# sourceMappingURL=poly-editor.min.js.map
