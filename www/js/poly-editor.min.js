!function(t,e){"use strict";var o="poly-",n=t(document);t.fn.polyEditor=function(e){function a(t,e){console.group("topleft");var o=y(),n=t.left,a=t.top,i=o.left,r=o.top;console.log("TX=%f TY=%f FX=%f FY=%f Z2/Z1=%f",n,a,i,r,e);var s=i+e*(n-i),l=r+e*(a-r);return console.log("NTX=%f NTY=%f",s,l),console.groupEnd(),{top:l,left:s}}if(!e.image)throw new Error("Missing image");var i,r,s,l=t(new Image).attr({src:e.image,"class":o+"image"}).attr("class",o+"image-element"),c=t(document.createElementNS("http://www.w3.org/2000/svg","svg")).attr({"class":o+"svg-element",version:"1.1",xmlns:"http://www.w3.org/2000/svg"}),f=t.mk("div").attr("class",o+"svg-wrap").append(c),p=this.first().addClass(o+"wrap"),u=t.mk("span").attr("title","Mouse position").attr("class",o+"mousepos").text("?, ?"),d=t.mk("span").attr("title","Image top left").attr("class",o+"imgtl").text("?, ?"),m=t.mk("span").attr("title","Image center").attr("class",o+"imgc").text("?, ?"),h=t.mk("span").attr("title","Wrapper center").attr("class",o+"wrapc").text("?, ?"),g=t.mk("cpan").attr("class",o+"imgc-expected"),v=function(t){var e=k();return{top:t.top-e.top,left:t.left-e.left}},w=function(t,e){var o=k();return{top:t.top-o.top+e.height/2,left:t.left-o.left+e.width/2}},y=function(){return{top:r/2,left:i/2}},k=function(){var t=p.offset();return t.top-=(r-p.outerHeight())/2,t.left-=(i-p.outerWidth())/2,t},b=function(){D.text(t.roundTo(100*T,2)+"%"),document.activeElement.blur(),Y[.1>=T?"disable":"enable"](),X[T>=2.5?"disable":"enable"]()},x=function(e,o,n){if(b(),"number"==typeof e){d.text(t.roundTo(e,2)+","+t.roundTo(o,2));var a=w(l.offset(),n);m.text(t.roundTo(a.top,2)+","+t.roundTo(a.left,2)),g.css({top:a.top-5,left:a.left-5});var i=y();h.text(t.roundTo(i.top,2)+","+t.roundTo(i.left,2))}},T=1,z=function(e){var o=l.data("size");if("object"==typeof o){var n,i,r=t.rangeLimit(e,!1,.1,2.5);r!==T?(n=t.scaleResize(o.width,o.height,{scale:r}),i=T,T=n.scale):(n={width:l.width(),height:l.height()},i=T);var s=l.offset(),c=a(v(s),r/i);M.add(l).css({top:c.top,left:c.left,width:n.width,height:n.height}),x(c.top,c.left,n)}},D=t.mk("span").attr({"class":o+"zoom-perc",contenteditable:!0}).text("100%").on("keydown",function(e){if(t.isKey(Key.Enter,e)){e.preventDefault();var o=parseFloat(D.text(),10);isNaN(o)||z(o/100),x()}}).on("mousedown",function(t){D.data("mousedown",!0)}).on("mouseup",function(){D.data("mousedown",!1)}).on("click",function(){D.data("focused")!==!0&&(D.data("focused",!0),D.select())}).on("dblclick",function(t){t.preventDefault(),D.select()}).on("blur",function(e){D.data("mousedown")||D.data("focused",!1),0===D.html().trim().length&&b(),t.clearSelection()}),E=t.mk("button").attr("class",o+"zoom-fit typcn typcn typcn-arrow-minimise").on("click",function(e){var o=l.data("size");if("object"==typeof o){e.preventDefault();var n=o.width>o.height,a=t.scaleResize(o.width,o.height,n?{height:r}:{width:i}),s=n?0:(r-a.height)/2,c=n?(i-a.width)/2:0;M.add(l).css({top:s,left:c,width:a.width,height:a.height}),T=a.scale,z(T)}}),X=t.mk("button").attr("class",o+"zoom-in typcn typcn-zoom-in").on("click",function(t){t.preventDefault(),z((Math.floor(10*T)+1)/10)}),Y=t.mk("button").attr("class",o+"zoom-out typcn typcn-zoom-out").on("click",function(t){t.preventDefault(),z((Math.floor(10*T)-1)/10)}),H=t.mk("div").attr("class",o+"actions "+o+"actions-tl").append(X,Y,E,D).on("mousedown",function(t){t.stopPropagation(),D.triggerHandler("blur")}),N=t.mk("div").attr("class",o+"actions "+o+"actions-bl").append(d,m,h,u).on("mousedown",function(t){t.stopPropagation(),D.triggerHandler("blur")}),M=t.mk("div").attr("class",o+"image-overlay").appendTo(p),j=t.mk("div").attr("class",o+"loader").html("Loading&hellip;"),F=t.throttle(250,function(t){i=p.innerWidth(),r=p.innerHeight(),"number"==typeof T&&z(T);var e=y();h.text(e.top+","+e.left),c.attr("viewBox","0 0 "+i+" "+r)});return $w.on("resize",F),F(),p.append(H,N,j,g,f),l.on("load",function(){M.css("opacity",0),l.appendTo(p).data("size",{width:l.width(),height:l.height()}),j.detach(),E.triggerHandler("click"),M.fadeTo(500,1);var e,o;s=t.throttle(100,function(t){t.preventDefault();var n={top:t.pageY,left:t.pageX},a=k(),i=e.top+(n.top-o.top)-a.top,r=e.left+(n.left-o.left)-a.left;M.add(l).css({top:i,left:r});var s={width:l.width(),height:l.height()};l.offset();x(i,r,s)}),n.on("mousedown",function(a){t(a.target).is(M)&&(a.preventDefault(),e=M.offset(),o={top:a.pageY,left:a.pageX},n.on("mousemove",s))}),n.on("mouseup mouseleave blur",function(){n.off("mousemove",s)})}),n.on("mousemove",t.throttle(50,function(t){var e=k();u.text(t.pageX-e.left+","+(t.pageY-e.top))})),{destroy:function(){"function"==typeof s&&n.off("mousemove",s),$w.off("resize",F),p.empty().removeClass(o+"wrap")}}}}(jQuery);
//# sourceMappingURL=poly-editor.min.js.map
