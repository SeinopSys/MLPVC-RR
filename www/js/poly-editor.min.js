!function(t){"use strict";var e="poly-",o=t(document);t.fn.polyEditor=function(n){function a(t,e,o){console.group("topleft");var n=y(),a=t.left,i=t.top,r=n.left,l=n.top,s=o.width,f=o.height;console.log("CX=%f CY=%f FX=%f FY=%f Z=%f",a,i,r,l,e);var p=r+e*(a-r),c=l+e*(i-l);console.log("NCX=%f NCY=%f",p,c);var u=p-s/2,d=c-f/2;return console.log("NTX=%f NTY=%f",u,d),console.groupEnd(),{top:d,left:u}}if(!n.image)throw new Error("Missing image");var i,r,l,s,f=t(new Image).attr({src:n.image,"class":e+"image"}).attr("class",e+"image-element"),p=t(document.createElementNS("http://www.w3.org/2000/svg","svg")).attr({"class":e+"svg-element",version:"1.1",xmlns:"http://www.w3.org/2000/svg"}),c=t.mk("div").attr("class",e+"svg-wrap").append(p),u=this.first().addClass(e+"wrap"),d=t.mk("span").attr("title","Mouse position").attr("class",e+"mousepos").text("?, ?"),h=t.mk("span").attr("title","Image top left").attr("class",e+"imgtl").text("?, ?"),m=t.mk("span").attr("title","Image center").attr("class",e+"imgc").text("?, ?"),g=t.mk("span").attr("title","Wrapper center").attr("class",e+"wrapc").text("?, ?"),w=t.mk("cpan").attr("class",e+"imgc-expected"),v=function(t,e){return{top:l.top+(t.top-l.top)+e.height/2,left:l.left+(t.left-l.left)+e.width/2}},y=function(){return{top:i/2,left:r/2}},k=function(e,o){var n=y();p.empty().append(t(document.createElementNS("http://www.w3.org/2000/svg","line")).attr({x1:e.left,y1:e.top,x2:n.left,y2:n.top,fill:"none",stroke:"blue","stroke-width":"5","stroke-miterlimit":"10"}),t(document.createElementNS("http://www.w3.org/2000/svg","line")).attr({x1:o.left,y1:o.top,x2:n.left,y2:n.top,fill:"none",stroke:"red","stroke-width":"5","stroke-miterlimit":"10"}))},x=function(e,o,n){if(T.text(t.roundTo(100*b,2)+"%"),document.activeElement.blur(),X[.1>=b?"disable":"enable"](),E[b>=2.5?"disable":"enable"](),"number"==typeof e){h.text(t.roundTo(e,2)+","+t.roundTo(o,2));var a=v(f.offset(),n);m.text(t.roundTo(a.top,2)+","+t.roundTo(a.left,2)),w.css({top:a.top-l.top-5,left:a.left-l.left-5});var i=y();g.text(t.roundTo(i.top,2)+","+t.roundTo(i.left,2))}},b=1,z=function(e){var o=f.data("size");if("object"==typeof o){var n,i=t.rangeLimit(e,!1,.1,2.5);i!==b?(n=t.scaleResize(o.width,o.height,{scale:i}),b=n.scale):n={width:f.width(),height:f.height()};var r=f.offset(),l=a(v(r,n),b,n);k(r,l),C.add(f).css({top:l.top,left:l.left,width:n.width,height:n.height}),x(l.top,l.left,n)}},T=t.mk("span").attr({"class":e+"zoom-perc",contenteditable:!0}).text("100%").on("keydown",function(e){if(t.isKey(Key.Enter,e)){e.preventDefault();var o=parseFloat(T.text(),10);isNaN(o)||z(o/100),x()}}).on("click",function(){T.select()}).on("blur",function(){t.clearSelection()}),N=t.mk("button").attr("class",e+"zoom-fit typcn typcn typcn-arrow-minimise").on("click",function(e){var o=f.data("size");if("object"==typeof o){e.preventDefault();var n=o.width>o.height,a=t.scaleResize(o.width,o.height,n?{height:i}:{width:r}),l=n?0:(i-a.height)/2,s=n?(r-a.width)/2:0;C.add(f).css({top:l,left:s,width:a.width,height:a.height}),b=a.scale,z(b)}}),E=t.mk("button").attr("class",e+"zoom-in typcn typcn-zoom-in").on("click",function(t){t.preventDefault(),z((Math.floor(10*b)+1)/10)}),X=t.mk("button").attr("class",e+"zoom-out typcn typcn-zoom-out").on("click",function(t){t.preventDefault(),z((Math.floor(10*b)-1)/10)}),Y=t.mk("div").attr("class",e+"actions "+e+"actions-bl").append(E,X,N,T,h,m,g,d).on("mousedown",function(t){t.stopPropagation(),T.triggerHandler("blur")}),C=t.mk("div").attr("class",e+"image-overlay").appendTo(u),D=t.mk("div").attr("class",e+"loader").html("Loading&hellip;"),H=t.throttle(250,function(t){r=u.innerWidth(),i=u.innerHeight(),l=u.offset(),l.top-=(i-u.outerHeight())/2,l.left-=(r-u.outerWidth())/2,"number"==typeof b&&z(b);var e=y();g.text(e.top+","+e.left),p.attr("viewBox","0 0 "+r+" "+i)});return $w.on("resize",H),H(),u.append(Y,D,w,c),f.on("load",function(){C.css("opacity",0),f.appendTo(u).data("size",{width:f.width(),height:f.height()}),D.detach(),N.triggerHandler("click"),C.fadeTo(500,1);var e,n;s=t.throttle(100,function(t){t.preventDefault();var o={top:t.pageY,left:t.pageX},i=e.top+(o.top-n.top)-l.top,r=e.left+(o.left-n.left)-l.left;C.add(f).css({top:i,left:r});var s={width:f.width(),height:f.height()},p=f.offset();k(p,a(v(p,s),b,s)),x(i,r,s)}),o.on("mousedown",function(a){t(a.target).is(C)&&(a.preventDefault(),e=C.offset(),n={top:a.pageY,left:a.pageX},o.on("mousemove",s))}),o.on("mouseup mouseleave blur",function(){o.off("mousemove",s)})}),o.on("mousemove",t.throttle(50,function(t){d.text(t.pageX-l.left+","+(t.pageY-l.top))})),{destroy:function(){"function"==typeof s&&o.off("mousemove",s),$w.off("resize",H),u.empty().removeClass(e+"wrap")}}}}(jQuery);
//# sourceMappingURL=poly-editor.min.js.map
