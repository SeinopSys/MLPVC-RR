DocReady.push(function(){function e(i,o,s){i.children("button.reserve-request").off("click").on("click",function(){var t=$(this),n="Reserving request";$.Dialog.wait(n,"Sending reservation to the server"),$.post("/reserving/request/"+o,$.mkAjaxHandler(function(){this.status?($.Dialog.close(),t.nextAll().remove(),$(this.btnhtml).insertAfter(t),e(i,o,s),t.remove()):$.Dialog.fail(n,this.message)}))}),i.children("button.delete").on("click",function(){var e=$(this),t="Deleteing request";$.Dialog.confirm(t,"You are about to permanently delete this request.<br>Are you sure about this?",function(i){i&&$.post("/reserving/request/"+o+"?delete",$.mkAjaxHandler(function(){this.status?($.Dialog.close(),e.closest("li").remove()):$.Dialog.fail(t,this.message)}))})}),i.children("em").children("a").on("click",function(e){e.preventDefault(),n(this.hash),history.replaceState({},"",this.href)});var r=i.find(".reserver-actions").children();r.filter(".cancel").off("click").on("click",function(){var t=$(this),n="Cancel reservation";$.Dialog.confirm(n,"Are you sure you want to cancel this reservation?",function(a){a&&($.Dialog.wait(n,"Cancelling reservation"),$.post("/reserving/"+s+"/"+o+"?cancel",$.mkAjaxHandler(function(){if(this.status){if($.Dialog.close(),this.remove===!0)return i.remove();t.parent().prev().nextAll().addBack().remove(),$(this.btnhtml).appendTo(i),e(i,o,s)}else $.Dialog.fail(n,this.message)})))})}),r.filter(".finish").off("click").on("click",function(){var e="Finish reservation";$.Dialog.request(e,'<form id="finish-res"><div class="notice fail"><label>Error</label><p></p></div><input type="text" name="deviation" placeholder="Deviation URL"></form>',"finish-res","Finish",function(){var i=$("#finish-res"),n=i.find(".notice p");n.parent().hide(),i.on("submit",function(r){r.preventDefault();var d=i.find("[name=deviation]").val(),u=function(e){n.html(e.message).parent().show(),a.trigger("resize"),i.find("input").attr("disabled",!1)};try{if("string"!=typeof d||0===d.length)throw new Error("Please enter a deviation URL");$.post("/reserving/"+s+"/"+o+"?finish",{deviation:d},$.mkAjaxHandler(function(){var i=this;i.status?t.call({callback:function(){"string"==typeof i.message?$.Dialog.success(e,i.message,!0):$.Dialog.close()}},s,l,c):u(i)}))}catch(r){u(r)}})})}),r.filter(".unfinish").off("click").on("click",function(){var e=$(this),i=e.hasClass("delete-only"),n=(i?"Delete":"Un-finish")+" reservation",r=s.charAt(0).toUpperCase()+s.substring(1);$.Dialog.request(n,'<form id="unbind-check"><p>Are you sure you want to '+(i?"delete this reservation":"mark this reservation as unfinished")+'?</p><hr><label><input type="checkbox" name="unbind"> Unbind reservation from user</label></form>',"unbind-check","Un-finish",function(){var e=$("#unbind-check"),d=e.find("[name=unbind]");i||e.prepend('<div class="notice info">By removing the "finished" flag, the deviation will be moved back to the "List of '+r+'" section</div>'),"reservations"===s?(d.on("click",function(){$("#dialogButtons").children().first().val(this.checked?"Delete":"Un-finish")}),i&&d.trigger("click").off("click").on("click keydown touchstart",function(){return!1}).css("pointer-events","none").parent().hide(),e.append('<div class="notice warn">Because this '+(i?"reservation was added directly, it cannot be marked un-finished, only deleted.":"is a reservation, unbinding it from the user will <strong>delete</strong> it permanently.")+"</div>")):e.append('<div class="notice info">If this is checked, any user will be able to reserve this request again afterwards. If left unchecked, only the current reserver <em>(and Vector Inspectors)</em> will be able to mark it as finished until the reservation is cancelled.</div>'),a.trigger("resize"),e.on("submit",function(e){e.preventDefault();var i=d.prop("checked");$.Dialog.wait(n,'Removing "finished" flag'+(i?" & unbinding from user":"")),$.post("/reserving/"+s+"/"+o+"?unfinish"+(i?"&unbind":""),$.mkAjaxHandler(function(){this.status?($.Dialog.success(n,"undefined"!=typeof this.message?this.message:'"finished" flag removed successfully'),t(s,l,c)):$.Dialog.fail(n,this.message)}))})})}),r.filter(".lock").off("click").on("click",function(){var e="Approve post",t=$(this);$.Dialog.confirm(e,"By approving this post, you can prevent any additional modifications, such as un-finishing. This mark is <strong>permanent</strong>, and can only be removed by the developer. <strong>This should be used when the image has been added to the group gallery.</strong><br><br>After approving the post, it'll count towards the user's badges/achievements/points/whatever (once implemented) and the image will receive a small green checkmark on the site. <strong>This action will be logged.</strong><br><br>Are you <em>absolutely</em> sure you want to approve this post, and with that, prevent futher actions?",["Approve it","Nevermind"],function(i){i&&($.Dialog.wait(e,"Approving post"),$.post("/reserving/"+s+"/"+o+"?lock",$.mkAjaxHandler(function(){return this.status?(t.closest("li").children(".image").children("a").append($.mk("span").attr({"class":"typcn typcn-tick",title:"This submission has been accepted into the group gallery"})),t.parent().remove(),void(this.message?$.Dialog.success(e,data.message,!0):$.Dialog.close())):$.Dialog.fail(e,data.message)})))})})}function t(e,t,i){var n=e.charAt(0).toUpperCase()+e.substring(1),a=this;$.Dialog.wait(n,"Updating list"),$.post("/episode/"+e.replace(/([^s])$/,"$1s")+"/S"+t+"E"+i,$.mkAjaxHandler(function(){if(this.status){var t=$("#"+e.replace(/([^s])$/,"$1s")),i=$(this.render).filter("section").children();t.empty().append(i).rebindHandlers(),t.find(".post-form").data("type",e).formBind(),window.updateTimesF(),"object"==typeof a&&"function"==typeof a.callback?a.callback():$.Dialog.close()}else window.location.reload()}))}function i(e){"object"==typeof e&&"function"==typeof e.preventDefault&&e.preventDefault(),$.Dialog.close(),n(location.hash,e)}function n(e,t){var i=$(e);$(".highlight").removeClass("highlight"),i.length&&(i.addClass("highlight"),setTimeout(function(){o.animate({scrollTop:i.offset().top-s.outerHeight()-10},500,function(){"object"==typeof t&&"load"===t.type&&$.Dialog.close()})},1))}var a=$(window),o=$(document.body),s=$("header nav"),r=$("#content"),l=window.SEASON,c=window.EPISODE,d="S"+l+"E"+c;$("#video").on("click",function(){var e="Video links";$.Dialog.wait(e,"Requesting links from the server"),$.post("/episode/getvideos/"+d,$.mkAjaxHandler(function(){var t=this;t.status||$.Dialog.fail(e,t.message);var i=$.mk("form").attr("id","vidlinks").append($.mk("p").addClass("align-center").text("Enter vido links below, leave any input blank to remove that video from the episode page."),$.mk("input").attr({name:"yt",placeholder:"YouTube"}),$.mk("input").attr({name:"dm",placeholder:"Dailymotion"}));$.Dialog.request(e,i,"vidlinks","Save",function(i){var n=i.find("[name=yt]"),a=i.find("[name=dm]");t.yt&&n.val(t.yt),t.dm&&a.val(t.dm),(t.yt||t.dm)&&(i.find("p").show(),$.Dialog.center()),i.on("submit",function(t){t.preventDefault(),$.Dialog.wait(e,"Saving links"),$.post("/episode/setvideos/"+d,{yt:n.val(),dm:a.val()},$.mkAjaxHandler(function(){if(this.status){var t=r.children("section.episode");this.epsection?(t.length||(t=$.mk("section").addClass("episode").insertBefore(r.children("section").first())),t.html($(this.epsection).filter("section").html())):t.length&&t.remove(),$.Dialog.close()}else $.Dialog.fail(e,this.message)}))})})}))});var u=$("#voting"),h=u.find("button");if(u.on("click","button",function(e){e.preventDefault();var t=$(this),i=t.siblings("button").addBack(),n=t.hasClass("green")?1:-1,a=""+d,o=(n>0?"Up":"Down")+"voting "+a;i.attr("disabled",!0),$.post("/episode/vote/"+a,{vote:n},$.mkAjaxHandler(function(){if(this.status){$.Dialog.close();var e=t.closest("section");e.children("h2").nextAll().remove(),e.append(this.newhtml)}else $.Dialog.fail(o,this.message),i.attr("disabled",!1)}))}),u.find("time").data("dyntime-beforeupdate",function(e){return e.past===!0?h.length?void 0:($.post("/episode/vote/"+d+"?html",$.mkAjaxHandler(function(){this.status?(u.children("h2").nextAll().remove(),u.append(this.html)):$.Dialog.fail("Display voting buttons",this.message)})),$(this).removeData("dyntime-beforeupdate"),!1):void 0}),$.fn.rebindHandlers=function(){var t=$(this);return t.find("li[id]").each(function(){var t=$(this),i=parseInt(t.attr("id").replace(/\D/g,"")),n=t.closest("section[id]").attr("id");$("section .unfinished .screencap > a").fluidbox({immediateOpen:!0}).on("openstart",function(){o.addClass("no-distractions")}).on("closestart",function(){o.removeClass("no-distractions")}),e(t,i,n)}),t},$("#requests, #reservations").rebindHandlers(),$.fn.formBind=function(){function e(e){var t=h.data("prev-url"),i="string"==typeof t&&t.trim()===h.val().trim();if(n.attr("disabled",e===!0||i),e===!0||i?n.attr("title","You need to change the URL before chacking again."):n.removeAttr("title"),"keyup"===e.type){var a=h.val();y.test(a)&&h.val(h.val().replace(y,""))}}var i=$(this),n=i.find(".check-img"),r=i.find(".img-preview"),u=i.find("[name=label]"),h=i.find("[name=image_url]"),f=i.find("[name=label]"),p=r.children(".notice"),g=p.html(),v=r.children("img"),m=i.data("type"),b=m.charAt(0).toUpperCase()+m.substring(1);0===v.length&&(v=$(new Image).appendTo(r)),$("#"+m+"-btn").on("click",function(){i.is(":visible")||(i.show(),u.focus(),o.animate({scrollTop:i.offset().top-s.outerHeight()-10},500))}),"reservation"===m&&$("#add-reservation-btn").on("click",function(){var e="Add a reservation";$.Dialog.request(e,'<form id="add-reservation"><div class="notice fail"><label>Error</label><p></p></div><div class="notice info">This feature should only be used when the vector was made before the episode was displayed here, and all you want to do is link your already-made vector under the newly posted episode.</div><div class="notice warn">If you already posted the reservation, use the <strong class="typcn typcn-attachment">I\'m done</strong> button to mark it as finished instead of adding it here.</div><input type="text" name="deviation" placeholder="Deviation URL"></form>',"add-reservation","Finish",function(){var i=$("#add-reservation"),n=i.find(".notice.fail").hide().children("p");i.on("submit",function(o){o.preventDefault();var s=i.find("[name=deviation]").val(),r=function(e){n.html(e.message).parent().show(),a.trigger("resize"),i.find("input").attr("disabled",!1)};try{if("string"!=typeof s||0===s.length)throw new Error("Please enter a deviation URL");$.post("/reserving/reservation?add="+d,{deviation:s},$.mkAjaxHandler(function(){this.status?($.Dialog.success(e,this.message),t(m,l,c)):r(this)}))}catch(o){r(o)}})})}),h.on("keyup change paste",e);var y=/^https?:\/\/www\.deviantart\.com\/users\/outgoing\?/,k='<strong class="typcn typcn-arrow-repeat" style="display:inline-block">Check image</strong>';n.on("click",function(t){t.preventDefault(),n.removeClass("red"),e(!0);var a=h.val(),o=b+" process";$.Dialog.wait(b+" process","Checking image"),$.post("/post",{image_url:a},$.mkAjaxHandler(function(){function e(t,n){$.Dialog.wait(o,"Checking image availability"),v.attr("src",t.preview).show().off("load error").on("load",function(){p.hide(),h.data("prev-url",a),t.title&&!f.val().trim()?$.Dialog.confirm("Confirm "+m+" title",'The image you just checked had the following title:<br><br><p class="align-center"><strong>'+t.title+"</strong></p><br>Would you like to use this as the "+m+"'s description?<br>Keep in mind that it should describe the thing(s) "+("request"===m?"being requested":"you plan to vector")+".<p>This dialog will not appear if you give your "+m+" a description before clicking the "+k+" button.</p>",function(e){return e?(f.val(t.title),void $.Dialog.close()):i.find("input[name=label]").focus()}):$.Dialog.close(function(){i.find("input[name=label]").focus()})}).on("error",function(){var i="Can't load image";return 1>n?($.Dialog.wait(i,"Image could not be loaded, retrying in 2 seconds..."),void setTimeout(function(){e(t,n+1)},2e3)):void $.Dialog.fail(i,"There was an error while attempting to load the image. Make sure the URL is correct and try again!")})}var t=this;return t.status?void e(t,0):(p.html(t.message).show(),v.hide(),$.Dialog.close())}))}),i.on("submit",function(e,n,a){e.preventDefault();var o=b+" process";if(!n&&h.data("prev-url")!==h.val())return $.Dialog.confirm(o,"You modified the image URL without clicking the "+k+" button.<br>Do you want to continue with the last checked URL?",function(e){e&&i.triggerHandler("submit",[!0])});if("undefined"==typeof h.data("prev-url"))return $.Dialog.fail(o,"Please click the "+k+" button before submitting your "+m+"!");if(!a&&"request"===m){var s=u.val(),r=i.find("select");if(s.indexOf("character")>-1&&"chr"!==r.val())return $.Dialog.confirm(o,"Your request label contains the word \"character\", but the request type isn't set to Character.<br>Are you sure you're not requesting one (or more) character(s)?",["Let me change the type","Carray on"],function(e){return e?void $.Dialog.close(function(){r.focus()}):i.triggerHandler("submit",[n,!0])})}var d=i.mkData({what:m,episode:c,season:l,image_url:h.data("prev-url")});$.Dialog.wait(o,"Submitting "+m),$.post("/post",d,$.mkAjaxHandler(function(){this.status?($.Dialog.success(o,b+" posted successfully"),t(m,l,c)):$.Dialog.fail(o,this.message)}))}).on("reset",function(){n.attr("disabled",!1).addClass("red"),p.html(g).show(),v.hide(),h.removeData("prev-url"),$(this).hide()})},$(".post-form").each($.fn.formBind),a.on("hashchange",i),location.hash.length){var f=r.find("img"),p=f.length,g=0;if(p>0){$.Dialog.wait("Scroll post into view","Waiting for page to load");var v=$.mk("progress").attr({max:p,value:0}).css({display:"block",width:"100%",marginTop:"5px"});$("#dialogContent").children("div:not([id])").last().addClass("align-center").append(v),r.imagesLoaded().progress(function(e,t){t.isLoaded?(g++,v.attr("value",g)):(p--,v.attr("max",p))}).always(function(){setTimeout(function(){$.Dialog.close(),i({type:"load"})},1)})}else i()}});
//# sourceMappingURL=index.min.js.map