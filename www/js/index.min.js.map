{"version":3,"sources":["index.js"],"names":["$","Bind","$li","id","type","children","off","on","$this","this","title","Dialog","wait","post","mkAjaxHandler","status","close","nextAll","remove","btnhtml","insertAfter","fail","message","confirm","sure","closest","$actions","find","filter","parent","prev","addBack","appendTo","request","$form","$ErrorNotice","hide","e","preventDefault","deviation","val","handleError","html","show","$w","trigger","attr","length","Error","data","updateSection","call","callback","success","SEASON","EPISODE","$unfinishBtn","deleteOnly","hasClass","Type","charAt","toUpperCase","substring","$unbind","prepend","first","checked","css","append","unbind","prop","dis","replace","$section","$newChilds","render","empty","rebindHandlers","formBind","window","updateTimesF","location","reload","$body","document","body","$navbar","$content","idstr","$yt","$dm","yt","dm","$epSection","epsection","mk","addClass","insertBefore","$voting","$voteButton","$both","siblings","value","epid","vote","newhtml","diff","past","removeData","fn","each","parseInt","fluidbox","immediateOpen","removeClass","imgCheckDisabler","disable","prevurl","$formImgInput","samevalue","trim","$formImgCheck","removeAttr","outgoing","test","$formImgPreview","$formDescInput","$formTitleInput","$notice","noticeHTML","$previewIMG","Image","is","focus","animate","scrollTop","offset","top","outerHeight","CHECK_BTN","url","image_url","preview","screwchanges","sanityCheck","triggerHandler","label","$type","indexOf","mkData","what","episode","season"],"mappings":"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","file":"index.min.js","sourcesContent":["$(function(){\r\n\tvar $w = $(window),\r\n\t\t$body = $(document.body),\r\n\t\t$navbar = $('header nav'),\r\n\t\t$content = $('#content'),\r\n\t\tSEASON = window.SEASON,\r\n\t\tEPISODE = window.EPISODE,\r\n\t\tidstr = 'S'+SEASON+'E'+EPISODE;\r\n\r\n\t$('#video').on('click',function(){\r\n\t\t$.post('/episode/getvideos/'+idstr,$.mkAjaxHandler(function(){\r\n\t\t\tvar title = 'Video links';\r\n\t\t\t$.Dialog.request(title,'<form id=vidlinks><input type=\"text\" name=\"yt\" placeholder=\"YouTube\"><input type=\"text\" name=\"dm\" placeholder=\"Dailymotion\"></form>','vidlinks','Save',function(){\r\n\t\t\t\tvar $form = $('#vidlinks'),\r\n\t\t\t\t\t$yt = $form.find('[name=yt]'),\r\n\t\t\t\t\t$dm = $form.find('[name=dm]');\r\n\t\t\t\tif (this.yt) $yt.val(this.yt);\r\n\t\t\t\tif (this.dm) $dm.val(this.dm);\r\n\t\t\t\t$form.on('submit',function(e){\r\n\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t$.Dialog.wait(title, 'Saving links');\r\n\t\t\t\t\t\r\n\t\t\t\t\t$.post('/episode/setvideos/'+idstr,{yt: $yt.val(), dm: $dm.val()},$.mkAjaxHandler(function(){\r\n\t\t\t\t\t\tif (this.status){\r\n\t\t\t\t\t\t\tvar $epSection = $content.children('section.episode');\r\n\t\t\t\t\t\t\tif (this.epsection){\r\n\t\t\t\t\t\t\t\tif (!$epSection.length)\r\n\t\t\t\t\t\t\t\t\t$epSection = $.mk('section')\r\n\t\t\t\t\t\t\t\t\t\t.addClass('episode')\r\n\t\t\t\t\t\t\t\t\t\t.insertBefore($content.children('section').first());\r\n\t\t\t\t\t\t\t\t$epSection.html($(this.epsection).filter('section').html());\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse if ($epSection.length) $epSection.remove();\r\n\t\t\t\t\t\t\t$.Dialog.close();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse $.Dialog.fail(title, this.message);\r\n\t\t\t\t\t}));\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}));\r\n\t});\r\n\r\n\tvar $voting = $('#voting'),\r\n\t\t$voteButton = $voting.find('button');\r\n\t$voting.on('click','button',function(e){\r\n\t\te.preventDefault();\r\n\t\tvar $this = $(this),\r\n\t\t\t$both = $this.siblings('button').addBack(),\r\n\t\t\tvalue = $this.hasClass('green') ? 1 : -1,\r\n\t\t\tepid = ''+idstr,\r\n\t\t\ttitle = (value > 0?'Up':'Down')+'voting '+epid;\r\n\r\n\t\t$both.attr('disabled', true);\r\n\r\n\t\t$.post('/episode/vote/'+epid,{vote:value},$.mkAjaxHandler(function(){\r\n\t\t\tif (this.status){\r\n\t\t\t\t$.Dialog.close();\r\n\t\t\t\tvar $section = $this.closest('section');\r\n\t\t\t\t$section.children('h2').nextAll().remove();\r\n\t\t\t\t$section.append(this.newhtml);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t$.Dialog.fail(title,this.message);\r\n\t\t\t\t$both.attr('disabled', false);\r\n\t\t\t}\r\n\t\t}));\r\n\t});\r\n\r\n\t$voting.find('time').data('dyntime-beforeupdate',function(diff){\r\n\t\tif (diff.past !== true) return;\r\n\r\n\t\tif (!$voteButton.length){\r\n\t\t\t$.post('/episode/vote/'+idstr+'?html',$.mkAjaxHandler(function(){\r\n\t\t\t\tif (this.status){\r\n\t\t\t\t\t$voting.children('h2').nextAll().remove();\r\n\t\t\t\t\t$voting.append(this.html);\r\n\t\t\t\t}\r\n\t\t\t\telse $.Dialog.fail('Display voting buttons',this.message);\r\n\t\t\t}));\r\n\t\t\t$(this).removeData('dyntime-beforeupdate');\r\n\t\t\treturn false;\r\n\t\t}\r\n\t});\r\n\r\n\t$.fn.rebindHandlers = function(){\r\n\t\tvar $this = $(this);\r\n\t\t$this.find('li[id]').each(function(){\r\n\t\t\tvar $li = $(this),\r\n\t\t\t\tid = parseInt($li.attr('id').replace(/\\D/g,'')),\r\n\t\t\t\ttype = $li.closest('section[id]').attr('id');\r\n\t\t\t\t\r\n\t\t\t$('section .unfinished .screencap > a')\r\n\t\t\t\t.fluidbox({ immediateOpen: true })\r\n\t\t\t\t.on('openstart',function(){\r\n\t\t\t\t\t$body.addClass('no-distractions');\r\n\t\t\t\t})\r\n\t\t\t\t.on('closestart', function() {\r\n\t\t\t\t\t$body.removeClass('no-distractions');\r\n\t\t\t\t});\r\n\r\n\t\t\tBind($li, id, type);\r\n\t\t});\r\n\t\treturn $this;\r\n\t};\r\n\t$('#requests, #reservations').rebindHandlers();\r\n\tfunction Bind($li, id, type){\r\n\t\t$li.children('button.reserve-request').off('click').on('click',function(){\r\n\t\t\tvar $this = $(this),\r\n\t\t\t\ttitle = 'Reserving request';\r\n\r\n\t\t\t$.Dialog.wait(title,'Sending reservation to the server');\r\n\r\n\t\t\t$.post(\"/reserving/request/\"+id,$.mkAjaxHandler(function(){\r\n\t\t\t\tif (this.status){\r\n\t\t\t\t\t$.Dialog.close();\r\n\t\t\t\t\t$this.nextAll().remove();\r\n\t\t\t\t\t$(this.btnhtml).insertAfter($this);\r\n\t\t\t\t\tBind($li, id, type);\r\n\t\t\t\t\t$this.remove();\r\n\t\t\t\t}\r\n\t\t\t\telse $.Dialog.fail(title,this.message);\r\n\t\t\t}));\r\n\t\t});\r\n\t\t$li.children('button.delete').on('click',function(){\r\n\t\t\tvar $this = $(this),\r\n\t\t\t\ttitle = 'Deleteing request';\r\n\r\n\t\t\t$.Dialog.confirm(title, 'You are about to permanently delete this request.<br>Are you sure about this?', function(sure){\r\n\t\t\t\tif (!sure) return;\r\n\r\n\t\t\t\t$.post('/reserving/request/'+id+'?delete',$.mkAjaxHandler(function(){\r\n\t\t\t\t\tif (this.status){\r\n\t\t\t\t\t\t$.Dialog.close();\r\n\t\t\t\t\t\t$this.closest('li').remove();\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse $.Dialog.fail(title,this.message);\r\n\t\t\t\t}));\r\n\t\t\t});\r\n\t\t});\r\n\t\tvar $actions = $li.find('.reserver-actions').children();\r\n\t\t$actions.filter('.cancel').off('click').on('click',function(){\r\n\t\t\tvar $this = $(this),\r\n\t\t\t\ttitle = 'Cancel reservation';\r\n\r\n\t\t\t$.Dialog.confirm(title,'Are you sure you want to cancel this reservation?',function(sure){\r\n\t\t\t\tif (!sure) return;\r\n\r\n\t\t\t\t$.Dialog.wait(title,'Cancelling reservation');\r\n\r\n\t\t\t\t$.post('/reserving/'+type+'/'+id+'?cancel',$.mkAjaxHandler(function(){\r\n\t\t\t\t\tif (this.status){\r\n\t\t\t\t\t\t$.Dialog.close();\r\n\t\t\t\t\t\tif (this.remove === true) return $li.remove();\r\n\t\t\t\t\t\t$this.parent().prev().nextAll().addBack().remove();\r\n\t\t\t\t\t\t$(this.btnhtml).appendTo($li);\r\n\r\n\t\t\t\t\t\tBind($li, id, type);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse $.Dialog.fail(title,this.message);\r\n\t\t\t\t}));\r\n\t\t\t});\r\n\t\t});\r\n\t\t$actions.filter('.finish').off('click').on('click',function(){\r\n\t\t\tvar title = 'Finish reservation';\r\n\r\n\t\t\t$.Dialog.request(title,'<form id=\"finish-res\"><div class=\"notice fail\"><label>Error</label><p></p></div><input type=\"text\" name=\"deviation\" placeholder=\"Deviation URL\"></form>','finish-res','Finish',function(){\r\n\t\t\t\tvar $form = $('#finish-res'),\r\n\t\t\t\t\t$ErrorNotice = $form.find('.notice p');\r\n\t\t\t\t$ErrorNotice.parent().hide();\r\n\t\t\t\t$form.on('submit',function(e){\r\n\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\tvar deviation = $form.find('[name=deviation]').val(),\r\n\t\t\t\t\t\thandleError = function(e){\r\n\t\t\t\t\t\t\t$ErrorNotice.html(e.message).parent().show();\r\n\t\t\t\t\t\t\t$w.trigger('resize');\r\n\t\t\t\t\t\t\t$form.find('input').attr('disabled', false);\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tif (typeof deviation !== 'string' || deviation.length === 0)\r\n\t\t\t\t\t\t\tthrow new Error('Please enter a deviation URL');\r\n\r\n\t\t\t\t\t\t$.post('/reserving/'+type+'/'+id+'?finish',{deviation:deviation},$.mkAjaxHandler(function(){\r\n\t\t\t\t\t\t\tvar data = this;\r\n\t\t\t\t\t\t\tif (data.status) updateSection.call({callback:function(){\r\n\t\t\t\t\t\t\t\tif (typeof data.message === 'string')\r\n\t\t\t\t\t\t\t\t\t$.Dialog.success(title,data.message,true);\r\n\t\t\t\t\t\t\t\telse $.Dialog.close();\r\n\t\t\t\t\t\t\t}}, type, SEASON, EPISODE);\r\n\t\t\t\t\t\t\telse handleError(data);\r\n\t\t\t\t\t\t}));\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcatch(e){ handleError(e) }\r\n\t\t\t\t});\r\n\t\t\t})\r\n\t\t});\r\n\t\t$actions.filter('.unfinish').off('click').on('click',function(){\r\n\t\t\tvar $unfinishBtn = $(this),\r\n\t\t\t\tdeleteOnly = $unfinishBtn.hasClass('delete-only'),\r\n\t\t\t\ttitle = (deleteOnly?'Delete':'Un-finish')+' reservation',\r\n\t\t\t\tType = type.charAt(0).toUpperCase()+type.substring(1);\r\n\r\n\t\t\t$.Dialog.request(title,'<form id=\"unbind-check\"><p>Are you sure you want to '+(deleteOnly?'delete this reservation':'mark this reservation as unfinished')+'?</p><hr><label><input type=\"checkbox\" name=\"unbind\"> Unbind reservation from user</label></form>','unbind-check','Un-finish',function(){\r\n\t\t\t\tvar $form = $('#unbind-check'),\r\n\t\t\t\t\t$unbind = $form.find('[name=unbind]');\r\n\r\n\t\t\t\tif (!deleteOnly)\r\n\t\t\t\t\t$form.prepend('<div class=\"notice info\">By removing the \"finished\" flag, the deviation will be moved back to the \"List of '+Type+'\" section</div>');\r\n\r\n\t\t\t\tif (type === 'reservations'){\r\n\t\t\t\t\t$unbind.on('click',function(){\r\n\t\t\t\t\t\t$('#dialogButtons').children().first().val(this.checked ? 'Delete' : 'Un-finish')\r\n\t\t\t\t\t});\r\n\t\t\t\t\tif (deleteOnly)\r\n\t\t\t\t\t\t$unbind.trigger('click').off('click').on('click keydown touchstart', function(){return false}).css('pointer-events','none').parent().hide();\r\n\t\t\t\t\t$form.append('<div class=\"notice warn\">Because this '+(!deleteOnly?'is a reservation, unbinding it from the user will <strong>delete</strong> it permanently.':'reservation was added directly, it cannot be marked un-finished, only deleted.')+'</div>');\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t\t$form.append('<div class=\"notice info\">If this is checked, any user will be able to reserve this request again afterwards. If left unchecked, only the current reserver <em>(and Vector Inspectors)</em> will be able to mark it as finished until the reservation is cancelled.</div>');\r\n\t\t\t\t$w.trigger('resize');\r\n\t\t\t\t$form.on('submit',function(e){\r\n\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\tvar unbind = $unbind.prop('checked');\r\n\r\n\t\t\t\t\t$.Dialog.wait(title,'Removing \"finished\" flag'+(unbind?' & unbinding from user':''));\r\n\r\n\t\t\t\t\t$.post('/reserving/'+type+'/'+id+'?unfinish'+(unbind?'&unbind':''),$.mkAjaxHandler(function(){\r\n\t\t\t\t\t\tif (this.status){\r\n\t\t\t\t\t\t\t$.Dialog.success(title, typeof this.message !== 'undefined' ? this.message : '\"finished\" flag removed successfully');\r\n\t\t\t\t\t\t\tupdateSection(type, SEASON, EPISODE);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse $.Dialog.fail(title,this.message);\r\n\t\t\t\t\t}));\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\t$.fn.formBind = function (){\r\n\t\tvar $form = $(this),\r\n\t\t\t$formImgCheck = $form.find('.check-img'),\r\n\t\t\t$formImgPreview = $form.find('.img-preview'),\r\n\t\t\t$formDescInput = $form.find('[name=label]'),\r\n\t\t\t$formImgInput = $form.find('[name=image_url]'),\r\n\t\t\t$formTitleInput = $form.find('[name=label]'),\r\n\t\t\t$notice = $formImgPreview.children('.notice'),\r\n\t\t\tnoticeHTML = $notice.html(),\r\n\t\t\t$previewIMG = $formImgPreview.children('img'),\r\n\t\t\ttype = $form.data('type'), Type = type.charAt(0).toUpperCase()+type.substring(1);\r\n\r\n\t\tif ($previewIMG.length === 0) $previewIMG = $(new Image()).appendTo($formImgPreview);\r\n\t\t$('#'+type+'-btn').on('click',function(){\r\n\t\t\tif (!$form.is(':visible')){\r\n\t\t\t\t$form.show();\r\n\t\t\t\t$formDescInput.focus();\r\n\t\t\t\t$body.animate({scrollTop: $form.offset().top - $navbar.outerHeight() - 10 }, 500);\r\n\t\t\t}\r\n\t\t});\r\n\t\tif (type === 'reservation') $('#add-reservation-btn').on('click',function(){\r\n\t\t\tvar title = 'Add a reservation';\r\n\t\t\t$.Dialog.request(title,'<form id=\"add-reservation\"><div class=\"notice fail\"><label>Error</label><p></p></div><div class=\"notice info\">This feature should only be used when the vector was made before the episode was displayed here, and all you want to do is link your already-made vector under the newly posted episode.</div><div class=\"notice warn\">If you already posted the reservation, use the <strong class=\"typcn typcn-attachment\">I\\'m done</strong> button to mark it as finished instead of adding it here.</div><input type=\"text\" name=\"deviation\" placeholder=\"Deviation URL\"></form>','add-reservation','Finish',function(){\r\n\t\t\t\tvar $form = $('#add-reservation'),\r\n\t\t\t\t\t$ErrorNotice = $form.find('.notice.fail').hide().children('p');\r\n\t\t\t\t$form.on('submit',function(e){\r\n\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\tvar deviation = $form.find('[name=deviation]').val(),\r\n\t\t\t\t\t\thandleError = function(e){\r\n\t\t\t\t\t\t\t$ErrorNotice.html(e.message).parent().show();\r\n\t\t\t\t\t\t\t$w.trigger('resize');\r\n\t\t\t\t\t\t\t$form.find('input').attr('disabled', false);\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tif (typeof deviation !== 'string' || deviation.length === 0)\r\n\t\t\t\t\t\t\tthrow new Error('Please enter a deviation URL');\r\n\r\n\t\t\t\t\t\t$.post('/reserving/reservation?add='+idstr,{deviation:deviation},$.mkAjaxHandler(function(){\r\n\t\t\t\t\t\t\tif (this.status){\r\n\t\t\t\t\t\t\t\t$.Dialog.success(title,this.message);\r\n\t\t\t\t\t\t\t\tupdateSection(type, SEASON, EPISODE);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse  handleError(this);\r\n\t\t\t\t\t\t}));\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcatch(e){ handleError(e) }\r\n\t\t\t\t});\r\n\t\t\t})\r\n\t\t});\r\n\t\t$formImgInput.on('keyup change paste',imgCheckDisabler);\r\n\t\tvar outgoing =  /^https?:\\/\\/www\\.deviantart\\.com\\/users\\/outgoing\\?/;\r\n\t\tfunction imgCheckDisabler(disable){\r\n\t\t\tvar prevurl = $formImgInput.data('prev-url'),\r\n\t\t\t\tsamevalue = typeof prevurl === 'string' && prevurl.trim() === $formImgInput.val().trim();\r\n\t\t\t$formImgCheck.attr('disabled',disable === true || samevalue);\r\n\t\t\tif (disable === true || samevalue) $formImgCheck.attr('title', 'You need to change the URL before chacking again.');\r\n\t\t\telse $formImgCheck.removeAttr('title');\r\n\r\n\t\t\tif (disable.type === 'keyup'){\r\n\t\t\t\tvar val = $formImgInput.val();\r\n\t\t\t\tif (outgoing.test(val))\r\n\t\t\t\t\t$formImgInput.val($formImgInput.val().replace(outgoing,''));\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar CHECK_BTN = '<strong class=\"typcn typcn-arrow-repeat\" style=display:inline-block>Check image</strong>';\r\n\t\t$formImgCheck.on('click',function(e){\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\t$formImgCheck.removeClass('red');\r\n\t\t\timgCheckDisabler(true);\r\n\t\t\tvar url = $formImgInput.val();\r\n\r\n\t\t\t$.Dialog.wait(Type+' process','Checking image');\r\n\r\n\t\t\t$.post('/post', { image_url: url }, $.mkAjaxHandler(function(){\r\n\t\t\t\tif (this.status){\r\n\t\t\t\t\t$previewIMG.attr('src',this.preview).show().on('load',function(){\r\n\t\t\t\t\t\t$notice.hide();\r\n\r\n\t\t\t\t\t\t$formImgInput.data('prev-url', url);\r\n\r\n\t\t\t\t\t\tif (!!this.title && !$formTitleInput.val().trim())\r\n\t\t\t\t\t\t\t$.Dialog.confirm(\r\n\t\t\t\t\t\t\t\t'Confirm '+type+' title',\r\n\t\t\t\t\t\t\t\t'The image you just checked had the following title:<br><br><p class=align-center><strong>'+this.title+'</strong></p>'\r\n\t\t\t\t\t\t\t\t +'<br>Would you like to use this as the '+type+'\\'s description?<br>Keep in mind that it should describe the thing(s) '\r\n\t\t\t\t\t\t\t\t +(type==='request'?'being requested':'you plan to vector')+'.'\r\n\t\t\t\t\t\t\t\t +'<p>This dialog will not appear if you give your '+type+' a description before clicking the '+CHECK_BTN+' button.</p>',\r\n\t\t\t\t\t\t\t\tfunction(sure){\r\n\t\t\t\t\t\t\t\t\tif (!sure) return $form.find('input[name=label]').focus();\r\n\t\t\t\t\t\t\t\t\t$formTitleInput.val(this.title);\r\n\t\t\t\t\t\t\t\t\t$.Dialog.close();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t}).on('error',function(){\r\n\t\t\t\t\t\t$.Dialog.fail(\"Can't load image\",\"There was an error while attempting to load the image. Make sure the URL is correct and try again!\");\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\t$notice.html(this.message).show();\r\n\t\t\t\t\t$previewIMG.hide();\r\n\t\t\t\t}\r\n\t\t\t}));\r\n\t\t});\r\n\t\t$form.on('submit',function(e, screwchanges, sanityCheck){\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\tif (!screwchanges && $formImgInput.data('prev-url') !== $formImgInput.val())\r\n\t\t\t\treturn $.Dialog.confirm(\r\n\t\t\t\t\ttitle,\r\n\t\t\t\t\t'You modified the image URL without clicking the '+CHECK_BTN+' button.<br>Do you want to continue with the last checked URL?',\r\n\t\t\t\t\tfunction(sure){\r\n\t\t\t\t\t\tif (!sure) return;\r\n\r\n\t\t\t\t\t\t$form.triggerHandler('submit',[true]);\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\r\n\t\t\tif (typeof $formImgInput.data('prev-url') === 'undefined')\r\n\t\t\t\treturn $.Dialog.fail(Type, 'Please click the '+CHECK_BTN+' button before submitting your '+type+'!');\r\n\r\n\t\t\tif (!sanityCheck && type === 'request'){\r\n\t\t\t\tvar label = $formDescInput.val(),\r\n\t\t\t\t\t$type = $form.find('select');\r\n\r\n\t\t\t\tif (label.indexOf('character') > -1 && $type.val() !== 'chr')\r\n\t\t\t\t\treturn $.Dialog.confirm(Type, 'Your request label contains the word \"character\", but the request type isn\\'t set to Character.<br>Are you sure you\\'re not requesting one (or more) character(s)?',['Let me change the type', 'Carray on'],function(sure){\r\n\t\t\t\t\t\tif (!sure) return $form.triggerHandler('submit',[screwchanges, true]);\r\n\r\n\t\t\t\t\t\t$.Dialog.close(function(){\r\n\t\t\t\t\t\t\t$type.focus();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\t$.Dialog.wait(Type,'Submitting '+type);\r\n\r\n\t\t\tvar data = $form.mkData({\r\n\t\t\t\twhat: type,\r\n\t\t\t\tepisode: EPISODE,\r\n\t\t\t\tseason: SEASON,\r\n\t\t\t\timage_url: $formImgInput.data('prev-url'),\r\n\t\t\t});\r\n\r\n\t\t\t$.post('/post',data,$.mkAjaxHandler(function(){\r\n\t\t\t\tif (this.status){\r\n\t\t\t\t\t$.Dialog.success(Type+' posted successfully');\r\n\t\t\t\t\tupdateSection(type, SEASON, EPISODE);\r\n\t\t\t\t}\r\n\t\t\t\telse $.Dialog.fail(Type, this.message);\r\n\t\t\t}));\r\n\t\t}).on('reset',function(){\r\n\t\t\t$formImgCheck.attr('disabled', false).addClass('red');\r\n\t\t\t$notice.html(noticeHTML).show();\r\n\t\t\t$previewIMG.hide();\r\n\t\t\t$formImgInput.removeData('prev-url');\r\n\t\t\t$(this).hide();\r\n\t\t});\r\n\t};\r\n\tfunction updateSection(type, SEASON, EPISODE){\r\n\t\tvar Type = type.charAt(0).toUpperCase()+type.substring(1), dis = this;\r\n\t\t$.Dialog.wait(Type, 'Updating list');\r\n\t\t$.post('/episode/'+type.replace(/([^s])$/,'$1s')+'/S'+SEASON+'E'+EPISODE,$.mkAjaxHandler(function(){\r\n\t\t\tif (this.status){\r\n\t\t\t\tvar $section = $('#'+type.replace(/([^s])$/,'$1s')),\r\n\t\t\t\t\t$newChilds = $(this.render).filter('section').children();\r\n\t\t\t\t$section.empty().append($newChilds).rebindHandlers();\r\n\t\t\t\t$section.find('.post-form').data('type',type).formBind();\r\n\t\t\t\twindow.updateTimesF();\r\n\t\t\t\tif (typeof dis === 'object' && typeof dis.callback == 'function') dis.callback();\r\n\t\t\t\telse $.Dialog.close();\r\n\t\t\t}\r\n\t\t\telse window.location.reload();\r\n\t\t}));\r\n\t}\r\n\t$('.post-form').each($.fn.formBind);\r\n});\r\n"],"sourceRoot":"/source/"}