"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};DocReady.push(function(){function e(){var e=$content.find("img[src]"),t=e.length,i=0;if(!t)return $.Dialog.close();var a=void 0;h&&($.Dialog.wait("Scroll post into view","Waiting for page to load"),a=$.mk("progress").attr({max:t,value:0}).css({display:"block",width:"100%",marginTop:"5px"}),$("#dialogContent").children("div:not([id])").last().addClass("align-center").append(a)),$content.imagesLoaded().progress(function(e,o){if(o.isLoaded)i++,h&&a.attr("value",i);else if(o.img.src){var n=$(o.img).closest("li[id]");1===n.length&&n.reloadLi(),t--,h&&a.attr("max",t)}}).always(function(){var e=window._HighlightHash({type:"load"});e===!1&&h&&$.Dialog.info("Scroll post into view","The "+location.hash.replace(u,"$1")+" you were linked to has either been deleted or didn’t exist in the first place. Sorry.<div class='align-center'><span class='sideways-smiley-face'>:\\</div>")})}function t(){var e=void 0,i=$(".episode"),a=i.find(".showplayers").on("scroll-video-into-view",function(){var t=$header.outerHeight();$.scrollTo(e.offset().top-($w.height()-$footer.outerHeight()-t-e.outerHeight())/2-t,500)}),n=a.parent(),r=void 0;if(a.length){var s=i.find(".reportbroken");a.on("click",function(t){if(t.preventDefault(),"undefined"==typeof e)$.Dialog.wait(a.text()),$.post("/episode/video-embeds/"+o,$.mkAjaxHandler(function(){return this.status?(2===this.parts&&(r=$.mk("button").attr("class","blue typcn typcn-media-fast-forward").text("Part 2").on("click",function(){$(this).toggleHtml(["Part 1","Part 2"]),e.children().toggleClass("hidden")}),n.append(r)),e=$.mk("div").attr("class","resp-embed-wrap").html(this.html).insertAfter(n),a.removeClass("typcn-eye green").addClass("typcn-eye-outline blue").text("Hide on-site player").triggerHandler("scroll-video-into-view"),void $.Dialog.close()):$.Dialog.fail(!1,this.message)}));else{var i=a.hasClass("typcn-eye");e[i?"show":"hide"](),r instanceof jQuery&&r.attr("disabled",!i),a.toggleClass("typcn-eye typcn-eye-outline").toggleHtml(["Show on-site player","Hide on-site player"]),i&&a.triggerHandler("scroll-video-into-view")}}),s.on("click",function(e){e.preventDefault(),$.Dialog.confirm("Report broken video",'<p>Have any of the linked videos been removed from their respective platform?<p><p>Please note that availability checking is automatic, bad video quality or sound issues cannot be detected this way. You should <a class="send-feedback">tell us</a> directly if that is the case.</p>',["Send report","Nevermind"],function(e){e&&($.Dialog.wait(!1,"Sending report"),$.post("/episode/broken-videos/"+o,$.mkAjaxHandler(function(){return this.status?("undefined"!=typeof this.epsection&&(this.epsection.length>0?(i.html(this.epsection),t()):i.remove()),void $.Dialog.success(!1,this.message,!0)):$.Dialog.fail(!1,this.message)})))})})}}var i=window.SEASON,a=window.EPISODE,o="S"+i+"E"+a;window._HighlightHash=function(e){$(".highlight").removeClass("highlight");var t=$(location.hash);return!!t.length&&(t.addClass("highlight"),void setTimeout(function(){$.scrollTo(t.offset().top-$navbar.outerHeight()-10,500,function(){"object"===("undefined"==typeof e?"undefined":_typeof(e))&&"load"===e.type&&$.Dialog.close()})},1))},$w.on("hashchange",window._HighlightHash);var n=$("#voting");n.on("click",".rate",function(e){e.preventDefault();var t=function(e){return $.mk("label").append($.mk("input").attr({type:"radio",name:"vote",value:e}),$.mk("span")).on("mouseenter mouseleave",function(e){var t=$(this),i=t.parent().find("input:checked"),a=i.parent(),o=t.closest("div").next().children("strong");switch(e.type){case"mouseleave":if(0===a.length){t.siblings().addBack().find(".typcn").attr("class",""),o.text("?");break}t=a;case"mouseenter":t.prevAll().addBack().children("span").attr("class","active"),t.nextAll().children("span").attr("class",""),o.text(t.children("input").attr("value"))}t.siblings().addBack().removeClass("selected"),a.addClass("selected")})},i=$.mk("form").attr("id","star-rating").append($.mk("p").text("Rate the episode on a scale of 1 to 5. This cannot be changed later."),$.mk("div").attr("class","rate").append(t(1),t(2),t(3),t(4),t(5)),$.mk("p").css("font-size","1.1em").append("Your rating: <strong>?</strong>/5")),a=n.children(".rate");$.Dialog.request("Rating "+o,i,"Rate",function(e){e.on("submit",function(t){t.preventDefault();var i=e.mkData();return"undefined"==typeof i.vote?$.Dialog.fail(!1,"Please choose a rating by clicking on one of the muffins"):($.Dialog.wait(!1,"Submitting your rating"),void $.post("/episode/vote/"+o,i,$.mkAjaxHandler(function(){if(!this.status)return $.Dialog.fail(!1,this.message);var e=a.closest("section");e.children("h2").nextAll().remove(),e.append(this.newhtml),n.bindDetails(),$.Dialog.close()})))})})}),n.find("time").data("dyntime-beforeupdate",function(e){if(e.past===!0)return n.children(".rate").length?void 0:($.post("/episode/vote/"+o+"?html",$.mkAjaxHandler(function(){return this.status?(n.children("h2").nextAll().remove(),n.append(this.html),void n.bindDetails()):$.Dialog.fail("Display voting buttons",this.message)})),$(this).removeData("dyntime-beforeupdate"),!1)}),$.fn.bindDetails=function(){$(this).find("a.detail").on("click",function(e){e.preventDefault(),e.stopPropagation(),$.Dialog.wait("Voting details","Getting vote distribution information"),$.post("/episode/vote/"+o+"?detail",$.mkAjaxHandler(function(){if(!this.status)return $.Dialog.fail(!1,this.message);var e=$.mk("canvas"),t=e.get(0).getContext("2d"),i=$.mk("p").attr("class","tooltip");$.Dialog.info(!1,[$.mk("p").text("Here’s a chart showing how the votes are distributed. Mouse over the different segments to see the exact number of votes."),$.mk("div").attr("id","vote-distrib").append(e,i)]);var a=[void 0,"#FF5454","#FFB554","#FFFF54","#8CD446","#4DC742"],o=this.data,n=0;return o.datasets[0].backgroundColor=[],o.datasets[0].hoverBackgroundColor=[],o.datasets[0].borderWidth=[],o.datasets[0].hoverBorderColor=[],$.each(o.datasets[0].data,function(e,t){var i=a[parseInt(o.labels[e],10)];o.datasets[0].backgroundColor.push(i);var r=$.hex2rgb(i),s=1.06;r.r=Math.round(Math.min(255,r.r*s)),r.g=Math.round(Math.min(255,r.g*s)),r.b=Math.round(Math.min(255,r.b*s)),o.datasets[0].hoverBackgroundColor.push($.rgb2hex(r)),o.datasets[0].borderWidth.push(2),o.datasets[0].hoverBorderColor.push("rgba("+r.r+","+r.g+","+r.b+",0.9)"),n+=parseInt(t,10)}),0===n?(e.remove(),void i.text("There are no votes for this episode yet")):void new Chart(t,{type:"pie",data:o,options:{titleFontColor:"#000",bodyFontColor:"#000",animation:{easing:"easeInOutExpo"},legend:{display:!1},tooltips:{callbacks:{title:function(e,t){var i=parseInt(t.labels[e[0].index],10);return i+" muffin"+(1!==i?"s":"")},label:function(e,t){var i=parseInt(t.datasets[e.datasetIndex].data[e.index],10),a=Math.round(i/n*1e3)/10;return i+" user"+(1!==i?"s":"")+" ("+a+"%)"}}}}})}))})},n.bindDetails(),$.fn.rebindFluidbox=function(){$(this).find(".screencap > a:not(.fluidbox--initialized)").fluidboxThis()},$._getLiTypeId=function(e){var t=e.attr("id").split("-");return{id:t[1],type:t[0]+"s"}},$.fn.rebindHandlers=function(e){var t=e?this:this.find("li[id]");return t.each(function(){var e=$(this),t=$._getLiTypeId(e);e.trigger("bind-more-handlers",[t.id,t.type])}),this.closest("section").rebindFluidbox(),this};var r=function(){var e=$(this),t=$._getLiTypeId(e),i=t.type,a=t.id,o=e.find(".actions").children();e.rebindFluidbox(),o.filter(".share").on("click",function(){var e=$(this),t=window.location.href.replace(/([^:\/]\/).*$/,"$1")+"s/"+e.parents("li").attr("id").replace(/^(re[qs])[^-]+?-(\d+)$/,"$1/$2");$.Dialog.info("Sharing "+i.replace(/s$/,"")+" #"+a,$.mk("div").attr("class","align-center").append("Use the link below to link to this post directly:",$.mk("div").attr("class","share-link").text(t),$.mk("button").attr("class","blue typcn typcn-clipboard").text("Copy to clipboard").on("click",function(e){$.copy(t,e)})),function(){$("#dialogContent").find(".share-link").select()})})};$("#requests, #reservations").on("pls-update",function(e,t,i){var a=$(this),n=a.attr("id"),r=$.capitalize(n),s=n.replace(/([^s])$/,"$1s");i!==!0&&$.Dialog.wait(!$.Dialog.isOpen()&&r,"Updating list of "+s,!0),$.ajax("/episode/postlist/"+o+"?section="+s,{method:"POST",success:$.mkAjaxHandler(function(){if(!this.status)return $.Dialog.fail(!1,this.message);var e=$(this.render).filter("section").children();a.empty().append(e).rebindHandlers(),a.find(".post-form").attr("data-type",n).formBind(),a.find("h2 > button").enable(),Time.Update(),window._HighlightHash(),"function"==typeof t?t():i!==!0&&$.Dialog.close()})})}).on("bind-more-handlers","li[id]",r).find("li[id]").each(r),$.fn.formBind=function(){function e(e){var t=d.data("prev-url"),i="string"==typeof t&&t.trim()===d.val().trim();if(r.attr("disabled",e===!0||i),e===!0||i?r.attr("title","You need to change the URL before chacking again."):r.removeAttr("title"),"keyup"===e.type){var a=d.val();v.test(a)&&d.val(d.val().replace(v,""))}}function t(){var t=d.val(),i=g+" process";r.removeClass("red"),e(!0),$.Dialog.wait(i,"Checking image"),$.post("/post/check-image",{image_url:t},$.mkAjaxHandler(function(){function e(a,o){$.Dialog.wait(i,"Checking image availability"),p.attr("src",a.preview).show().off("load error").on("load",function(){u.children("p:not(.keep)").remove(),d.data("prev-url",t),a.title&&!c.val().trim()?$.Dialog.confirm("Confirm "+f+" title",'The image you just checked had the following title:<br><br><p class="align-center"><strong>'+a.title+"</strong></p><br>Would you like to use this as the "+f+"’s description?<br>Keep in mind that it should describe the thing(s) "+("request"===f?"being requested":"you plan to vector")+".<p>This dialog will not appear if you give your "+f+" a description before clicking the "+m+" button.</p>",function(e){return e?(c.val(a.title),void $.Dialog.close()):n.find("input[name=label]").focus()}):$.Dialog.close(function(){n.find("input[name=label]").focus()})}).on("error",function(){return o<1?($.Dialog.wait("Can’t load image","Image could not be loaded, retrying in 2 seconds"),void setTimeout(function(){e(a,o+1)},2e3)):($.Dialog.fail(i,"There was an error while attempting to load the image. Make sure the URL is correct and try again!"),void r.enable())})}var a=this;return a.status?void e(a,0):(u.children("p:not(.keep)").remove(),u.prepend($.mk("p").attr("class","color-red").html(a.message)).show(),p.hide(),r.enable(),$.Dialog.close())}))}var n=$(this);if(n.length){var r=n.find(".check-img"),s=n.find(".img-preview"),l=n.find("[name=label]"),d=n.find("[name=image_url]"),c=n.find("[name=label]"),u=s.children(".notice"),h=u.html(),p=s.children("img"),f=n.attr("data-type").replace(/s$/,""),g=$.capitalize(f);0===p.length&&(p=$(new Image).appendTo(s)),$("#"+f+"-btn").on("click",function(){n.is(":visible")||(n.removeClass("hidden"),l.focus(),$.scrollTo(n.offset().top-$navbar.outerHeight()-10,500))}),"reservation"===f&&$("#add-reservation-btn").on("click",function(){var e=$.mk("form","add-reservation").html('<div class="notice info">This feature should only be used when the vector was made before the episode was displayed here, and all you want to do is link your already-made vector under the newly posted episode.</div>\n\t\t\t\t<div class="notice warn">If you already posted the reservation, use the <strong class="typcn typcn-attachment">I\'m done</strong> button to mark it as finished instead of adding it here.</div>\n\t\t\t\t<label>\n\t\t\t\t\t<span>Deviation URL</span>\n\t\t\t\t\t<input type="text" name="deviation">\n\t\t\t\t</label>');$.Dialog.request("Add a reservation",e,"Finish",function(e){e.on("submit",function(t){t.preventDefault();var i=e.find("[name=deviation]").val();return"string"!=typeof i||0===i.length?$.Dialog.fail(!1,"Please enter a deviation URL"):($.Dialog.wait(!1,"Adding reservation"),void $.post("/post/add-reservation",{deviation:i,epid:o},$.mkAjaxHandler(function(){return this.status?($.Dialog.success(!1,this.message),void $("#"+f+"s").trigger("pls-update")):$.Dialog.fail(!1,this.message)})))})})}),d.on("keyup change paste",e);var v=/^https?:\/\/www\.deviantart\.com\/users\/outgoing\?/,m='<strong class="typcn typcn-arrow-repeat" style="display:inline-block">Check image</strong>';r.on("click",function(e){e.preventDefault(),t()}),n.on("submit",function(e,t,o){e.preventDefault();var r=g+" process";if("undefined"==typeof d.data("prev-url"))return $.Dialog.fail(r,"Please click the "+m+" button before submitting your "+f+"!");if(!t&&d.data("prev-url")!==d.val())return $.Dialog.confirm(r,"You modified the image URL without clicking the "+m+" button.<br>Do you want to continue with the last checked URL?",function(e){e&&n.triggerHandler("submit",[!0])});if(!o&&"request"===f){var s=function(){var e=l.val(),i=n.find("select");if(e.indexOf("character")>-1&&"chr"!==i.val())return{v:$.Dialog.confirm(r,'Your request label contains the word "character", but the request type isn’t set to Character.<br>Are you sure you\'re not requesting one (or more) character(s)?',["Let me change the type","Carray on"],function(e){return e?void $.Dialog.close(function(){i.focus()}):n.triggerHandler("submit",[t,!0])})}}();if("object"===("undefined"==typeof s?"undefined":_typeof(s)))return s.v}var c=n.mkData({what:f,episode:a,season:i,image_url:d.data("prev-url")});!function e(){$.Dialog.wait(r,"Submitting "+f),$.post("/post/add",c,$.mkAjaxHandler(function(){if(!this.status)return this.canforce?$.Dialog.confirm(!1,this.message,["Go ahead","Nevermind"],function(t){t&&(c.allow_nonmember=!0,e())}):$.Dialog.fail(!1,this.message);$.Dialog.success(!1,g+" posted");var t=this.id;$("#"+f+"s").trigger("pls-update",[function(){$.Dialog.close(),$.Dialog.confirm(g+" posted","Would you like to view it or make another?",["View","Make another"],function(e){$.Dialog.close(),e||$("#"+f+"-btn").trigger("click")}),window.location.hash="#"+t}])}))}()}).on("reset",function(){r.attr("disabled",!1).addClass("red"),u.html(h).show(),p.hide(),d.removeData("prev-url"),$(this).hide()})}};var s=["requests","reservations"],l=0,d={},c=function t(i,a){$.each(s,function(i,o){!function(i){var o=$("#"+i);d[i]!==!0&&($.isInViewport(o.get(0))||a)&&(d[i]=!0,console.log("[DYN-POSTS] Loading %s section (force=%s)",i,a),o.trigger("pls-update",[function(){s.splice(s.indexOf(i),1),console.log("[DYN-POSTS] Loaded %s section",i),2===++l&&($w.off("scroll",t),e(!0))},!0,!0]))}(o)})};$w.on("scroll touchmove",$.throttle(250,c)),c();var u=/^#(request|reservation)-\d+$/,h=location.hash.length>1&&u.test(location.hash);h&&($.Dialog.wait("Scroll post into view","Preloading all posts, please wait"),c(null,!0));var p={};$.fn.reloadLi=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this,i=t.attr("id");if("string"!=typeof i||t.hasClass("admin-break"))return this;if(p[i]===!0)return this;p[i]=!0;var a=i.split("-"),o=a[0],n=a[1];return e&&console.log("[POST-FIX] Attemting to reload "+o+" #"+n),$.post("/post/reload/"+o+"/"+n,{cache:e},$.mkAjaxHandler(function(){if(p[i]=!1,this.status){if(this.broken===!0)return t.remove(),void console.log("[POST-FIX] Hid (broken) "+o+" #"+n);if(0===t.parent().length)return void(e&&console.log("[POST-FIX] Failed attempt at updating detached "+o+" #"+n));var a=$(this.li);(t.hasClass("highlight")||a.is(location.hash))&&a.addClass("highlight"),t.replaceWith(a),a.rebindFluidbox(),Time.Update(),a.rebindHandlers(!0),a.parent().is(this.section)||a.appendTo(this.section),a.parent().reorderPosts(),e&&console.log("[POST-FIX] Reloaded "+o+" #"+n)}})),this},$.fn.reorderPosts=function(){var e=this;e.children().sort(function(e,t){var i=$(e),a=$(t),o=new Date(i.find(".post-date time").attr("datetime")).getTime()-new Date(a.find(".post-date time").attr("datetime")).getTime();return 0===o?parseInt(i.attr("id").replace("/D/g",""),10)-parseInt(a.attr("id").replace("/D/g",""),10):o}).appendTo(e)},window.bindVideoButtons=t,t(),$.WS.recvPostUpdates(!0)},function(){$body.removeClass("fluidbox-open"),$(".fluidbox--opened").fluidbox("close"),"number"==typeof window._rlinterval&&clearInterval(window._rlinterval),$w.off("hashchange",window._HighlightHash),delete window.bindVideoButtons,delete window._HighlightHash,delete $.fn.rebindFluidbox,window.EpisodePage=void 0,$.WS.recvPostUpdates(!1),delete $.fn.reloadLi});
//# sourceMappingURL=/js/min/episode.js.map
