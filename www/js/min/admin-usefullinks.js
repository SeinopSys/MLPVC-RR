"use strict";DocReady.push(function(){function t(t){if("undefined"==typeof l){var i="<select name='minrole' required>\n\t\t\t\t\t<option value='' selected style='display:none'>Select one</option>\n\t\t\t\t\t<optgroup label=\"Available roles\">";$.each(e,function(t,n){"guest"!==t&&"ban"!==t&&(i+='<option value="'+t+'">'+n+"</option>")}),i+="</optgroup></select>",l=$.mk("form","link-editor").html('<label>\n\t\t\t\t\t<span>Label (3-35 chars.)</span>\n\t\t\t\t\t<input type="text" name="label" maxlength="35" pattern="'+n.replace("+","{3,35}")+'" required>\n\t\t\t\t</label>\n\t\t\t\t<label>\n\t\t\t\t\t<span>URL (3-255 chars.)</span>\n\t\t\t\t\t<input type="text" name="url" maxlength="255" pattern="'+n.replace("+","{3,255}")+'" required>\n\t\t\t\t</label>\n\t\t\t\t<label>\n\t\t\t\t\t<span>Title (optional, 3-70 chars.)</span>\n\t\t\t\t\t<input type="text" name="title" maxlength="70" pattern="'+n.replace("+","{3,70}")+'">\n\t\t\t\t</label>\n\t\t\t\t<label>\n\t\t\t\t\t<span>Role required to view</span>\n\t\t\t\t\t'+i+"\n\t\t\t\t</label>").on("submit",function(n){n.preventDefault();var e=$(this).serialize();$.Dialog.wait(!1),$.post("/admin/usefullinks?action="+(t?"set&linkid="+t:"make"),e,$.mkAjaxHandler(function(){return this.status?($.Dialog.wait(!1,"Reloading page",!0),void $.Navigation.reload(function(){$.Dialog.close()})):$.Dialog.fail(!1,this.message)}))})}return l.clone(!0,!0)}var n=$.attributifyRegex(window.PRINTABLE_ASCII_PATTERN),e=window.ROLES_ASSOC,i=$(".useful-links").find("ol"),a=$("#sidebar").find(".welcome .links"),l=void 0;i.on("click",".edit-link",function(){var n=$(this).closest("[id^=ufl-]").attr("id").substring(4);$.Dialog.wait("Editing link #"+n,"Retrieving link information from server"),$.post("/admin/usefullinks?action=get&linkid="+n,$.mkAjaxHandler(function(){if(!this.status)return $.Dialog.fail(!1,this.message);var e=this;$.Dialog.request(!1,t(n),"Save changes",function(t){t.find("input[name=label]").val(e.label),t.find("input[name=url]").val(e.url),t.find("input[name=title]").val(e.title),t.find("select[name=minrole]").val(e.minrole)})}))}),i.on("click",".delete-link",function(){var t=$(this).closest("[id^=ufl-]"),n=t.attr("id").substring(4);$.Dialog.confirm("Delete link #"+n,"Are you sure you want to delete this link?",function(e){e&&($.Dialog.wait(!1,"Removing link"),$.post("/admin/usefullinks?action=del&linkid="+n,$.mkAjaxHandler(function(){return this.status?(t.remove(),$("#s-ufl-"+n).remove(),a.is(":empty")&&a.hide(),void $.Dialog.close()):$.Dialog.fail(!1,this.message)})))})}),$("#add-link").on("click",function(){$.Dialog.request("Add a link",t(),"Add")});var o=$("#reorder-links");o.on("click",function(){o.hasClass("typcn-tick")?!function(){$.Dialog.wait("Re-ordering links");var t=[];i.children().each(function(){t.push($(this).find(".typcn-arrow-move").remove().end().attr("id").split("-").pop())}),$.post("/admin/usefullinks/reorder",{list:t.join(",")},$.mkAjaxHandler(function(){return this.status?($.Dialog.wait(!1,"Reloading page",!0),void $.Navigation.reload(function(){$.Dialog.close()})):$.Dialog.fail(!1,this.message)}))}():(o.removeClass("typcn-arrow-unsorted darkblue").addClass("typcn-tick green").html("Save"),i.addClass("sorting").children().find(".buttons").append('<span class="btn darkblue typcn typcn-arrow-move"></span>'),new Sortable(i.get(0),{ghostClass:"moving",scroll:!0,animation:150,handle:".typcn-arrow-move"}))})});
//# sourceMappingURL=/js/min/admin-usefullinks.js.map
