'use strict';DocReady.push(function(){'use strict';function a(a){if('undefined'==typeof b){var e='<select name=\'minrole\' required>\n\t\t\t\t\t<option value=\'\' selected style=\'display:none\'>Select one</option>\n\t\t\t\t\t<optgroup label="Available roles">';$.each(d,function(a,b){'guest'===a||'ban'===a||(e+='<option value="'+a+'">'+b+'</option>')}),e+='</optgroup></select>',b=$.mk('form','link-editor').html('<label>\n\t\t\t\t\t<span>Label (3-35 chars.)</span>\n\t\t\t\t\t<input type="text" name="label" maxlength="35" pattern="'+c.replace('+','{3,35}')+'" required>\n\t\t\t\t</label>\n\t\t\t\t<label>\n\t\t\t\t\t<span>URL (3-255 chars.)</span>\n\t\t\t\t\t<input type="text" name="url" maxlength="255" pattern="'+c.replace('+','{3,255}')+'" required>\n\t\t\t\t</label>\n\t\t\t\t<label>\n\t\t\t\t\t<span>Title (optional, 3-70 chars.)</span>\n\t\t\t\t\t<input type="text" name="title" maxlength="70" pattern="'+c.replace('+','{3,70}')+'">\n\t\t\t\t</label>\n\t\t\t\t<label>\n\t\t\t\t\t<span>Role required to view</span>\n\t\t\t\t\t'+e+'\n\t\t\t\t</label>').on('submit',function(b){b.preventDefault();var c=$(this).serialize();$.Dialog.wait(!1),$.post('/admin/usefullinks?action='+(a?'set&linkid='+a:'make'),c,$.mkAjaxHandler(function(){return this.status?void($.Dialog.wait(!1,'Reloading page',!0),$.Navigation.reload(function(){$.Dialog.close()})):$.Dialog.fail(!1,this.message)}))})}return b.clone(!0,!0)}var b,c=$.attributifyRegex(window.PRINTABLE_ASCII_PATTERN),d=window.ROLES_ASSOC,e=$('.useful-links').find('ol'),f=$('#sidebar').find('.welcome .links');e.on('click','.edit-link',function(){var b=$(this).closest('[id^=ufl-]').attr('id').substring(4);$.Dialog.wait('Editing link #'+b,'Retrieving link information from server'),$.post('/admin/usefullinks?action=get&linkid='+b,$.mkAjaxHandler(function(){if(!this.status)return $.Dialog.fail(!1,this.message);var c=this;$.Dialog.request(!1,a(b),'Save changes',function(a){a.find('input[name=label]').val(c.label),a.find('input[name=url]').val(c.url),a.find('input[name=title]').val(c.title),a.find('select[name=minrole]').val(c.minrole)})}))}),e.on('click','.delete-link',function(){var a=$(this).closest('[id^=ufl-]'),b=a.attr('id').substring(4);$.Dialog.confirm('Delete link #'+b,'Are you sure you want to delete this link?',function(c){c&&($.Dialog.wait(!1,'Removing link'),$.post('/admin/usefullinks?action=del&linkid='+b,$.mkAjaxHandler(function(){return this.status?void(a.remove(),$('#s-ufl-'+b).remove(),f.is(':empty')&&f.hide(),$.Dialog.close()):$.Dialog.fail(!1,this.message)})))})}),$('#add-link').on('click',function(){$.Dialog.request('Add a link',a(),'Add')});var g=$('#reorder-links');g.on('click',function(){if(!g.hasClass('typcn-tick'))g.removeClass('typcn-arrow-unsorted darkblue').addClass('typcn-tick green').html('Save'),e.addClass('sorting').children().find('.buttons').append('<span class="btn darkblue typcn typcn-arrow-move"></span>'),new Sortable(e.get(0),{ghostClass:'moving',scroll:!0,animation:150,handle:'.typcn-arrow-move'});else{$.Dialog.wait('Re-ordering links');var a=[];e.children().each(function(){a.push($(this).find('.typcn-arrow-move').remove().end().attr('id').split('-').pop())}),$.post('/admin/usefullinks/reorder',{list:a.join(',')},$.mkAjaxHandler(function(){return this.status?void($.Dialog.wait(!1,'Reloading page',!0),$.Navigation.reload(function(){$.Dialog.close()})):$.Dialog.fail(!1,this.message)}))}})});
//# sourceMappingURL=/js/min/admin-usefullinks.js.map
