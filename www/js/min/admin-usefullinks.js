"use strict";DocReady.push(function(){function t(t){if(void 0===l){var i="<select name='minrole' required>\n\t\t\t\t\t<option value='' selected style='display:none'>Select one</option>\n\t\t\t\t\t<optgroup label=\"Available roles\">";$.each(n,function(t,e){"guest"!==t&&"ban"!==t&&(i+='<option value="'+t+'">'+e+"</option>")}),i+="</optgroup></select>",l=$.mk("form","link-editor").html('<label>\n\t\t\t\t\t<span>Label (3-35 chars.)</span>\n\t\t\t\t\t<input type="text" name="label" maxlength="35" pattern="'+e.replace("+","{3,35}")+'" required>\n\t\t\t\t</label>\n\t\t\t\t<label>\n\t\t\t\t\t<span>URL (3-255 chars.)</span>\n\t\t\t\t\t<input type="text" name="url" maxlength="255" pattern="'+e.replace("+","{3,255}")+'" required>\n\t\t\t\t</label>\n\t\t\t\t<label>\n\t\t\t\t\t<span>Title (optional, 3-70 chars.)</span>\n\t\t\t\t\t<input type="text" name="title" maxlength="70" pattern="'+e.replace("+","{3,70}")+'">\n\t\t\t\t</label>\n\t\t\t\t<label>\n\t\t\t\t\t<span>Role required to view</span>\n\t\t\t\t\t'+i+"\n\t\t\t\t</label>").on("submit",function(e){e.preventDefault();var n=$(this).serialize();$.Dialog.wait(!1),$.post("/admin/usefullinks?action="+(t?"set&linkid="+t:"make"),n,$.mkAjaxHandler(function(){if(!this.status)return $.Dialog.fail(!1,this.message);$.Dialog.wait(!1,"Reloading page",!0),$.Navigation.reload(function(){$.Dialog.close()})}))})}return l.clone(!0,!0)}var e=$.attributifyRegex(window.PRINTABLE_ASCII_PATTERN),n=window.ROLES_ASSOC,i=$(".useful-links").find("ol"),a=$("#sidebar").find(".welcome .links"),l=void 0;i.on("click",".edit-link",function(){var e=$(this).closest("[id^=ufl-]").attr("id").substring(4);$.Dialog.wait("Editing link #"+e,"Retrieving link information from server"),$.post("/admin/usefullinks?action=get&linkid="+e,$.mkAjaxHandler(function(){if(!this.status)return $.Dialog.fail(!1,this.message);var n=this;$.Dialog.request(!1,t(e),"Save changes",function(t){t.find("input[name=label]").val(n.label),t.find("input[name=url]").val(n.url),t.find("input[name=title]").val(n.title),t.find("select[name=minrole]").val(n.minrole)})}))}),i.on("click",".delete-link",function(){var t=$(this).closest("[id^=ufl-]"),e=t.attr("id").substring(4);$.Dialog.confirm("Delete link #"+e,"Are you sure you want to delete this link?",function(n){n&&($.Dialog.wait(!1,"Removing link"),$.post("/admin/usefullinks?action=del&linkid="+e,$.mkAjaxHandler(function(){if(!this.status)return $.Dialog.fail(!1,this.message);t.remove(),$("#s-ufl-"+e).remove(),a.is(":empty")&&a.hide(),$.Dialog.close()})))})}),$("#add-link").on("click",function(){$.Dialog.request("Add a link",t(),"Add")});var o=$("#reorder-links");o.on("click",function(){if(o.hasClass("typcn-tick")){$.Dialog.wait("Re-ordering links");var t=[];i.children().each(function(){t.push($(this).find(".typcn-arrow-move").remove().end().attr("id").split("-").pop())}),$.post("/admin/usefullinks/reorder",{list:t.join(",")},$.mkAjaxHandler(function(){if(!this.status)return $.Dialog.fail(!1,this.message);$.Dialog.wait(!1,"Reloading page",!0),$.Navigation.reload(function(){$.Dialog.close()})}))}else o.removeClass("typcn-arrow-unsorted darkblue").addClass("typcn-tick green").html("Save"),i.addClass("sorting").children().find(".buttons").append('<span class="btn darkblue typcn typcn-arrow-move"></span>'),new Sortable(i.get(0),{ghostClass:"moving",scroll:!0,animation:150,handle:".typcn-arrow-move"})})});
//# sourceMappingURL=/js/min/admin-usefullinks.js.map
