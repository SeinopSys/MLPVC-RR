"use strict";!function(){var e={requestKey:"file",title:"Image upload",accept:"image/*",target:"",helper:!0};$.fn.uploadZone=function(a){var t=(a=$.extend(!0,{},e,a)).title,r=$(this).first(),n=$.mk("input").attr({type:"file",name:a.requestKey,accept:a.accept}),o=void 0;return a.helper&&(o=$.mk("div").addClass("helper")),n.on("set-image",function(e,a){var t=function(){r.removeClass("uploading"),a.path?n.prev().attr("href",a.path).children("img").fadeTo(200,0,function(){var e=$(this);r.addClass("loading"),e.attr("src",a.path).on("load",function(){r.removeClass("loading"),e.fadeTo(200,1)}),r.trigger("uz-uploadfinish",[a])}):r.trigger("uz-uploadfinish",[a])};!0===a.keep_dialog?t():$.Dialog.close(t)}),n.on("dragenter dragleave",function(e){e.stopPropagation(),e.preventDefault(),r["dragenter"===e.type?"addClass":"removeClass"]("drop")}),n.on("change drop",function(e){var i=e.target.files||e.originalEvent.dataTransfer.files;if(void 0===i[0]||!(i[0]instanceof File))return!0;r.trigger("uz-uploadstart").removeClass("drop").addClass("uploading");var s=new FormData;s.append(a.requestKey,i[0]),s.append("CSRF_TOKEN",$.getCSRFToken());var l={url:a.target,type:"POST",contentType:!1,processData:!1,cache:!1,data:s,success:$.mkAjaxHandler(function(){this.status?n.trigger("set-image",[this]):($.Dialog.fail(t,this.message),r.trigger("uz-uploadfinish"))}),complete:function(){r.removeClass("uploading"),a.helper&&o.removeAttr("data-progress"),n.val("")}};a.helper&&(l.xhr=function(){var e=$.ajaxSettings.xhr();return e.upload&&e.upload.addEventListener("progress",function(e){if(!e.lengthComputable||!a.helper)return!0;var t=e.loaded||e.position,r=e.total;o.attr("data-progress",Math.round(t/r*100))},!1),e}),$.ajax(l)}),r.append(n),a.helper&&r.append(o),r}}(jQuery);
//# sourceMappingURL=/js/min/jquery.uploadzone.js.map
