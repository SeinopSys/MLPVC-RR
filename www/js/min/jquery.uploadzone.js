'use strict';(function(){'use strict';var a={requestKey:'file',title:'Image upload',accept:'image/*',target:'',helper:!0};$.fn.uploadZone=function(b){b=$.extend(!0,{},a,b);var c,d=b.title,f=$(this).first(),e=$.mk('input').attr({type:'file',name:b.requestKey,accept:b.accept});return b.helper&&(c=$.mk('div').addClass('helper')),e.on('set-image',function(a,b){$.Dialog.close(function(){f.removeClass('uploading'),e.prev().attr('href',b).children('img').fadeTo(200,0,function(){var a=$(this);f.addClass('loading'),a.attr('src',b).on('load',function(){f.removeClass('loading'),a.fadeTo(200,1)}),f.trigger('uz-uploadfinish')})})}),e.on('dragenter dragleave',function(a){a.stopPropagation(),a.preventDefault(),f['dragenter'===a.type?'addClass':'removeClass']('drop')}),e.on('change drop',function(a){var g=a.target.files||a.originalEvent.dataTransfer.files;if('undefined'==typeof g[0]||!(g[0]instanceof File))return!0;f.trigger('uz-uploadstart').removeClass('drop').addClass('uploading');var h=new FormData;h.append('sprite',g[0]),h.append('CSRF_TOKEN',$.getCSRFToken());var i={url:b.target,type:'POST',contentType:!1,processData:!1,cache:!1,data:h,success:$.mkAjaxHandler(function(){c.removeAttr('data-progress'),e.val(''),this.status?e.trigger('set-image',[this.path]):($.Dialog.fail(d,this.message),f.trigger('uz-uploadfinish').removeClass('uploading'))}),error:function error(a){500===a.status||401===a.status||$.Dialog.fail(d,'Upload failed (HTTP '+a.status+')')}};b.helper&&(i.xhr=function(){var a=$.ajaxSettings.xhr();return a.upload&&a.upload.addEventListener('progress',function(a){if(!a.lengthComputable)return!0;var b=a.loaded||a.position,d=a.total;c.attr('data-progress',Math.round(100*(b/d)))},!1),a}),$.ajax(i)}),f.append(e),b.helper&&f.append(c),f}})(jQuery);
//# sourceMappingURL=/js/min/jquery.uploadzone.js.map
