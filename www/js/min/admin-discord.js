'use strict';DocReady.push(function(){'use strict';function a(a){e.addClass('loading'),$.post('/admin/discord/member-link/get/'+a,$.mkAjaxHandler(function(){if(!this.status)return $.Dialog.fail('Loading binding data',this.message);var a=g.clone(!0,!0);'undefined'!=typeof this.boundto&&a.filter('.bind-status').children('.boundto').append(this.boundto),e.empty().append(a).removeClass('loading')}))}var b=window.USERNAME_REGEX,c=$('#member-search').children('input'),d=$('.discord-members'),e=$('#manage-area'),f=$('#linkof-member'),g=$.mk('div').append($.mk('div').attr('class','bind-status').html('<h3>This member is bound to:</h3><div class="boundto"></div>'),$.mk('div').attr('class','do-bind').append('<h3>Change binding:</h3>',$.mk('form').append($.mk('input').attr({type:'text',placeholder:'Username',required:!0}).patternAttr(b),'<br>',$.mk('button').attr('class','green typcn typcn-refresh').text('Change'),$.mk('button').attr('class','red typcn typcn-user-delete').text('Remove').on('click',function(b){b.preventDefault();var c=d.find('.selected').attr('id').split('-')[1];return isNaN(c)?$.Dialog.fail(!1,'Cannot find Discord user ID'):void $.Dialog.confirm('Remove binding','Are you sure you want to remove this binding?',function(b){b&&($.Dialog.wait(!1),$.post('/admin/discord/member-link/del/'+c,$.mkAjaxHandler(function(){return this.status?void($('#member-'+c).removeClass('bound'),a(c),$.Dialog.close()):$.Dialog.fail(!1,this.message)})))})})).on('submit',function(b){b.preventDefault();var c=$(this),e=c.find('input').val();$.Dialog.confirm('Change binding','Are you sure you want to bind this member to <strong>'+e+'</strong>?',function(b){if(b){var c=d.find('.selected').attr('id').split('-')[1];$.Dialog.wait(!1),$.post('/admin/discord/member-link/set/'+c,{to:e},$.mkAjaxHandler(function(){return this.status?void($('#member-'+c).addClass('bound'),a(c),$.Dialog.close()):$.Dialog.fail(!1,this.message)}))}})}))).children();c.on('keyup change',function(){var a=$(this).val().trim().toLowerCase();0===a.length?d.children().removeClass('hidden').each(function(){$(this).find('.user-data').children().each(function(){var a=$(this);a.html(a.text())})}):d.children().addClass('hidden').filter(function(){var b=$(this),c=b.find('.user-data').children(),d=a.split('#'),e=-1!==b.text().toLowerCase().replace(/\s+#/g,'#').indexOf(a),f=c.eq(0),g=c.eq(1);return f.html(f.text().replace(new RegExp('('+$.escapeRegex(d[0])+')','i'),'<mark>$1</mark>')),g.html(g.text().replace(new RegExp('('+$.escapeRegex(d[0])+('string'==typeof d[1]?$.escapeRegex('#'+d[1]):'')+')','i'),'<mark>$1</mark>')),e}).removeClass('hidden'),0===d.children(':not(.hidden)').length?d.addClass('empty'):d.removeClass('empty')}),d.on('click','li',function(b){b.preventDefault();var c=$(this),d=c.attr('id').split('-')[1],e=c.find('.user-data').children().first().text();c.addClass('selected').siblings().removeClass('selected'),f.empty().append(' of ',$.mk('span').attr('class','color-blue').text(e)),a(d)}),$('#rerequest-members').on('click',function(a){a.preventDefault(),$.Dialog.confirm('Re-request member list','You are about to update the member list. This will update the all locally data stored about the members except for the bindings. Continue?',function(a){a&&($.Dialog.wait(!1),$.post('/admin/discord/member-list',{update:!0},$.mkAjaxHandler(function(){return this.status?void(d.html(this.list),$.Dialog.close()):$.Dialog.fail(!1,this.message)})))})}),$.post('/admin/discord/member-list',$.mkAjaxHandler(function(){return this.status?void d.html(this.list).removeClass('loading'):$.Dialog.fail('Loading member list',this.message)}))});
//# sourceMappingURL=/js/min/admin-discord.js.map
