'use strict';DocReady.push(function(){'use strict';var a=window.PRINTABLE_ASCII_PATTERN,b=window.EVENT_TYPES,c=!!window.EventPage,d=$.mk('select').attr({name:'type',required:!0}).append('<option value="" style="display:none">(choose event type)</option>').on('change',function(){var a=$(this),b='contest'===a.val();a.parent().siblings('.who-vote')[b?'removeClass':'addClass']('hidden').find('select')[b?'enable':'disable']('hidden')}),e=$.mk('optgroup').attr('label','Available types').appendTo(d);$.each(b,function(a,b){e.append('<option value="'+a+'">'+b+'</option>')});var f=$.mk('form','event-editor').append($.mk('label').append('<span>Event name (2-64 chars.)</span>',$.mk('input').attr({type:'text',name:'name',minlength:2,maxlength:64,required:!0}).patternAttr(a)),'<div class="label">\n\t\t\t\t<span>Description (1-3000 chars.)<br>Uses <a href="https://help.github.com/articles/basic-writing-and-formatting-syntax/" target="_blank">Markdown</a> formatting</span>\n\t\t\t\t<div class="ace_editor"></div>\n\t\t\t</div>',$.mk('label').append('<span>Event type (cannot ba changed later)</span>',d),$.mk('label').attr('class','who-vote hidden').append('<span>Who can vote on the entries?</span>','<select name="vote_role" required>\n\t\t\t\t\t<optgroup label="Roles">\n\t\t\t\t\t\t<option value="user" selected>Any DeviantArt User</option>\n\t\t\t\t\t\t<option value="member">Club Members</option>\n\t\t\t\t\t\t<option value="staff">Staff Members</option>\n\t\t\t\t\t</optgroup>\n\t\t\t\t</select>'),$.mk('div').attr('class','label').append('<span>Start date & time</span>',$.mk('div').attr('class','input-group-2').append('<input type="date" name="start_date">','<input type="time" name="start_time">')),$.mk('div').attr('class','notice info align-center').html('Leave <q>Start date & time</q> blank if you want the event to start immediately after you press Add. Always specify times in your computer\'s timezone.'),$.mk('div').attr('class','label').append('<span>End date & time</span>',$.mk('div').attr('class','input-group-2').append('<input type="date" name="end_date" required>','<input type="time" name="end_time" required>')),$.mk('div').attr('class','label').append('<span>Who can enter & how many times?</span>',$.mk('div').attr('class','input-group-2').append('<select name="entry_role" required>\n\t\t\t\t\t\t<optgroup label="Role in the group">\n\t\t\t\t\t\t\t<option value="user" selected>Any DeviantArt User</option>\n\t\t\t\t\t\t\t<option value="member">Club Members</option>\n\t\t\t\t\t\t\t<option value="staff">Staff Members</option>\n\t\t\t\t\t\t</optgroup>\n\t\t\t\t\t\t<optgroup label="Special">\n\t\t\t\t\t\t\t<option value="spec_discord">Discord Server Members</option>\n\t\t\t\t\t\t\t<option value="spec_illustrator">Illustrator Users</option>\n\t\t\t\t\t\t\t<option value="spec_inkscape">Inkscape Users</option>\n\t\t\t\t\t\t\t<option value="spec_ponyscape">Ponyscape Users</option>\n\t\t\t\t\t\t</optgroup>\n\t\t\t\t\t</select>','<input type="text" name="max_entries" pattern="^(0*[1-9]\\d*|[Uu]nlimited|0)$" list="max_entries-list" value="1">\n\t\t\t\t\t<datalist id="max_entries-list" required>\n\t\t\t\t\t\t<option value="Unlimited">\n\t\t\t\t\t\t<option value="1">\n\t\t\t\t\t</datalist>')),$.mk('div').attr('class','notice info align-center').html('Enter <q>0</q> or <q>Unlimited</q> to remove the number of entries cap.')),g=function(a,b,d){var e,g=!!d;if(c){if(!g)return;e=$content.children('h1')}else e=a.siblings().first();$.Dialog.request(b,f.clone(!0,!0),'Save',function(a){var f,h;if($.getAceEditor(!1,'markdown',function(b){try{var c=a.find('.ace_editor').get(0),e=ace.edit(c);h=$.aceInit(e,b),h.setMode(b),h.setUseWrapMode(!0),g&&d.desc_src&&h.setValue(d.desc_src)}catch(a){console.error(a)}}),g){if(f=d.eventID,a.find('input[name=name]').val(d.name),a.find('[name=type]').parent().remove(),a.find('[name=entry_role]').val(d.entry_role),a.find('[name=max_entries]').val(d.max_entries?d.max_entries:'Unlimited'),d.starts_at){var i=moment(d.starts_at);a.find('input[name="start_date"]').val($.momentToYMD(i)),a.find('input[name="start_time"]').val($.momentToHM(i))}if(d.ends_at){var j=moment(d.ends_at);a.find('input[name="end_date"]').val($.momentToYMD(j)),a.find('input[name="end_time"]').val($.momentToHM(j))}}a.on('submit',function(d){d.preventDefault();var i=a.mkData();if(i.description=h.getValue(),i.start_date&&i.start_time){var k=$.mkMoment(i.start_date,i.start_time);i.starts_at=k.toISOString()}var j=$.mkMoment(i.end_date,i.end_time);i.ends_at=j.toISOString(),delete i.start_date,delete i.start_time,delete i.end_date,delete i.end_time,$.Dialog.wait(!1,'Saving changes'),c&&(i.EVENT_PAGE=!0),$.post('/event/'+(g?'set/'+f:'/add'),i,$.mkAjaxHandler(function(){return this.status?void(i=this,g?c?($.Dialog.wait(!1,'Reloading page',!0),$.Navigation.reload(function(){$.Dialog.close()})):(e.text(i.name),i.newurl&&e.attr('href',function(a,b){return b.replace(/\/[^\/]+$/,'/'+i.newurl)}),$.Dialog.close()):($.Dialog.success(b,'Event added'),$.Dialog.wait(b,'Loading event page'),$.Navigation.visit(i.goto,function(){i.info?$.Dialog.info(b,i.info):$.Dialog.close()}))):$.Dialog.fail(!1,this.message)}))})})};$('#add-event').on('click',function(a){a.preventDefault(),g($(this),'Add new event')}),$content.on('click','[id^=event-] .edit-event',function(a){a.preventDefault();var b=$(this),c=b.closest('[id^=event-]'),d=c.attr('id').split('-')[1],e='Editing event #'+d;$.Dialog.wait(e,'Retrieving event details from server'),$.post('/event/get/'+d,$.mkAjaxHandler(function(){if(!this.status)return $.Dialog.fail(!1,this.message);var a=this;a.eventID=d,g(b,e,a)}))}),$content.on('click','[id^=event-] .delete-event',function(a){a.preventDefault();var b=$(this).closest('[id^=event-]'),d=b.attr('id').split('-')[1],e=c?$content.children('h1').text():b.find('.event-name').html();$.Dialog.confirm('Delete event #'+d,'Are you <strong class="color-red"><em>ABSOLUTELY</em></strong> sure you want to delete &ldquo;'+e+'&rdquo; along with all submissions?',function(a){a&&($.Dialog.wait(!1),$.post('/event/del/'+d,$.mkAjaxHandler(function(){return this.status?c?($.Dialog.wait('Navigation','Loading page 1'),void $.Navigation.visit('/events/1',function(){$.Dialog.close()})):void($.Dialog.wait(!1,'Reloading page',!0),$.Navigation.reload(function(){$.Dialog.close()})):$.Dialog.fail(!1,this.message)})))})})});
//# sourceMappingURL=/js/min/events-manage.js.map
