'use strict';DocReady.push(function(){'use strict';var a=window.PRINTABLE_ASCII_PATTERN,b=$('#event-entries'),c=$.mk('form','new-entry').append('<label>\n\t\t\t<span>Entry link</span>\n\t\t\t<input type="url" name="link" required>\n\t\t</label>\n\t\t<div class="notice info">This must point to a deviation on DeviantArt or a Sta.sh upload. A Sta.sh link will not be visible to the public, so use that if you do not want to share the source file with anyone other than the staff. For collaboration events, you only need to submit the source file, we\'ll take care of the rest.</div>',$.mk('label').append('<span>Entry title</span>',$.mk('input').attr({type:'text',name:'title',required:!0,pattern:a.replace('+','{2,64}'),minlength:2,maxlength:64})),'<div class="notice info">Here you can enter the name of the character you\'re submitting for example.</div>\n\t\t<label>\n\t\t\t<span>Preview (optional)</span>\n\t\t\t<input type="url" name="prev_src">\n\t\t</label>\n\t\t<div class="notice info">You can link to a preview of your submission from any of the <a href="/about#supported-providers" target="_blank">suppported image providers</a>. This will show a visual preview alongside your submission on the event page.</div>');$.fn.rebindFluidbox=function(){return this.find('.preview > a:not(.fluidbox--initialized)').fluidboxThis(),this},$('#enter-event').on('click',function(a){a.preventDefault();var d=$(this).closest('[id^=event-]').attr('id').split('-')[1];$.Dialog.wait('New entry','Checking whether you can submit any more entries'),$.post('/event/check-entries/'+d,$.mkAjaxHandler(function(){return this.status?void(this.message&&$.Dialog.success(!1,this.message),$.Dialog.request(!1,c.clone(),'Enter',function(a){a.on('submit',function(c){c.preventDefault();var e=a.mkData();$.Dialog.wait(!1,'Submitting your entry'),$.post('/event/entry/add/'+d,e,$.mkAjaxHandler(function(){return this.status?void(b.html(this.entrylist).rebindFluidbox(),$.Dialog.close()):$.Dialog.fail(!1,this.message)}))})})):$.Dialog.fail(!1,this.message)}))}),b.rebindFluidbox().on('click','.edit-entry',function(a){a.preventDefault();var b=$(this).closest('[id^=entry-]'),d=b.attr('id').split('-')[1];$.Dialog.wait('Editing entry #'+d,'Retrieving entry details from server'),$.post('/event/entry/get/'+d,$.mkAjaxHandler(function(){if(!this.status)return $.Dialog.fail(!1,this.message);var a=this;$.Dialog.request(!1,c.clone(),'Save',function(c){a.link&&c.find('input[name="link"]').val(a.link),a.title&&c.find('input[name="title"]').val(a.title),a.prev_src&&c.find('input[name="prev_src"]').val(a.prev_src),c.on('submit',function(a){a.preventDefault();var e=c.mkData();$.Dialog.wait(!1,'Saving changes'),$.post('/event/entry/set/'+d,e,$.mkAjaxHandler(function(){return this.status?void(b.html(this.entryhtml).rebindFluidbox(),$.Dialog.close()):$.Dialog.fail(!1,this.message)}))})})}))}),b.on('click','.delete-entry',function(a){a.preventDefault();var b=$(this).closest('[id^=entry-]'),c=b.attr('id').split('-')[1],d=b.find('.label').text();$.Dialog.confirm('Withdraw entry #'+c,'Are you sure you want to withdraw the entry <q>'+d+'</q>?',function(a){a&&($.Dialog.wait(!1,'Sending deletion request'),$.post('/event/entry/del/'+c,$.mkAjaxHandler(function(){return this.status?void($.Dialog.close(),b.fadeOut(500,function(){b.remove()})):$.Dialog.fail(!1,this.message)})))})}),b.on('click','.voting > button',function(a){a.preventDefault();var c=$(this),d=c.closest('[id^=entry-]'),e=d.attr('id').split('-')[1],f=c.hasClass('upvote')?1:-1,g=c.hasClass('clicked');c.siblings('button').addBack().disable(),$.post('/event/entry/'+(g?'un':'')+'vote/'+e,{value:f},$.mkAjaxHandler(function(){var a=c.siblings('button');return this.disable||a.addBack().enable(),this.status?void(c[g?'removeClass':'addClass']('clicked'),a.removeClass('clicked'),c.siblings('.score').text(this.score),b.triggerHandler('reorder-items')):$.Dialog.fail('Voting on entry #'+e,this.message)}))}).on('reorder-items',function(){0===b.find('.voting').length||b.children().sort(function(c,a){var b=parseInt($(c).find('.score').text().replace(/^\D/,'-'),10),d=parseInt($(a).find('.score').text().replace(/^\D/,'-'),10);return b<d?1:b>d?-1:0}).appendTo(b)}),$.fn.refreshVoting=function(){var a=this,c=a.attr('id').split('-')[1];$.post('/event/entry/getvote/'+c,$.mkAjaxHandler(function(){return this.status?void(a.find('.voting').replaceWith(this.voting),b.triggerHandler('reorder-items')):$.Dialog.fail('Refresh voting buttons of entry #'+c,this.message)}))},'contest'===window.EventType&&$.WS.recvEntryUpdates(!0)},function(){'use strict';delete $.fn.refreshVoting,delete $.fn.rebindFluidbox,'contest'===window.EventType&&$.WS.recvEntryUpdates(!1)});
//# sourceMappingURL=/js/min/event.js.map
