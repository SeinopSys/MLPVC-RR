{"version":3,"sources":["colorguide-tags.js"],"names":["$","TAG_TYPES_ASSOC","window","$tbody","children","updateList","$tr","title","remove","Dialog","success","this","message","path","location","pathname","length","replace","n","toPage","on","e","preventDefault","$btn","parents","tagName","eq","text","trim","tagID","parseInt","first","className","split","pop","confirm","sure","wait","post","mkAjaxHandler","status","fail","call","not","$form","mk","attr","$select","optgroups","ogorder","each","_","tag","type","$option","tid","name","push","append","key","html","hide","request","$ErrorNotice","handleError","parent","removeClass","addClass","show","find","center","mkData","tagids","TagUseUpdateHandler","successDialog","counts","$ch","last","close","tagIDs","join"],"mappings":"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","file":"colorguide-tags.min.js","sourcesContent":["$(function(){\r\n\tvar TAG_TYPES_ASSOC = window.TAG_TYPES_ASSOC,\r\n\t\t$tbody = $('#tags').children('tbody'),\r\n\t\tupdateList = function($tr, title){\r\n\t\t\t$tr.remove();\r\n\t\t\t$.Dialog.success(title, this.message);\r\n\r\n\t\t\tvar path = window.location.pathname;\r\n\t\t\tif ($tbody.children().length === 0)\r\n\t\t\t\tpath = path.replace(/(\\d+)$/,function(n){ return n > 1 ? n-1 : n });\r\n\t\t\t$.toPage(path,true,true);\r\n\t\t};\r\n\t$tbody.on('click','button',function(e){\r\n\t\te.preventDefault();\r\n\r\n\t\tvar $btn = $(this),\r\n\t\t\t$tr = $btn.parents('tr'),\r\n\t\t\ttagName = $tr.children().eq(1).text().trim(),\r\n\t\t\ttagID = parseInt($tr.children().first().text().trim(), 10),\r\n\t\t\ttitle;\r\n\t\tswitch (this.className.split(' ').pop()){\r\n\t\t\tcase \"delete\":\r\n\t\t\t\ttitle = 'Detele tag: '+tagName;\r\n\r\n\t\t\t\t$.Dialog.confirm(title,\"Deleting this tag will also remove it from every appearance where it's been used.<br>Are you sure?\",['Delete it','Nope'],function(sure){\r\n\t\t\t\t\tif (!sure) return;\r\n\r\n\t\t\t\t\t$.Dialog.wait(title,'Sending removal request');\r\n\r\n\t\t\t\t\t$.post('/colorguide/deltag/'+tagID,$.mkAjaxHandler(function(){\r\n\t\t\t\t\t\tif (!this.status) $.Dialog.fail(title, this.message);\r\n\t\t\t\t\t\tupdateList.call(this, $tr, title);\r\n\t\t\t\t\t}));\r\n\t\t\t\t});\r\n\t\t\tbreak;\r\n\t\t\tcase \"merge\":\r\n\t\t\t\ttitle = 'Merge '+tagName+' into another tag';\r\n\r\n\t\t\t\t$.Dialog.wait(title, 'Retrieving tag list from server');\r\n\r\n\t\t\t\t$.post('/colorguide/gettags',{not:tagID},$.mkAjaxHandler(function(){\r\n\t\t\t\t\tif (!this.length) return $.Dialog.fail(title, this.message);\r\n\r\n\t\t\t\t\tvar $form = $.mk('form').attr('id','tag-merge'),\r\n\t\t\t\t\t\t$select = $.mk('select').attr('required',true).attr('name','targetid'),\r\n\t\t\t\t\t\toptgroups = {}, ogorder = [];\r\n\r\n\t\t\t\t\t$.each(this, function(_, tag){\r\n\t\t\t\t\t\tvar type = tag.type,\r\n\t\t\t\t\t\t\t$option = $.mk('option').attr('value', tag.tid).text(tag.name);\r\n\r\n\t\t\t\t\t\tif (!type) return $select.append($option);\r\n\r\n\t\t\t\t\t\tif (typeof optgroups[type] === 'undefined'){\r\n\t\t\t\t\t\t\toptgroups[type] = $.mk('optgroup').attr('label', TAG_TYPES_ASSOC[type]);\r\n\t\t\t\t\t\t\togorder.push(type);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\toptgroups[type].append($option);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t$.each(ogorder, function(_, key){ $select.append(optgroups[key]) });\r\n\r\n\t\t\t\t\t$form.append(\r\n\t\t\t\t\t\t$.mk('p').text('Merging a tag into another will permanently delete it, while replacing it with the merge target on every appearance which used it.'),\r\n\t\t\t\t\t\t$.mk('label').append(\r\n\t\t\t\t\t\t\t$.mk('span').html('Merge <strong>'+tagName+'</strong> into the following:'),\r\n\t\t\t\t\t\t\t$select\r\n\t\t\t\t\t\t),\r\n\t\t\t\t\t\t$.mk('div').attr('class','notice').hide().html('<p></p>')\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t\t$.Dialog.request(title, $form, 'tag-merge', 'Merge', function($form){\r\n\t\t\t\t\t\tvar $ErrorNotice = $form.children('.notice').children('p'),\r\n\t\t\t\t\t\t\thandleError = function(){\r\n\t\t\t\t\t\t\t\t$ErrorNotice.html(this.message).parent().removeClass('info').addClass('fail').show();\r\n\t\t\t\t\t\t\t\t$form.find('select').attr('disabled', false);\r\n\t\t\t\t\t\t\t\t$.Dialog.center();\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t$form.on('submit',function(e){\r\n\t\t\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t\t\t$ErrorNotice.text('Merging tags...').parent().removeClass('fail').addClass('info').show();\r\n\t\t\t\t\t\t\t$.Dialog.center();\r\n\r\n\t\t\t\t\t\t\t$.post('/colorguide/mergetag/'+tagID,$form.mkData(),function(){\r\n\t\t\t\t\t\t\t\tif (!this.status) handleError.call(this);\r\n\t\t\t\t\t\t\t\tupdateList.call(this, $tr, title);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t}));\r\n\t\t\tbreak;\r\n\t\t\tcase \"refresh\":\r\n\t\t\t\ttitle = 'Refresh use count of '+tagName;\r\n\r\n\t\t\t\t$.Dialog.wait(title, 'Updating use count');\r\n\r\n\t\t\t\t$.post('/colorguide/recounttag',{tagids:tagID}, TagUseUpdateHandler(title));\r\n\t\t\tbreak;\r\n\t\t}\r\n\t});\r\n\r\n\tvar TagUseUpdateHandler = function(title, successDialog){\r\n\t\t\treturn $.mkAjaxHandler(function(){\r\n\t\t\t\tif (!this.status) $.Dialog.fail(title, this.message);\r\n\r\n\t\t\t\tif (this.counts){\r\n\t\t\t\t\tvar counts = this.counts;\r\n\t\t\t\t\t$tbody.children().each(function(){\r\n\t\t\t\t\t\tvar $ch = $(this).children(),\r\n\t\t\t\t\t\t\ttid = parseInt($ch.first().text().trim(), 10);\r\n\r\n\t\t\t\t\t\tif (typeof counts[tid] !== 'undefined')\r\n\t\t\t\t\t\t\t$ch.last().children('span').text(counts[tid]);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (successDialog) $.Dialog.success(title, this.message, true);\r\n\t\t\t\telse $.Dialog.close();\r\n\t\t\t})\r\n\t\t},\r\n\t\t$refresher = $('.refresh-all').on('click',function(){\r\n\t\t\tvar tagIDs = [],\r\n\t\t\t\ttitle = 'Recalculate tag usage data';\r\n\t\t\t$tbody.children().each(function(){\r\n\t\t\t\ttagIDs.push($(this).children().first().text().trim())\r\n\t\t\t});\r\n\r\n\t\t\t$.Dialog.wait(title, 'Updating use count'+(tagIDs.length!==1?'s':''));\r\n\r\n\t\t\t$.post('/colorguide/recounttag',{tagids:tagIDs.join(',')}, TagUseUpdateHandler(title, true));\r\n\t\t});\r\n});\r\n"],"sourceRoot":"/source/"}