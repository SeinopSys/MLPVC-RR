{"version":3,"sources":["colorguide-tags.js"],"names":["DocReady","push","TAG_TYPES_ASSOC","window","$tbody","$","children","updateList","$tr","title","remove","Dialog","success","this","message","path","location","pathname","length","replace","n","toPage","on","e","preventDefault","$btn","parents","tagName","eq","text","trim","tagID","parseInt","first","className","split","pop","confirm","sure","wait","post","mkAjaxHandler","status","fail","call","not","$form","mk","attr","$select","optgroups","ogorder","each","_","tag","type","$option","tid","name","append","key","html","hide","request","$ErrorNotice","handleError","parent","removeClass","addClass","show","find","center","mkData","tagids","TagUseUpdateHandler","successDialog","counts","$ch","last","close","tagIDs","join"],"mappings":"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","file":"colorguide-tags.min.js","sourcesContent":["DocReady.push(function ColorguideTags(){\r\n\tvar TAG_TYPES_ASSOC = window.TAG_TYPES_ASSOC,\r\n\t\t$tbody = $('#tags').children('tbody'),\r\n\t\tupdateList = function($tr, title){\r\n\t\t\t$tr.remove();\r\n\t\t\t$.Dialog.success(title, this.message);\r\n\r\n\t\t\tvar path = window.location.pathname;\r\n\t\t\tif ($tbody.children().length === 0)\r\n\t\t\t\tpath = path.replace(/(\\d+)$/,function(n){ return n > 1 ? n-1 : n });\r\n\t\t\t$.toPage(path,true,true);\r\n\t\t};\r\n\t$tbody.on('click','button',function(e){\r\n\t\te.preventDefault();\r\n\r\n\t\tvar $btn = $(this),\r\n\t\t\t$tr = $btn.parents('tr'),\r\n\t\t\ttagName = $tr.children().eq(1).text().trim(),\r\n\t\t\ttagID = parseInt($tr.children().first().text().trim(), 10),\r\n\t\t\ttitle;\r\n\t\tswitch (this.className.split(' ').pop()){\r\n\t\t\tcase \"delete\":\r\n\t\t\t\ttitle = 'Detele tag: '+tagName;\r\n\r\n\t\t\t\t$.Dialog.confirm(title,\"Deleting this tag will also remove it from every appearance where it's been used.<br>Are you sure?\",['Delete it','Nope'],function(sure){\r\n\t\t\t\t\tif (!sure) return;\r\n\r\n\t\t\t\t\t$.Dialog.wait(title,'Sending removal request');\r\n\r\n\t\t\t\t\t$.post('/colorguide/deltag/'+tagID,$.mkAjaxHandler(function(){\r\n\t\t\t\t\t\tif (!this.status) $.Dialog.fail(title, this.message);\r\n\t\t\t\t\t\tupdateList.call(this, $tr, title);\r\n\t\t\t\t\t}));\r\n\t\t\t\t});\r\n\t\t\tbreak;\r\n\t\t\tcase \"merge\":\r\n\t\t\t\ttitle = 'Merge '+tagName+' into another tag';\r\n\r\n\t\t\t\t$.Dialog.wait(title, 'Retrieving tag list from server');\r\n\r\n\t\t\t\t$.post('/colorguide/gettags',{not:tagID},$.mkAjaxHandler(function(){\r\n\t\t\t\t\tif (!this.length) return $.Dialog.fail(title, this.message);\r\n\r\n\t\t\t\t\tvar $form = $.mk('form').attr('id','tag-merge'),\r\n\t\t\t\t\t\t$select = $.mk('select').attr('required',true).attr('name','targetid'),\r\n\t\t\t\t\t\toptgroups = {}, ogorder = [];\r\n\r\n\t\t\t\t\t$.each(this, function(_, tag){\r\n\t\t\t\t\t\tvar type = tag.type,\r\n\t\t\t\t\t\t\t$option = $.mk('option').attr('value', tag.tid).text(tag.name);\r\n\r\n\t\t\t\t\t\tif (!type) return $select.append($option);\r\n\r\n\t\t\t\t\t\tif (typeof optgroups[type] === 'undefined'){\r\n\t\t\t\t\t\t\toptgroups[type] = $.mk('optgroup').attr('label', TAG_TYPES_ASSOC[type]);\r\n\t\t\t\t\t\t\togorder.push(type);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\toptgroups[type].append($option);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t$.each(ogorder, function(_, key){ $select.append(optgroups[key]) });\r\n\r\n\t\t\t\t\t$form.append(\r\n\t\t\t\t\t\t$.mk('p').text('Merging a tag into another will permanently delete it, while replacing it with the merge target on every appearance which used it.'),\r\n\t\t\t\t\t\t$.mk('label').append(\r\n\t\t\t\t\t\t\t$.mk('span').html('Merge <strong>'+tagName+'</strong> into the following:'),\r\n\t\t\t\t\t\t\t$select\r\n\t\t\t\t\t\t),\r\n\t\t\t\t\t\t$.mk('div').attr('class','notice').hide().html('<p></p>')\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t\t$.Dialog.request(title, $form, 'tag-merge', 'Merge', function($form){\r\n\t\t\t\t\t\tvar $ErrorNotice = $form.children('.notice').children('p'),\r\n\t\t\t\t\t\t\thandleError = function(){\r\n\t\t\t\t\t\t\t\t$ErrorNotice.html(this.message).parent().removeClass('info').addClass('fail').show();\r\n\t\t\t\t\t\t\t\t$form.find('select').attr('disabled', false);\r\n\t\t\t\t\t\t\t\t$.Dialog.center();\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t$form.on('submit',function(e){\r\n\t\t\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t\t\t$ErrorNotice.text('Merging tags&hellip;').parent().removeClass('fail').addClass('info').show();\r\n\t\t\t\t\t\t\t$.Dialog.center();\r\n\r\n\t\t\t\t\t\t\t$.post('/colorguide/mergetag/'+tagID,$form.mkData(),function(){\r\n\t\t\t\t\t\t\t\tif (!this.status) handleError.call(this);\r\n\t\t\t\t\t\t\t\tupdateList.call(this, $tr, title);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t}));\r\n\t\t\tbreak;\r\n\t\t\tcase \"refresh\":\r\n\t\t\t\ttitle = 'Refresh use count of '+tagName;\r\n\r\n\t\t\t\t$.Dialog.wait(title, 'Updating use count');\r\n\r\n\t\t\t\t$.post('/colorguide/recounttag',{tagids:tagID}, TagUseUpdateHandler(title));\r\n\t\t\tbreak;\r\n\t\t}\r\n\t});\r\n\r\n\tvar TagUseUpdateHandler = function(title, successDialog){\r\n\t\t\treturn $.mkAjaxHandler(function(){\r\n\t\t\t\tif (!this.status) $.Dialog.fail(title, this.message);\r\n\r\n\t\t\t\tif (this.counts){\r\n\t\t\t\t\tvar counts = this.counts;\r\n\t\t\t\t\t$tbody.children().each(function(){\r\n\t\t\t\t\t\tvar $ch = $(this).children(),\r\n\t\t\t\t\t\t\ttid = parseInt($ch.first().text().trim(), 10);\r\n\r\n\t\t\t\t\t\tif (typeof counts[tid] !== 'undefined')\r\n\t\t\t\t\t\t\t$ch.last().children('span').text(counts[tid]);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (successDialog) $.Dialog.success(title, this.message, true);\r\n\t\t\t\telse $.Dialog.close();\r\n\t\t\t})\r\n\t\t},\r\n\t\t$refresher = $('.refresh-all').on('click',function(){\r\n\t\t\tvar tagIDs = [],\r\n\t\t\t\ttitle = 'Recalculate tag usage data';\r\n\t\t\t$tbody.children().each(function(){\r\n\t\t\t\ttagIDs.push($(this).children().first().text().trim())\r\n\t\t\t});\r\n\r\n\t\t\t$.Dialog.wait(title, 'Updating use count'+(tagIDs.length!==1?'s':''));\r\n\r\n\t\t\t$.post('/colorguide/recounttag',{tagids:tagIDs.join(',')}, TagUseUpdateHandler(title, true));\r\n\t\t});\r\n});\r\n"],"sourceRoot":"/source/"}