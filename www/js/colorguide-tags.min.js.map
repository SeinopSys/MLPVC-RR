{"version":3,"sources":["colorguide-tags.js"],"names":["$","TAG_TYPES_ASSOC","window","$tbody","children","updateList","$tr","title","remove","Dialog","success","this","message","path","location","pathname","length","replace","n","toPage","on","e","preventDefault","$btn","parents","tagName","parent","prev","text","tagID","parseInt","first","trim","className","split","pop","confirm","sure","wait","post","mkAjaxHandler","status","fail","call","not","$form","mk","attr","$select","optgroups","ogorder","each","_","tag","type","$option","tid","name","push","append","key","html","hide","request","$ErrorNotice","handleError","removeClass","addClass","show","find","center","mkData"],"mappings":"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","file":"colorguide-tags.min.js","sourcesContent":["$(function(){\r\n\tvar TAG_TYPES_ASSOC = window.TAG_TYPES_ASSOC,\r\n\t\t$tbody = $('#tags').children('tbody'),\r\n\t\tupdateList = function($tr, title){\r\n\t\t\t$tr.remove();\r\n\t\t\t$.Dialog.success(title, this.message);\r\n\r\n\t\t\tvar path = window.location.pathname;\r\n\t\t\tif ($tbody.children().length === 0)\r\n\t\t\t\tpath = path.replace(/(\\d+)$/,function(n){ return n > 1 ? n-1 : n });\r\n\t\t\t$.toPage(path,true,true);\r\n\t\t};\r\n\t$tbody.on('click','button',function(e){\r\n\t\te.preventDefault();\r\n\r\n\t\tvar $btn = $(this),\r\n\t\t\t$tr = $btn.parents('tr'),\r\n\t\t\ttagName = $btn.parent().prev().text(),\r\n\t\t\ttagID = parseInt($tr.children().first().text().trim(), 10),\r\n\t\t\ttitle;\r\n\t\tswitch (this.className.split(' ').pop()){\r\n\t\t\tcase \"delete\":\r\n\t\t\t\ttitle = 'Detele tag: '+tagName;\r\n\r\n\t\t\t\t$.Dialog.confirm(title,\"Deleting this tag will also remove it from every appearance where it's been used.<br>Are you sure?\",['Delete it','Nope'],function(sure){\r\n\t\t\t\t\tif (!sure) return;\r\n\r\n\t\t\t\t\t$.Dialog.wait(title,'Sending removal request');\r\n\r\n\t\t\t\t\t$.post('/colorguide/deltag/'+tagID,$.mkAjaxHandler(function(){\r\n\t\t\t\t\t\tif (!this.status) $.Dialog.fail(title, this.message);\r\n\t\t\t\t\t\tupdateList.call(this, $tr, title);\r\n\t\t\t\t\t}));\r\n\t\t\t\t});\r\n\t\t\tbreak;\r\n\t\t\tcase \"merge\":\r\n\t\t\t\ttitle = 'Merge '+tagName+' into another tag';\r\n\r\n\t\t\t\t$.Dialog.wait(title, 'Retrieving tag list from server');\r\n\r\n\t\t\t\t$.post('/colorguide/gettags',{not:tagID},$.mkAjaxHandler(function(){\r\n\t\t\t\t\tif (!this.length) return $.Dialog.fail(title, this.message);\r\n\r\n\t\t\t\t\tvar $form = $.mk('form').attr('id','tag-merge'),\r\n\t\t\t\t\t\t$select = $.mk('select').attr('required',true).attr('name','targetid'),\r\n\t\t\t\t\t\toptgroups = {}, ogorder = [];\r\n\r\n\t\t\t\t\t$.each(this, function(_, tag){\r\n\t\t\t\t\t\tvar type = tag.type,\r\n\t\t\t\t\t\t\t$option = $.mk('option').attr('value', tag.tid).text(tag.name);\r\n\r\n\t\t\t\t\t\tif (!type) return $select.append($option);\r\n\r\n\t\t\t\t\t\tif (typeof optgroups[type] === 'undefined'){\r\n\t\t\t\t\t\t\toptgroups[type] = $.mk('optgroup').attr('label', TAG_TYPES_ASSOC[type]);\r\n\t\t\t\t\t\t\togorder.push(type);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\toptgroups[type].append($option);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t$.each(ogorder, function(_, key){ $select.append(optgroups[key]) });\r\n\r\n\t\t\t\t\t$form.append(\r\n\t\t\t\t\t\t$.mk('p').text('Merging a tag into another will permanently delete it, while replacing it with the merge target on every appearance which used it.'),\r\n\t\t\t\t\t\t$.mk('label').append(\r\n\t\t\t\t\t\t\t$.mk('span').html('Merge <strong>'+tagName+'</strong> into the following:'),\r\n\t\t\t\t\t\t\t$select\r\n\t\t\t\t\t\t),\r\n\t\t\t\t\t\t$.mk('div').attr('class','notice').hide().html('<p></p>')\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t\t$.Dialog.request(title, $form, 'tag-merge', 'Merge', function($form){\r\n\t\t\t\t\t\tvar $ErrorNotice = $form.children('.notice').children('p'),\r\n\t\t\t\t\t\t\thandleError = function(){\r\n\t\t\t\t\t\t\t\t$ErrorNotice.html(this.message).parent().removeClass('info').addClass('fail').show();\r\n\t\t\t\t\t\t\t\t$form.find('select').attr('disabled', false);\r\n\t\t\t\t\t\t\t\t$.Dialog.center();\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t$form.on('submit',function(e){\r\n\t\t\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t\t\t$ErrorNotice.text('Merging tags...').parent().removeClass('fail').addClass('info').show();\r\n\t\t\t\t\t\t\t$.Dialog.center();\r\n\r\n\t\t\t\t\t\t\t$.post('/colorguide/mergetag/'+tagID,$form.mkData(),function(){\r\n\t\t\t\t\t\t\t\tif (!this.status) handleError.call(this);\r\n\t\t\t\t\t\t\t\tupdateList.call(this, $tr, title);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t}));\r\n\t\t\tbreak;\r\n\t\t}\r\n\t});\r\n});\r\n"],"sourceRoot":"/source/"}