DocReady.push(function(){"use strict";function e(e){return $.each(e,function(t,i){e[t]=parseInt(i,10)}),e}function t(t){var i=e(t.split("-"));return i[1]--,i}function i(t){return e(t.split(":"))}function a(e,a,n){var o=t(e),r=i(a),s=new Date(o[0],o[1],o[2],10);return s["set"+(n?"UTC":"")+"Hours"](r[0]),s["set"+(n?"UTC":"")+"Minutes"](r[1]),s}function n(e){var t=$.mk("form").attr("id",e).html('<div class=input-group><input type="number" min="1" max="8" name="season" placeholder="Season #" required><input type="number" min="1" max="26" name="episode" placeholder="Episode #" required></div><label><span>Title (5-35 chars.)</span><input type="text" maxlength="35" name="title" placeholder="Title" pattern="'+c+'" autocomplete="off" required></label><div class="input-group"><input type="date" name="airdate" placeholder="YYYY-MM-DD" required><input type="time" name="airtime" placeholder="HH:MM" required></div><div class="notice info align-center button-here"><p>Specify when the episode will air, in <strong>your computer\'s timezone</strong>.</p></div><label><input type="checkbox" name="twoparter"> Has two parts</label><div class="notice info align-center"><p>If this is checked, only specify the episode number of the first part</p></div>');return $.mk("button").text("Set time to "+p+" this Saturday").on("click",function(e){e.preventDefault(),$(this).parent().prev().children().first().val(l).next().val(p)}).appendTo(t.children(".button-here")),t}function o(e){"string"==typeof e&&(s.html(e),s.children(".empty").length?f.html(f.data("none")).next().show():f.html(f.data("list")).next().hide(),s.trigger("updatetimes")),r.find("tr[data-epid]").each(function(){var e=$(this),t=e.attr("data-epid");e.removeAttr("data-epid").data("epid",t)}),r.find(".edit-episode").off("click").on("click",function(e){e.preventDefault();var t=$(this),i=t.closest("tr").data("epid");$.Dialog.wait("Editing "+i,"Getting episode details from server"),$.post("/episode/"+i,$.mkAjaxHandler(function(){if(!this.status)return $.Dialog.fail(!1,this.message);var e=g.clone(!0,!0);e.find("input[name=twoparter]").prop("checked",!!this.ep.twoparter),delete this.ep.twoparter;var t=a(this.ep.airdate,this.ep.airtime,!0);this.ep.airdate=t.toAirDate(),this.ep.airtime=t.toAirTime();var i=this.epid;delete this.epid,$.each(this.ep,function(t,i){e.find("input[name="+t+"]").val(i)}),$.Dialog.request(!1,e,"editep","Save",function(){$("#editep").on("submit",function(e){e.preventDefault();var t=$(this).mkData(),n=a(t.airdate,t.airtime);delete t.airdate,delete t.airtime,t.airs=n.toISOString(),$.Dialog.wait(!1,"Saving changes"),$.post("/episode/edit/"+i,t,$.mkAjaxHandler(function(){return this.status?($.Dialog.success(!1,"Episode edited"),$.Dialog.wait(!1,"Updating page"),void HandleNav.reload(function(){$.Dialog.close()},1e3)):$.Dialog.fail(!1,this.message)}))})})}))}),r.find(".delete-episode").off("click").on("click",function(e){e.preventDefault();var t=$(this),i=t.closest("tr").data("epid");$.Dialog.confirm("Deleting "+i,"<p>This will remove <strong>ALL</strong><ul><li>requests</li><li>reservations</li><li>video links</li><li>and votes</li></ul>associated with the episode, too.</p><p>Are you sure you want to delete it?</p>",function(e){e&&($.Dialog.wait(!1,"Removing episode"),$.post("/episode/delete/"+i,$.mkAjaxHandler(function(){return this.status?($.Dialog.success(!1,this.message),$.Dialog.wait(!1,"Reloading page"),void HandleNav.reload(function(){$.Dialog.close()},1e3)):$.Dialog.fail(!1,this.message)})))})})}var r=$("#episodes"),s=r.children("tbody");o.call({init:!0});var d=moment().day("Saturday").toDate();d.setUTCHours(15),d.setUTCMinutes(30),Date.prototype.toAirDate=function(){return this.getFullYear()+"-"+$.pad(this.getMonth()+1)+"-"+$.pad(this.getDate())},Date.prototype.toAirTime=function(){return $.pad(this.getHours())+":"+$.pad(this.getMinutes())};var l=d.toAirDate(),p=d.toAirTime(),u=window.EP_TITLE_REGEX,c=u.toString().split("/")[1],h=$("#content"),f=h.children("h1").first(),m=new n("addep"),g=new n("editep");$("#add-episode").on("click",function(e){e.preventDefault(),$.Dialog.request("Add Episode",m.clone(!0,!0),"addep","Add",function(){var e=$("#addep");e.on("submit",function(t){t.preventDefault();var i=e.find("input[name=airdate]").attr("disabled",!0).val(),n=e.find("input[name=airtime]").attr("disabled",!0).val(),o=a(i,n).toISOString(),r=$(this).mkData({airs:o});$.Dialog.wait(!1,"Adding episode to database"),$.post("/episode/add",r,$.mkAjaxHandler(function(){return this.status?($.Dialog.success(!1,this.message),$.Dialog.wait(!1,"Reloading page"),void HandleNav.reload(function(){$.Dialog.close()},1e3)):$.Dialog.fail(!1,this.message)}))})})}),s.on("page-switch",function(){o()})});
//# sourceMappingURL=episodes-manage.min.js.map
