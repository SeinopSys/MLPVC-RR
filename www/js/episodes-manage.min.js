DocReady.push(function(){function e(e){return 10>e?"0"+e:e}function t(e){return $.each(e,function(t,i){e[t]=parseInt(i,10)}),e}function i(e){var i=t(e.split("-"));return i[1]--,i}function a(e){return t(e.split(":"))}function n(e,t,n){var o=i(e),r=a(t),s=new Date(o[0],o[1],o[2],10);return s["set"+(n?"UTC":"")+"Hours"](r[0]),s["set"+(n?"UTC":"")+"Minutes"](r[1]),s}function o(e){var t=$("#upcoming");0===t.length&&e&&(t=$.mk("section").attr("id","upcoming").insertBefore($("#sidebar").children(".welcome, .login")),t.append($.mk("h2").text("Upcoming episodes"),$.mk("ul"))),e?t.children("ul").html(e):t.remove(),window.setCD(),window.updateTimes()}function r(e){var t=$.mk("form").attr("id",e).html('<div class=input-group><input type="number" min="1" max="8" name="season" placeholder="Season #" required><input type="number" min="1" max="26" name="episode" placeholder="Episode #" required></div>			<label><input type="text" maxlength="255" name="title" placeholder="Title" pattern="'+m+'" autocomplete="off" required></label>			<div class="notice info align-center">				<p><strong>Title</strong> must be between 5 and 35 characters.<br>Letters, numbers, and these characters, are allowed:<br>-, apostrophe, !, &, comma.</p>			</div>			<div class="input-group"><input type="date" name="airdate" placeholder="YYYY-MM-DD" required><input type="time" name="airtime" placeholder="HH:MM" required></div>			<div class="notice info align-center button-here">				<p>Specify when the episode will air, in <strong>your computer\'s timezone</strong>.</p>			</div>			<label><input type="checkbox" name="twoparter"> Has two parts</label>			<div class="notice info align-center">				<p>If this is checked, only specify the episode number of the first part</p>			</div>');return $.mk("button").text("Set time to "+c+" this Saturday").on("click",function(e){e.preventDefault(),$(this).parent().prev().children().first().val(u).next().val(c)}).appendTo(t.children(".button-here")),t}function s(e){"string"==typeof e&&(l.html(e),l.children(".empty").length?g.html(g.data("none")).next().show():g.html(g.data("list")).next().hide(),l.trigger("updatetimes")),d.find("tr[data-epid]").each(function(){var e=$(this),t=e.attr("data-epid");e.removeAttr("data-epid").data("epid",t)}),d.find(".edit-episode").off("click").on("click",function(e){e.preventDefault();var t=$(this),i=t.closest("tr").data("epid"),a="Editing "+i;$.Dialog.wait(a,"Getting episode details from server"),$.post("/episode/"+i,$.mkAjaxHandler(function(){if(this.status){var e=D.clone(!0,!0);e.find("input[name=twoparter]").prop("checked",!!this.ep.twoparter),delete this.ep.twoparter;var t=n(this.ep.airdate,this.ep.airtime,!0);this.ep.airdate=t.toAirDate(),this.ep.airtime=t.toAirTime();var i=this.epid;delete this.epid,$.each(this.ep,function(t,i){e.find("input[name="+t+"]").val(i)}),$.Dialog.request("Editing "+i,e,"editep","Save",function(){$("#editep").on("submit",function(e){e.preventDefault();var t=$(this).mkData(),r=n(t.airdate,t.airtime);delete t.airdate,delete t.airtime,t.airs=r.toISOString(),$.Dialog.wait(a,"Saving edits"),$.post("/episode/edit/"+i,t,$.mkAjaxHandler(function(){this.status?(s(this.tbody),o(this.upcoming),$.Dialog.close()):$.Dialog.fail(a,this.message)}))})})}else $.Dialog.fail(a,this.message)}))}),d.find(".delete-episode").off("click").on("click",function(e){e.preventDefault();var t=$(this),i=t.closest("tr").data("epid"),a="Deleting "+i;$.Dialog.confirm(a,"<p>This will remove <strong>ALL</strong><ul><li>requests</li><li>reservations</li><li>video links</li><li>and votes</li></ul>associated with the episode, too.</p><p>Are you sure you want to delete it?</p>",function(e){e&&($.Dialog.wait(a),$.post("/episode/delete/"+i,$.mkAjaxHandler(function(){this.status?(s(this.tbody),o(this.upcoming),$.Dialog.close()):$.Dialog.fail(a,this.message)})))})})}var d=$("#episodes"),l=d.children("tbody");s.call({init:!0});var p=moment().day("Saturday").toDate();p.setUTCHours(15),p.setUTCMinutes(30),Date.prototype.toAirDate=function(){return this.getFullYear()+"-"+e(this.getMonth()+1)+"-"+e(this.getDate())},Date.prototype.toAirTime=function(){return e(this.getHours())+":"+e(this.getMinutes())};var u=p.toAirDate(),c=p.toAirTime(),h=window.EP_TITLE_REGEX,m=h.toString().split("/")[1],f=$("#content"),g=f.children("h1").first(),v=new r("addep"),D=new r("editep");$("#add-episode").on("click",function(e){e.preventDefault();var t="Add Episode";$.Dialog.request(t,v.clone(!0,!0),"addep","Add",function(){var e=$("#addep");e.on("submit",function(i){i.preventDefault();var a=e.find("input[name=airdate]").attr("disabled",!0).val(),r=e.find("input[name=airtime]").attr("disabled",!0).val(),d=n(a,r).toISOString(),l=$(this).mkData({airs:d});$.Dialog.wait(t,"Adding episode to database"),$.post("/episode/add",l,$.mkAjaxHandler(function(){this.status?(s(this.tbody),o(this.upcoming),$.Dialog.close()):$.Dialog.fail(t,this.message)}))})})})});
//# sourceMappingURL=episodes-manage.min.js.map