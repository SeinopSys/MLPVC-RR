{"version":3,"sources":["user-manage.js"],"names":["$","window","ROLES","$w","$content","$name","children","name","text","trim","$roleBadge","find","$currRole","next","currRole","$RoleForm","mk","attr","html","$OptGrp","$banToggle","$changeRole","each","label","append","on","title","Dialog","request","clone","e","preventDefault","tempdata","this","serializeArray","data","i","el","value","wait","post","console","log","trigger","status","ng","badge","close","canbebanned","fail","message","filter","Action","hasClass","action","toLowerCase","replace","$form","$input","val","info","success","role","toggleClass"],"mappings":"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","file":"user-manage.min.js","sourcesContent":["$(function(){\r\n\tif (typeof window.ROLES == null) return;\r\n\tvar $w = $(window),\r\n\t\t$content = $('#content'),\r\n\t\tROLES = window.ROLES,\r\n\t\t$name = $content.children('h1'),\r\n\t\tname = $name.text().trim(),\r\n\t\t$roleBadge = $content.find('.avatar-wrap').children('.badge'),\r\n\t\t$currRole = $name.next(),\r\n\t\tcurrRole = $currRole.children('span').text(),\r\n\t\t$RoleForm = $.mk('form').attr('id','rolemod').html('<select name=newrole required><optgroup label=\"Possible roles\"></optgroup></select>'),\r\n\t\t$OptGrp = $RoleForm.find('optgroup'),\r\n\t\t$banToggle = $('#ban-toggle'),\r\n\t\t$changeRole = $('#change-role');\r\n\r\n\t$.each(ROLES,function(name,label){\r\n\t\t$OptGrp.append('<option value='+name+'>'+label+'</option>');\r\n\t});\r\n\r\n\t$changeRole.on('click',function(){\r\n\t\tvar title = \"Change group\";\r\n\t\t$.Dialog.request(title,$RoleForm.clone(),'rolemod','Change',function(){\r\n\t\t\t$('#rolemod').on('submit',function(e){\r\n\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\tvar tempdata = $(this).serializeArray(), data = {};\r\n\t\t\t\t$.each(tempdata,function(i,el){\r\n\t\t\t\t\tdata[el.name] = el.value;\r\n\t\t\t\t});\r\n\r\n\t\t\t\t$.Dialog.wait(title,'Moving user to the new group');\r\n\r\n\t\t\t\t$.post(\"newgroup/\"+name, data, function(data){\r\n\t\t\t\t\tif (typeof data !== 'object') return console.log(data) && $w.trigger('ajaxerror');\r\n\r\n\t\t\t\t\tif (data.status){\r\n\t\t\t\t\t\t$currRole.children('span').text(currRole = ROLES[data.ng]);\r\n\t\t\t\t\t\t$roleBadge.text(data.badge);\r\n\t\t\t\t\t\t$.Dialog.close();\r\n\r\n\t\t\t\t\t\t$banToggle[(data.canbebanned ? 'remove' : 'add')+'Class']('hidden');\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse $.Dialog.fail(title,data.message);\r\n\t\t\t\t});\r\n\t\t\t}).find('optgroup').children().filter(function(){ return $(this).text() === currRole }).attr('selected', true);\r\n\t\t});\r\n\t});\r\n\t$banToggle.on('click',function(){\r\n\t\tvar Action = ($banToggle.hasClass('un-banish') ? 'Un-ban' : 'Ban')+'ish',\r\n\t\t\taction = Action.toLowerCase(),\r\n\t\t\ttitle = Action+'ing '+name+(action == 'banish' ? ' to the moon':'');\r\n\t\t$.Dialog.request(\r\n\t\t\ttitle,\r\n\t\t\t(\r\n\t\t\t\tAction === 'Banish'\r\n\t\t\t\t? '<p>'+Action+'ing '+name+' will immediately sign them out of every session and won\\'t allow them to log in again. Please, only do this if it\\'s absolutely necessary.</p>'\r\n\t\t\t\t: '<p>'+Action+'ing '+name+' will allow them to sign in to the site again.</p>'\r\n\t\t\t) +\r\n\t\t\t'<form id='+action+'-form>' +\r\n\t\t\t'   <p>Please provide a reason (5-255 chars.) for the '+action.replace(/ish$/,'')+' which will be added to the log entry and appear in the user\\'s ban history.</p>' +\r\n\t\t\t'   <input type=\"text\" name=\"reason\" placeholder=\"Enter a reason\" required pattern=\"^.{5,255}$\">' +\r\n\t\t\t'</form>'+\r\n\t\t\t(Action === 'Banish' ? '<img src=\"/img/ban-before.png\" alt=\"Sad twilight\" height=200>':''),\r\n\t\t\taction+'-form',\r\n\t\t\tAction,\r\n\t\t\tfunction(){\r\n\t\t\t\tvar $form = $('#'+action+'-form'),\r\n\t\t\t\t\t$input = $form.find('input');\r\n\t\t\t\t$input.val(Action+'ing because ');\r\n\t\t\t\t$form.on('submit',function(e){\r\n\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\tvar tempdata = $(this).serializeArray(), data = {};\r\n\t\t\t\t\t$.each(tempdata,function(i,el){\r\n\t\t\t\t\t\tdata[el.name] = el.value;\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t$.Dialog.wait(title, 'Gathering the Elements of Harmony');\r\n\r\n\t\t\t\t\t$.post(action+'/'+name, data, function(data){\r\n\t\t\t\t\t\tif (typeof data !== 'object') return console.log(data) && $w.trigger('ajaxerror');\r\n\r\n\t\t\t\t\t\tif (data.status){\r\n\t\t\t\t\t\t\tif (action === 'banish') $.Dialog.info(title, '<p>What had to be done, has been done.</p><img src=\"/img/ban-after.png\">');\r\n\t\t\t\t\t\t\telse $.Dialog.success(title, data.message, true);\r\n\r\n\t\t\t\t\t\t\t$currRole.children('span').text(currRole = data.role);\r\n\t\t\t\t\t\t\t$roleBadge.text(data.badge);\r\n\r\n\t\t\t\t\t\t\t$banToggle.toggleClass('un-banish banish typcn-world typcn-weather-night');\r\n\t\t\t\t\t\t\t$changeRole.toggleClass('hidden');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse $.Dialog.fail(title,data.message);\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t);\r\n\t});\r\n});\r\n"],"sourceRoot":"/source/"}