DocReady.push(function(){"use strict";function e(e){if("undefined"==typeof t){var a=$.mk("optgroup").attr("label","Available roles"),i=$.mk("select").attr({name:"minrole",required:!0}).append("<option value='' selected default>Select one</option>");delete l.guest,delete l.ban,$.each(l,function(e,t){a.append($.mk("option").attr("value",e).text(t))}),i.append(a),t=$.mk("form").attr("id","link-editor").append($.mk("label").append("<span>Label (3-35 chars.)</span>",$.mk("input").attr({type:"text",name:"label",maxlength:30,pattern:n.replace("+","{3,40}"),required:!0})),$.mk("label").append("<span>URL (3-255 chars.)</span>",$.mk("input").attr({type:"text",name:"url",maxlength:255,required:!0,pattern:n.replace("+","{3,255}")})),$.mk("label").append("<span>Title (optional, 3-70 chars.)</span>",$.mk("input").attr({type:"text",name:"title",maxlength:255,pattern:n.replace("+","{3,255}")})),$.mk("label").append("<span>Role required to view</span>",i)).on("submit",function(t){t.preventDefault();var a=$(this).serialize();$.Dialog.wait(!1),$.post("/admin/usefullinks/"+(e?"set/"+e:"make"),a,$.mkAjaxHandler(function(){return this.status?($.Dialog.wait(!1,"Reloading page",!0),void $.Navigation.reload(function(){$.Dialog.close()})):$.Dialog.fail(!1,this.message)}))})}return t.clone(!0,!0)}var t,a=$(".useful-links").find("ol"),i=$("#sidebar").find(".welcome .links"),n=$.attributifyRegex(window.PRINTABLE_ASCII_PATTERN),l=window.ROLES_ASSOC;a.on("click",".edit-link",function(){var t=$(this).closest("[id^=ufl-]").attr("id").substring(4);$.Dialog.wait("Editing link #"+t,"Retrieving link information from server"),$.post("/admin/usefullinks/get/"+t,$.mkAjaxHandler(function(){if(!this.status)return $.Dialog.fail(!1,this.message);var a=this;$.Dialog.request(!1,e(t),"link-editor","Save changes",function(e){e.find("input[name=label]").val(a.label),e.find("input[name=url]").val(a.url),e.find("input[name=title]").val(a.title),e.find("select[name=minrole]").val(a.minrole)})}))}),a.on("click",".delete-link",function(){var e=$(this).closest("[id^=ufl-]"),t=e.attr("id").substring(4);$.Dialog.confirm("Delete link #"+t,"Are you sure you want to delete this link?",function(a){a&&($.Dialog.wait(!1,"Removing link"),$.post("/admin/usefullinks/del/"+t,$.mkAjaxHandler(function(){return this.status?(e.remove(),$("#s-ufl-"+t).remove(),i.is(":empty")&&i.hide(),void $.Dialog.close()):$.Dialog.fail(!1,this.message)})))})}),$("#add-link").on("click",function(){$.Dialog.request("Add a link",e(),"link-editor","Add")});var o=$("#reorder-links");o.on("click",function(){if(o.hasClass("typcn-tick")){$.Dialog.wait("Re-ordering links");var e=[];a.children().each(function(){e.push($(this).find(".typcn-arrow-move").remove().end().attr("id").split("-").pop())}),$.post("/admin/usefullinks/reorder",{list:e.join(",")},$.mkAjaxHandler(function(){return this.status?($.Dialog.wait(!1,"Reloading page",!0),void $.Navigation.reload(function(){$.Dialog.close()})):$.Dialog.fail(!1,this.message)}))}else o.removeClass("typcn-arrow-unsorted darkblue").addClass("typcn-tick green").html("Save"),a.addClass("sorting").children().find(".buttons").append('<span class="btn darkblue typcn typcn-arrow-move"></span>'),new Sortable(a.get(0),{ghostClass:"moving",scroll:!0,animation:150,handle:".typcn-arrow-move"})}),function(){function e(a,i){if(a.childNodes&&a.childNodes.length>0){var n=a.innerHTML;a.innerHTML="",a.appendChild(i),t(n)}else setTimeout(function(){e(a,i)},20)}function t(e){a.addClass("reading"),e=e.replace(/<img[^>]+>/g,"").match(i);var t={};$.each(e,function(e,a){var i=a.match(n);i&&"undefined"==typeof t[i[1]]&&(t[i[1]]=!0)});var l=Object.keys(t);return console.log(Object.keys(l)),l?($.Dialog.wait("Bulk approve posts","Attempting to approve "+l.length+" post"+(1!==l.length?"s":"")),void $.post("/post/mass-approve",{ids:l.join(",")},$.mkAjaxHandler(function(){if(!this.status)return $.Dialog.fail(!1,this.message);var e=this.message,t=function(){e?$.Dialog.success(!1,e,!0):$.Dialog.close()};this.reload?($.Dialog.wait(!1,"Reloading page"),$.Navigation.reload(t)):t()}))):$.Dialog.fail("No deviations found on the pasted page.")}var a=$(".mass-approve").children(".textarea").on("paste",function(a){var i,n,l,o=this;if(a.originalEvent.clipboardData&&a.originalEvent.clipboardData.types&&a.originalEvent.clipboardData.getData&&(i=a.originalEvent.clipboardData.types,i instanceof DOMStringList&&i.contains("text/html")||i.indexOf&&-1!==i.indexOf("text/html")))return n=a.originalEvent.clipboardData.getData("text/html"),t(n),a.stopPropagation(),a.preventDefault(),!1;for(l=document.createDocumentFragment();o.childNodes.length>0;)l.appendChild(o.childNodes[0]);return e(o,l),!0}),i=/(?:[A-Za-z\-\d]+\.)?deviantart\.com\/art\/(?:[A-Za-z\-\d]+-)?(\d+)/g,n=/\/(?:[A-Za-z\-\d]+-)?(\d+)$/}()});
//# sourceMappingURL=admin.min.js.map
