"use strict";DocReady.push(function(){function e(e){if("undefined"==typeof i){var n="<select name='minrole' required>\n					<option value='' selected style='display:none'>Select one</option>\n					<optgroup label=\"Available roles\">";$.each(l,function(e,t){"guest"!==e&&"ban"!==e&&(n+='<option value="'+e+'">'+t+"</option>")}),n+="</optgroup></select>",i=$.mk("form","link-editor").html('<label>\n					<span>Label (3-35 chars.)</span>\n					<input type="text" name="label" maxlength="35" pattern="'+a.replace("+","{3,35}")+'" required>\n				</label>\n				<label>\n					<span>URL (3-255 chars.)</span>\n					<input type="text" name="url" maxlength="255" pattern="'+a.replace("+","{3,255}")+'" required>\n				</label>\n				<label>\n					<span>Title (optional, 3-70 chars.)</span>\n					<input type="text" name="title" maxlength="70" pattern="'+a.replace("+","{3,70}")+'">\n				</label>\n				<label>\n					<span>Role required to view</span>\n					'+n+"\n				</label>").on("submit",function(n){n.preventDefault();var t=$(this).serialize();$.Dialog.wait(!1),$.post("/admin/usefullinks/"+(e?"set/"+e:"make"),t,$.mkAjaxHandler(function(){return this.status?($.Dialog.wait(!1,"Reloading page",!0),void $.Navigation.reload(function(){$.Dialog.close()})):$.Dialog.fail(!1,this.message)}))})}return i.clone(!0,!0)}var n=$(".useful-links").find("ol"),t=$("#sidebar").find(".welcome .links"),i=void 0,a=$.attributifyRegex(window.PRINTABLE_ASCII_PATTERN),l=window.ROLES_ASSOC;n.on("click",".edit-link",function(){var n=$(this).closest("[id^=ufl-]").attr("id").substring(4);$.Dialog.wait("Editing link #"+n,"Retrieving link information from server"),$.post("/admin/usefullinks/get/"+n,$.mkAjaxHandler(function(){if(!this.status)return $.Dialog.fail(!1,this.message);var t=this;$.Dialog.request(!1,e(n),"Save changes",function(e){e.find("input[name=label]").val(t.label),e.find("input[name=url]").val(t.url),e.find("input[name=title]").val(t.title),e.find("select[name=minrole]").val(t.minrole)})}))}),n.on("click",".delete-link",function(){var e=$(this).closest("[id^=ufl-]"),n=e.attr("id").substring(4);$.Dialog.confirm("Delete link #"+n,"Are you sure you want to delete this link?",function(i){i&&($.Dialog.wait(!1,"Removing link"),$.post("/admin/usefullinks/del/"+n,$.mkAjaxHandler(function(){return this.status?(e.remove(),$("#s-ufl-"+n).remove(),t.is(":empty")&&t.hide(),void $.Dialog.close()):$.Dialog.fail(!1,this.message)})))})}),$("#add-link").on("click",function(){$.Dialog.request("Add a link",e(),"Add")});var o=$("#reorder-links");o.on("click",function(){o.hasClass("typcn-tick")?!function(){$.Dialog.wait("Re-ordering links");var e=[];n.children().each(function(){e.push($(this).find(".typcn-arrow-move").remove().end().attr("id").split("-").pop())}),$.post("/admin/usefullinks/reorder",{list:e.join(",")},$.mkAjaxHandler(function(){return this.status?($.Dialog.wait(!1,"Reloading page",!0),void $.Navigation.reload(function(){$.Dialog.close()})):$.Dialog.fail(!1,this.message)}))}():(o.removeClass("typcn-arrow-unsorted darkblue").addClass("typcn-tick green").html("Save"),n.addClass("sorting").children().find(".buttons").append('<span class="btn darkblue typcn typcn-arrow-move"></span>'),new Sortable(n.get(0),{ghostClass:"moving",scroll:!0,animation:150,handle:".typcn-arrow-move"}))}),function(){function e(e){e=e.replace(/<img[^>]+>/g,"").match(n);var i={};$.each(e,function(e,n){var a=n.match(t);a&&"undefined"==typeof i[a[1]]&&(i[a[1]]=!0)});var a=Object.keys(i);return a?($.Dialog.wait("Bulk approve posts","Attempting to approve "+a.length+" post"+(1!==a.length?"s":"")),void $.post("/post/mass-approve",{ids:a.join(",")},$.mkAjaxHandler(function(){if(!this.status)return $.Dialog.fail(!1,this.message);var e=this.message,n=function(){e?$.Dialog.success(!1,e,!0):$.Dialog.close()};this.reload?($.Dialog.wait(!1,"Reloading page"),$.Navigation.reload(n)):n()}))):$.Dialog.fail("No deviations found on the pasted page.")}$(".mass-approve").children(".textarea").on("paste",function(n){var t=void 0,i=void 0,a=void 0,l=this;if(n.originalEvent.clipboardData&&n.originalEvent.clipboardData.types&&n.originalEvent.clipboardData.getData&&(t=n.originalEvent.clipboardData.types,t instanceof DOMStringList&&t.contains("text/html")||t.indexOf&&-1!==t.indexOf("text/html")))return i=n.originalEvent.clipboardData.getData("text/html"),e(i),n.stopPropagation(),n.preventDefault(),!1;for(a=document.createDocumentFragment();l.childNodes.length>0;)a.appendChild(l.childNodes[0]);return function o(n,t){if(n.childNodes&&n.childNodes.length>0){var i=n.innerHTML;n.innerHTML="",n.appendChild(t),e(i)}else setTimeout(function(){o(n,t)},20)}(l,a),!0});var n=/(?:[A-Za-z\-\d]+\.)?deviantart\.com\/art\/(?:[A-Za-z\-\d]+-)?(\d+)/g,t=/\/(?:[A-Za-z\-\d]+-)?(\d+)$/}()});
//# sourceMappingURL=admin.min.js.map
