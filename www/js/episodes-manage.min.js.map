{"version":3,"sources":["episodes-manage.js"],"names":["$","pad","n","parseIntArray","arr","each","i","el","parseInt","mkDateArray","datestr","s","split","mkTimeArray","timestr","mkDate","utc","dateArr","timeArr","d","Date","UpcomingUpdate","ulContent","$uc","length","mk","attr","insertBefore","children","append","text","html","remove","window","setCD","updateTimesF","EpisodeForm","id","$form","EP_TITLE_HTML_REGEX","time","on","e","preventDefault","this","parent","prev","first","val","date","next","appendTo","Bind","tbody","$eptableBody","$pageTitle","data","show","hide","trigger","$eptable","find","$this","epid","removeAttr","off","closest","title","Dialog","wait","post","mkAjaxHandler","status","$editepWithData","$editep","clone","prop","ep","twoparter","airdate","airtime","toAirDate","toAirTime","k","v","request","mkData","airs","toISOString","upcoming","close","fail","message","confirm","sure","call","init","today","saturday","getTime","setDate","getDate","getDay","setUTCHours","setUTCMinutes","prototype","getFullYear","getMonth","getHours","getMinutes","EP_TITLE_REGEX","toString","$content","$addep"],"mappings":"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","file":"episodes-manage.min.js","sourcesContent":["$(function(){\r\n\tvar $eptable = $('#episodes'),\r\n\t\t$eptableBody = $eptable.children('tbody');\r\n\tBind.call({init:true});\r\n\r\n\tvar today = new Date(),\r\n\t\tsaturday = new Date(today.getTime());\r\n\tsaturday.setDate(saturday.getDate() + 6 - saturday.getDay());\r\n\tsaturday.setUTCHours(15);\r\n\tsaturday.setUTCMinutes(30);\r\n\tfunction pad(n){return n<10?'0'+n:n}\r\n\tfunction parseIntArray(arr){\r\n\t\t$.each(arr,function(i,el){\r\n\t\t\tarr[i] = parseInt(el, 10);\r\n\t\t});\r\n\t\treturn arr;\r\n\t}\r\n\tfunction mkDateArray(datestr){\r\n\t\tvar s = parseIntArray(datestr.split('-'));\r\n\t\ts[1]--;\r\n\t\treturn s;\r\n\t}\r\n\tfunction mkTimeArray(timestr){ return parseIntArray(timestr.split(':')) }\r\n\tfunction mkDate(datestr, timestr, utc){\r\n\t\tvar dateArr = mkDateArray(datestr),\r\n\t\t\ttimeArr = mkTimeArray(timestr),\r\n\t\t\td = new Date(dateArr[0], dateArr[1], dateArr[2], 10);\r\n\t\td['set'+(utc?'UTC':'')+'Hours'](timeArr[0]);\r\n\t\td['set'+(utc?'UTC':'')+'Minutes'](timeArr[1]);\r\n\t\treturn d;\r\n\t}\r\n\tDate.prototype.toAirDate = function(){ return pad(this.getFullYear())+'-'+pad(this.getMonth()+1)+'-'+pad(this.getDate()) };\r\n\tDate.prototype.toAirTime = function(){ return pad(this.getHours())+':'+pad(this.getMinutes()) };\r\n\tvar date = saturday.toAirDate(), time = saturday.toAirTime();\r\n\r\n\tfunction UpcomingUpdate(ulContent){\r\n\t\tvar $uc = $('#upcoming');\r\n\t\tif ($uc.length === 0 && !!ulContent){\r\n\t\t\t$uc = $.mk('section').attr('id', 'upcoming').insertBefore($('#sidebar').children('.welcome, .login'));\r\n\t\t\t$uc.append($.mk('h2').text('Upcoming episodes'),$.mk('ul'));\r\n\t\t}\r\n\r\n\t\tif (ulContent)\r\n\t\t\t$uc.children('ul').html(ulContent);\r\n\t\telse $uc.remove();\r\n\r\n\t\twindow.setCD();\r\n\t\twindow.updateTimesF();\r\n\t}\r\n\r\n\tvar EP_TITLE_REGEX = window.EP_TITLE_REGEX,\r\n\t\tEP_TITLE_HTML_REGEX = EP_TITLE_REGEX.toString().split('/')[1],\r\n\t\t$content = $('#content'),\r\n\t\t$pageTitle = $content.children('h1');\r\n\r\n\tfunction EpisodeForm(id){\r\n\t\tvar $form = $.mk('form').attr('id', id).html(\r\n\t\t\t'<div class=input-group>'+\r\n\t\t\t\t'<input type=\"number\" min=1 max=8 name=season placeholder=\"Season #\" required>'+\r\n\t\t\t\t'<input type=\"number\" min=1 max=26 name=episode placeholder=\"Episode #\" required>'+\r\n\t\t\t'</div>\\\r\n\t\t\t<label><input type=\"text\" maxlength=255 name=title placeholder=Title pattern=\"'+EP_TITLE_HTML_REGEX+'\" autocomplete=off required></label>\\\r\n\t\t\t<div class=\"notice info align-center\">\\\r\n\t\t\t\t<p><strong>Title</strong> must be between 5 and 35 characters.<br>Letters, numbers, and these characters, are allowed:<br>-, apostrophe, !, &, comma.</p>\\\r\n\t\t\t</div>\\\r\n\t\t\t<div class=input-group>'+\r\n\t\t\t\t'<input type=\"date\" name=airdate placeholder=\"YYYY-MM-DD\" required>'+\r\n\t\t\t\t'<input type=\"time\" name=airtime placeholder=\"HH:MM\" required>'+\r\n\t\t\t'</div>\\\r\n\t\t\t<div class=\"notice info align-center button-here\">\\\r\n\t\t\t\t<p>Specify when the episode will air, in <strong>your computer\\'s timezone</strong>.</p>\\\r\n\t\t\t</div>\\\r\n\t\t\t<label><input type=\"checkbox\" name=twoparter> Has two parts</label>\\\r\n\t\t\t<div class=\"notice info align-center\">\\\r\n\t\t\t\t<p>If this is checked, only specify the episode number of the first part</p>\\\r\n\t\t\t</div>');\r\n\r\n\t\t\t$.mk('button').text('Set time to '+time+' this Saturday').on('click',function(e){\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\t$(this).parent().prev().children().first().val(date).next().val(time);\r\n\t\t\t}).appendTo($form.children('.button-here'));\r\n\r\n\t\treturn $form;\r\n\t}\r\n\tvar $addep = new EpisodeForm('addep'),\r\n\t\t$editep = new EpisodeForm('editep');\r\n\r\n\t$('#add-episode').on('click',function(e){\r\n\t\te.preventDefault();\r\n\t\tvar title = 'Add Episode';\r\n\r\n\t\t$.Dialog.request(title,$addep.clone(true, true),'addep','Add',function(){\r\n\t\t\tvar $form = $('#addep');\r\n\t\t\t$form.on('submit',function(e){\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tvar airdate = $form.find('input[name=airdate]').attr('disabled',true).val(),\r\n\t\t\t\t\tairtime = $form.find('input[name=airtime]').attr('disabled',true).val(),\r\n\t\t\t\t\tairs = mkDate(airdate, airtime).toISOString(),\r\n\t\t\t\t\tdata = $(this).mkData({airs:airs});\r\n\r\n\t\t\t\t$.Dialog.wait(title,'Adding episode to database');\r\n\r\n\t\t\t\t$.post('/episode/add', data, $.mkAjaxHandler(function(){\r\n\t\t\t\t\tif (this.status){\r\n\t\t\t\t\t\tBind(this.tbody);\r\n\t\t\t\t\t\tUpcomingUpdate(this.upcoming);\r\n\t\t\t\t\t\t$.Dialog.close();\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse $.Dialog.fail(title,this.message);\r\n\t\t\t\t}));\r\n\t\t\t})\r\n\t\t});\r\n\t});\r\n\r\n\tfunction Bind(tbody){\r\n\t\tif (typeof tbody === 'string'){\r\n\t\t\t$eptableBody.html(tbody);\r\n\t\t\tif ($eptableBody.children('.empty').length)\r\n\t\t\t\t$pageTitle.html($pageTitle.data('none')).next().show();\r\n\t\t\telse $pageTitle.html($pageTitle.data('list')).next().hide();\r\n\t\t\t$eptableBody.trigger('updatetimes');\r\n\t\t}\r\n\t\t$eptable.find('tr[data-epid]').each(function(){\r\n\t\t\tvar $this = $(this),\r\n\t\t\t\tepid = $this.attr('data-epid');\r\n\r\n\t\t\t$this.removeAttr('data-epid').data('epid', epid);\r\n\t\t});\r\n\t\t$eptable.find('.edit-episode').off('click').on('click',function(e){\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\tvar $this = $(this),\r\n\t\t\t\tepid = $this.closest('tr').data('epid'),\r\n\t\t\t\ttitle = 'Editing '+epid;\r\n\r\n\t\t\t$.Dialog.wait(title, 'Getting episode details from server');\r\n\r\n\t\t\t$.post(\"/episode/\"+epid, $.mkAjaxHandler(function(){\r\n\t\t\t\tif (this.status){\r\n\t\t\t\t\tvar $editepWithData = $editep.clone(true, true);\r\n\r\n\t\t\t\t\t$editepWithData.find('input[name=twoparter]').prop('checked',!!this.ep.twoparter);\r\n\t\t\t\t\tdelete this.ep.twoparter;\r\n\r\n\t\t\t\t\tvar d = mkDate(this.ep.airdate, this.ep.airtime, true);\r\n\t\t\t\t\tthis.ep.airdate = d.toAirDate();\r\n\t\t\t\t\tthis.ep.airtime = d.toAirTime();\r\n\r\n\t\t\t\t\tvar epid = this.epid;\r\n\t\t\t\t\tdelete this.epid;\r\n\r\n\t\t\t\t\t$.each(this.ep,function(k,v){\r\n\t\t\t\t\t\t$editepWithData.find('input[name='+k+']').val(v);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t$.Dialog.request('Editing',$editepWithData,'editep','Save',function(){\r\n\t\t\t\t\t\t$('#editep').on('submit',function(e){\r\n\t\t\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t\t\tvar data = $(this).mkData(),\r\n\t\t\t\t\t\t\t\td = mkDate(data.airdate, data.airtime);\r\n\t\t\t\t\t\t\tdelete data.airdate;\r\n\t\t\t\t\t\t\tdelete data.airtime;\r\n\t\t\t\t\t\t\tdata.airs = d.toISOString();\r\n\r\n\t\t\t\t\t\t\t$.Dialog.wait(title,'Saving edits');\r\n\r\n\t\t\t\t\t\t\t$.post('/episode/edit/'+epid, data, $.mkAjaxHandler(function(){\r\n\t\t\t\t\t\t\t\tif (this.status){\r\n\t\t\t\t\t\t\t\t\tBind(this.tbody);\r\n\t\t\t\t\t\t\t\t\tUpcomingUpdate(this.upcoming);\r\n\t\t\t\t\t\t\t\t\t$.Dialog.close();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse $.Dialog.fail(title,this.message);\r\n\t\t\t\t\t\t\t}));\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\telse $.Dialog.fail(title,this.message);\r\n\t\t\t}));\r\n\t\t});\r\n\r\n\t\t$eptable.find('.delete-episode').off('click').on('click',function(e){\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\tvar $this = $(this),\r\n\t\t\t\tepid = $this.closest('tr').data('epid'),\r\n\t\t\t\ttitle = 'Deleting '+epid;\r\n\r\n\t\t\t$.Dialog.confirm(title,'<p>This will remove <strong>ALL</strong><ul><li>requests</li><li>reservations</li><li>video links</li><li>and votes</li></ul>associated with the episode, too.</p><p>Are you sure you want to delete it?</p>',function(sure){\r\n\t\t\t\tif (!sure) return;\r\n\r\n\t\t\t\t$.Dialog.wait(title);\r\n\r\n\t\t\t\t$.post('/episode/delete/'+epid, $.mkAjaxHandler(function(){\r\n\t\t\t\t\t\tif (this.status){\r\n\t\t\t\t\t\t\tBind(this.tbody);\r\n\t\t\t\t\t\t\tUpcomingUpdate(this.upcoming);\r\n\t\t\t\t\t\t\t$.Dialog.close();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse $.Dialog.fail(title,this.message);\r\n\t\t\t\t}));\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n});\r\n"],"sourceRoot":"/source/"}