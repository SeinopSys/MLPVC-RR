{"version":3,"sources":["colorguide-manage.js"],"names":["$","reorder","$this","children","sort","a","b","regex","className","replace","innerHTML","trim","localeCompare","appendTo","ctxmenus","$tags","ctxmenu","text","icon","click","$tag","this","tagName","tagID","attr","match","title","Dialog","wait","post","mkAjaxHandler","status","request","$tagEditForm","clone","$form","find","data","type","prop","each","val","on","e","preventDefault","tempdata","serializeArray","i","el","name","value","console","log","$w","trigger","$affected","tid","qtip","removeAttr","parent","window","tooltips","close","fail","message","confirm","sure","remove","$li","closest","$div","$tagsDiv","ponyID","ponyName","append","document","createElement","center","tags","html","prevAll","triggerHandler","$el","$colorGroups","filter","color","info","Color","first","off","copy","default","triggerItem","TAG_TYPES_ASSOC","isWebkit","documentElement","style","substring","uploadZone","requestKey","accept","target","href","urlToAbsolute","forced","eq","get","next","$_typeSelect","addClass","label","$lbl","$chx","checked","siblings"],"mappings":"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","file":"colorguide-manage.min.js","sourcesContent":["$(function(){\r\n\tvar Color = window.Color, color = window.color, TAG_TYPES_ASSOC = window.TAG_TYPES_ASSOC, $colorGroups,\r\n\t\tisWebkit = 'WebkitAppearance' in document.documentElement.style;\r\n\t$('.upload-wrap').each(function(){\r\n\t\tvar $this = $(this),\r\n\t\t\tponyID = $this.closest('li').attr('id').substring(1);\r\n\r\n\t\t$this.uploadZone({\r\n\t\t\trequestKey: 'sprite',\r\n\t\t\ttitle: 'Upload sprite',\r\n\t\t\taccept: 'image/png',\r\n\t\t\ttarget: '/colorguide/setsprite/'+ponyID,\r\n\t\t}).ctxmenu([\r\n\t\t\t{text: 'Open image in new tab', icon: 'arrow-forward', 'default': true, attr: {\r\n\t\t\t\thref: $this.find('img').attr('src'),\r\n\t\t\t\ttarget: '_blank',\r\n\t\t\t}},\r\n\t\t\t{text: 'Copy image URL', icon: 'clipboard', click: function(){\r\n\t\t\t\t$.copy($.urlToAbsolute($this.find('img').attr('src')));\r\n\t\t\t}},\r\n\t\t\t{text: 'Upload new sprite', icon: 'upload', click: function(){\r\n\t\t\t\t$this.find('input[type=\"file\"]').trigger('click', [true]);\r\n\t\t\t}},\r\n\t\t], 'Sprite image').attr('title', isWebkit ? ' ' : '').on('click',function(e, forced){\r\n\t\t\tif (forced === true) return true;\r\n\r\n\t\t\te.preventDefault();\r\n\t\t\t$this.data('ctxmenu-items').eq(1).children().get(0).click();\r\n\t\t});\r\n\t});\r\n\r\n\t$('#list').find('button.edit').on('click',function(){\r\n\t\t$.Dialog.info('Edit mode triggered', 'yay');\r\n\t}).next().on('click',function(){\r\n\t\tvar $this = $(this),\r\n\t\t\t$li = $this.closest('li'),\r\n\t\t\tponyID = $li.attr('id').substring(1),\r\n\t\t\tponyName = $this.parent().text().trim(),\r\n\t\t\ttitle = 'Deleting appearance: '+ponyName;\r\n\r\n\t\t$.Dialog.confirm(title,'Deleting this appearance will remove <strong>ALL</strong> of its color groups, the colors within them, and the sprite file, if any.<br>Delete anyway?',function(sure){\r\n\t\t\tif (!sure) return;\r\n\r\n\t\t\t$.Dialog.wait(title, 'Sending removal request');\r\n\r\n\t\t\t$.post('/colorguide/delete/'+ponyID,function(data){\r\n\t\t\t\tif (typeof data !== 'object') return console.log(data) && $w.trigger('ajaxerror');\r\n\r\n\t\t\t\tif (data.status){\r\n\t\t\t\t\t$li.remove();\r\n\t\t\t\t\t$.Dialog.close();\r\n\t\t\t\t}\r\n\t\t\t\telse $.Dialog.fail(title, data.message);\r\n\t\t\t});\r\n\t\t})\r\n\t});\r\n\r\n\tvar $tagEditForm = $(document.createElement('form')).attr('id', 'edit-tag');\r\n\t$tagEditForm\r\n\t\t.append('<label><span>Tag name (4-30 chars.)</span><input type=text name=name required pattern=^.{4,30}$ maxlength=30></label>');\r\n\tvar $_typeSelect = $(document.createElement('div')).addClass('type-selector');\r\n\t$.each(TAG_TYPES_ASSOC,function(type, label){\r\n\t\tvar $lbl = $(document.createElement('label')),\r\n\t\t\t$chx = $(document.createElement('input'))\r\n\t\t\t\t.attr({\r\n\t\t\t\t\ttype: 'checkbox',\r\n\t\t\t\t\tname: 'type',\r\n\t\t\t\t\tvalue: type\r\n\t\t\t\t}).on('click',function(){\r\n\t\t\t\t\tif (this.checked)\r\n\t\t\t\t\t\t$(this).parent().siblings().find('input').prop('checked', false);\r\n\t\t\t\t});\r\n\t\t$lbl.append($chx, $(document.createElement('span')).addClass('tag typ-'+type).text(label)).appendTo($_typeSelect);\r\n\t});\r\n\t$tagEditForm.append($(document.createElement('div')).addClass('align-center').append('<span>Tag type (optional)</span><br>',$_typeSelect));\r\n\t$tagEditForm.append($(document.createElement('label')).append('<span>Tag description (max 255 chars., optional)</span><br><textarea name=title maxlength=255></textarea>'));\r\n\r\n\tvar $tags = $('.tags');\r\n\tfunction reorder($this){\r\n\t\t$this.children().sort(function(a, b){\r\n\t\t\tvar regex = /^.*typ-([a-z]+).*$/;\r\n\t\t\ta = [a.className.replace(regex,'$1'), a.innerHTML.trim()];\r\n\t\t\tb = [b.className.replace(regex,'$1'), b.innerHTML.trim()];\r\n\r\n\t\t\tif (a[0] === b[0])\r\n\t\t\t\treturn a[1].localeCompare(b[1]);\r\n\t\t\treturn a[0].localeCompare(b[0]);\r\n\t\t}).appendTo($this);\r\n\t}\r\n\r\n\tfunction ctxmenus(){\r\n\t\t$tags.children(':not(.ctxmenu-bound)').ctxmenu([\r\n\t\t\t{text: 'Edit tag', icon: 'pencil', click: function(){\r\n\t\t\t\tvar $tag = $(this),\r\n\t\t\t\t\ttagName = $tag.text().trim(),\r\n\t\t\t\t\ttagID = $tag.attr('class').match(/id-(\\d+)(?:\\s|$)/)[1],\r\n\t\t\t\t\ttitle = 'Editing tag: '+tagName;\r\n\r\n\t\t\t\t$.Dialog.wait(title, 'Retrieveing tag details from server');\r\n\r\n\t\t\t\t$.post('/colorguide/gettag/'+tagID,$.mkAjaxHandler(function(){\r\n\t\t\t\t\tif (this.status){\r\n\t\t\t\t\t\t$.Dialog.request(title,$tagEditForm.clone(true, true),'edit-tag','Save',function(){\r\n\t\t\t\t\t\t\tvar $form = $('#edit-tag');\r\n\t\t\t\t\t\t\t$form.find('input[name=type][value='+data.type+']').prop('checked', true);\r\n\t\t\t\t\t\t\t$form.find('input[type=text][name], textarea[name]').each(function(){\r\n\t\t\t\t\t\t\t\tvar $this = $(this);\r\n\t\t\t\t\t\t\t\t$this.val(data[$this.attr('name')]);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t$form.on('submit', function(e){\r\n\t\t\t\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t\t\t\tvar tempdata = $(this).serializeArray(), data = {};\r\n\t\t\t\t\t\t\t\t$.each(tempdata,function(i,el){\r\n\t\t\t\t\t\t\t\t\tdata[el.name] = el.value;\r\n\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\t$.Dialog.wait(title, 'Saving changes');\r\n\r\n\t\t\t\t\t\t\t\t$.post('/colorguide/settag/'+tagID,data,function(data){\r\n\t\t\t\t\t\t\t\t\tif (typeof data !== 'object') return console.log(data) && $w.trigger('ajaxerror');\r\n\r\n\t\t\t\t\t\t\t\t\tif (data.status){\r\n\t\t\t\t\t\t\t\t\t\tvar $affected = $('.id-'+data.tid);\r\n\t\t\t\t\t\t\t\t\t\t$affected.qtip('destroy', true);\r\n\t\t\t\t\t\t\t\t\t\tif (data.title) $affected.attr('title', data.title);\r\n\t\t\t\t\t\t\t\t\t\telse $affected.removeAttr('title');\r\n\t\t\t\t\t\t\t\t\t\t$affected\r\n\t\t\t\t\t\t\t\t\t\t\t.attr('class', 'tag id-'+data.tid+(data.type?' typ-'+data.type:''))\r\n\t\t\t\t\t\t\t\t\t\t\t.text(data.name);\r\n\t\t\t\t\t\t\t\t\t\t$affected.parent().each(function(){\r\n\t\t\t\t\t\t\t\t\t\t\treorder($(this));\r\n\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\twindow.tooltips();\r\n\t\t\t\t\t\t\t\t\t\t$.Dialog.close();\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\telse $.Dialog.fail(title, data.message);\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse $.Dialog.fail(title, this.message);\r\n\t\t\t\t}));\r\n\t\t\t}},\r\n\t\t\t{text: 'Delete tag', icon: 'trash', click: function(){\r\n\t\t\t\tvar $tag = $(this),\r\n\t\t\t\t\ttagName = $tag.text().trim(),\r\n\t\t\t\t\ttagID = $tag.attr('class').match(/id-(\\d+)(?:\\s|$)/)[1],\r\n\t\t\t\t\ttitle = 'Detele tag: '+tagName;\r\n\r\n\t\t\t\t$.Dialog.confirm(title,\"By deleting this tag, it'll be removed from every appearance where it's been used.<br>Are you sure?\",['Delete it','Nope'],function(sure){\r\n\t\t\t\t\tif (!sure) return;\r\n\r\n\t\t\t\t\t$.Dialog.wait(title,'Sending removal request');\r\n\r\n\t\t\t\t\t$.post('/colorguide/deltag/'+tagID,$.mkAjaxHandler(function(){\r\n\t\t\t\t\t\tif (this.status){\r\n\t\t\t\t\t\t\tvar $affected = $('.id-'+tagID);\r\n\t\t\t\t\t\t\t$affected.qtip('destroy', true);\r\n\t\t\t\t\t\t\t$affected.remove();\r\n\t\t\t\t\t\t\t$.Dialog.close();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse $.Dialog.fail(title, this.message);\r\n\t\t\t\t\t}));\r\n\t\t\t\t});\r\n\t\t\t}},\r\n\t\t\ttrue,\r\n\t\t\t{text: 'Create new tag', icon: 'plus', click: function(){\r\n\t\t\t\tvar title = 'Create new tag',\r\n\t\t\t\t\t$tag = $(this),\r\n\t\t\t\t\t$li = $tag.closest('li'),\r\n\t\t\t\t\t$div = $tag.closest('div:not([class])'),\r\n\t\t\t\t\t$tagsDiv = $div.children('.tags'),\r\n\t\t\t\t\tponyID = $li.attr('id').replace(/\\D/g, ''),\r\n\t\t\t\t\tponyName = $div.children('strong').text().trim();\r\n\r\n\t\t\t\t$.Dialog.request(title,$tagEditForm.clone(true, true),'edit-tag','Create',function(){\r\n\t\t\t\t\tvar $form = $('#edit-tag');\r\n\t\t\t\t\t$form.append(\r\n\t\t\t\t\t\t$(document.createElement('label'))\r\n\t\t\t\t\t\t\t.append('<input type=checkbox name=addto value='+ponyID+'> Add this tag to the appearance \"'+ponyName+'\" after creation')\r\n\t\t\t\t\t);\r\n\t\t\t\t\t$.Dialog.center();\r\n\t\t\t\t\t$form.on('submit', function(e){\r\n\t\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t\tvar tempdata = $form.serializeArray(), data = {};\r\n\t\t\t\t\t\t$.each(tempdata,function(i,el){\r\n\t\t\t\t\t\t\tdata[el.name] = el.value;\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t$.Dialog.wait(title, 'Creating tag');\r\n\r\n\t\t\t\t\t\t$.post('/colorguide/maketag',data,$.mkAjaxHandler(function(){\r\n\t\t\t\t\t\t\tif (this.status){\r\n\t\t\t\t\t\t\t\tif (this.tags){\r\n\t\t\t\t\t\t\t\t\t$tagsDiv.children('[data-hasqtip]').qtip('destroy', true);\r\n\t\t\t\t\t\t\t\t\t$tagsDiv.html(this.tags);\r\n\t\t\t\t\t\t\t\t\twindow.tooltips();\r\n\t\t\t\t\t\t\t\t\tctxmenus();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t$.Dialog.close();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse $.Dialog.fail(title, this.message);\r\n\t\t\t\t\t\t}));\r\n\t\t\t\t\t});\r\n\t\t\t\t})\r\n\t\t\t}},\r\n\t\t\t{text: 'Enable edit mode (TBI)', icon: 'edit', click: function(){\r\n\t\t\t\t$(this).parent().prevAll('strong').children('button.edit').triggerHandler('click');\r\n\t\t\t}}\r\n\t\t], function($el){ return 'Tag: '+$el.text().trim() });\r\n\r\n\t\t$colorGroups = $('ul.colors').children('li');\r\n\t\t$colorGroups.filter(':not(.ctxmenu-bound)').ctxmenu(\r\n\t\t\t[\r\n\t\t\t\t{text: \"Edit \"+color+\" group (TBI)\", icon: 'pencil', click: function(){\r\n\t\t\t\t\t$.Dialog.info('Edit '+color+' group triggered', 'yay');\r\n\t\t\t\t}},\r\n\t\t\t\t{text: \"Delete \"+color+\" group (TBI)\", icon: 'trash', click: function(){\r\n\t\t\t\t\t// TODO Confirmation\r\n\t\t\t\t\t$.Dialog.info('Delete '+color+' group triggered', 'yay');\r\n\t\t\t\t}},\r\n\t\t\t\t{text: \"Add new group (TBI)\", icon: 'folder-add', click: function(){\r\n\t\t\t\t\t$.Dialog.info('Add new group triggered', 'yay');\r\n\t\t\t\t}},\r\n\t\t\t\t{text: \"Add new \"+color+' (TBI)', icon: 'plus', click: function(){\r\n\t\t\t\t\t$.Dialog.info('Add new color triggered', 'yay');\r\n\t\t\t\t}}\r\n\t\t\t],\r\n\t\t\tfunction($el){ return Color+' group: '+$el.children().first().text().trim().replace(':','') }\r\n\t\t);\r\n\t\t$colorGroups.children('span:not(:first-child)').off('click').on('click',function(e){\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\t$.copy(this.innerHTML.trim());\r\n\t\t}).filter(':not(.ctxmenu-bound)').ctxmenu(\r\n\t\t\t[\r\n\t\t\t\t{text: \"Copy \"+color, icon: 'clipboard', 'default': true, click: function(){\r\n\t\t\t\t\t$.copy(this.innerHTML.trim());\r\n\t\t\t\t}},\r\n\t\t\t\t{text: \"Edit \"+color+' (TBI)', icon: 'pencil (TBI)', click: function(){\r\n\t\t\t\t\t$.Dialog.info('Edit '+color+' triggered', 'yay');\r\n\t\t\t\t}},\r\n\t\t\t\ttrue,\r\n\t\t\t\t{text: \"Edit \"+color+\" group (TBI)\", icon: 'pencil', click: function(){\r\n\t\t\t\t\t$.ctxmenu.triggerItem($(this).parent(), 1);\r\n\t\t\t\t}},\r\n\t\t\t\t{text: \"Delete \"+color+\" group (TBI)\", icon: 'trash', click: function(){\r\n\t\t\t\t\t$.ctxmenu.triggerItem($(this).parent(), 2);\r\n\t\t\t\t}},\r\n\t\t\t\t{text: \"Add new group (TBI)\", icon: 'folder-add', click: function(){\r\n\t\t\t\t\t$.ctxmenu.triggerItem($(this).parent(), 3);\r\n\t\t\t\t}},\r\n\t\t\t\t{text: \"Add new \"+color+' (TBI)', icon: 'plus', click: function(){\r\n\t\t\t\t\t$.ctxmenu.triggerItem($(this).parent(), 4);\r\n\t\t\t\t}}\r\n\t\t\t],\r\n\t\t\tfunction($el){ return 'Color: '+$el.attr('oldtitle') }\r\n\t\t);\r\n\t}\r\n\tctxmenus();\r\n\twindow.ctxmenus = function(){ctxmenus()};\r\n});\r\n"],"sourceRoot":"/source/"}