{"version":3,"sources":["colorguide-manage.js"],"names":["DocReady","push","reorder","$this","children","sort","a","b","regex","className","replace","innerHTML","trim","localeCompare","appendTo","createNewTag","$tag","name","title","$li","closest","$div","$tagsDiv","ponyID","attr","ponyName","text","$","Dialog","request","$tagEditForm","clone","$form","$ErrorNotice","handleError","html","this","message","parent","removeClass","addClass","show","find","center","append","mk","type","val","prop","document","createTextNode","on","e","preventDefault","post","mkData","mkAjaxHandler","status","tags","qtip","window","tooltips","ctxmenus","close","call","CGEditorMaker","$group","dis","jQuery","groupID","substring","parents","$cgEditor","$label","$major","$reason","editing","label","Colors","trigger","data","ponyid","each","$row","$ci","HEX_COLOR_PATTERN","test","colorid","hex","toUpperCase","parseInt","length","JSON","stringify","is","major","reason","cg","cgs","update","$pony","updateTimes","$tags","ctxmenu","icon","click","tagName","tagID","match","wait","tag","$affected","tid","removeAttr","eq","fail","confirm","sure","remove","triggerItem","$el","taglist","Bloodhound","datumTokenizer","tokenizers","obj","whitespace","queryTokenizer","remote","url","wildcard","insertKeys","$input","typeahead","display","source","templates","suggestion","Handlebars","compile","indexOf","keyCode","tag_name","$ponyTags","filter","_focusedElement","focus","cancreate","new_name","nextAll","$colorGroups","color","$colors","last","$cgReordering","$cgs","_","groupid","prependTo","Sortable","get","ghostClass","scroll","animation","join","Color","groupName","first","addItems","uploadZone","requestKey","accept","target","default","href","copy","urlToAbsolute","$uploadInput","$spriteUploadForm","$image_url","stopPropagation","image_url","path","isWebkit","forced","TAG_TYPES_ASSOC","MAX_SIZE","PRINTABLE_ASCII_REGEX","documentElement","style","$list","$ponyEditor","placeholder","pattern","required","maxlength","hide","mkPonyEditor","$ponyLabel","$ponyNotes","notes","cm_favme","insertBefore","success","id","info","one","$body","scrollTop","offset","top","outerHeight","toPage","location","pathname","page","$_typeSelect","$lbl","$chx","value","checked","siblings","$colorPreview","$colorInput","class","toString","autocomplete","spellcheck","$cp","prev","valid","css","next","input","shortHex","f","setTimeout","$colorLabel","$colorActions","mkClrDiv","$cl","$ca","$addBtn","disabled","empty","handle","n"],"mappings":"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","file":"colorguide-manage.min.js","sourcesContent":["DocReady.push(function ColorguideManage(){\r\n\tvar Color = window.Color, color = window.color, TAG_TYPES_ASSOC = window.TAG_TYPES_ASSOC, $colorGroups,\r\n\t\tMAX_SIZE = window.MAX_SIZE, PRINTABLE_ASCII_REGEX = window.PRINTABLE_ASCII_REGEX,\r\n\t\tHEX_COLOR_PATTERN = window.HEX_COLOR_PATTERN, isWebkit = 'WebkitAppearance' in document.documentElement.style;\r\n\r\n\tvar $spriteUploadForm = $.mk('form').attr('id', 'sprite-img').html(\r\n\t\t'<p class=\"align-center\"><a href=\"#upload\">Click here to upload a file</a> (max. '+MAX_SIZE+') or enter a URL below.</p>' +\r\n\t\t'<label><input type=\"text\" name=\"image_url\" placeholder=\"External image URL\" required></label>' +\r\n\t\t'<p class=\"align-center\">The URL will be checked against the supported provider list, and if an image is found, it\\'ll be downloaded to the server and set as this appearance\\'s sprite image.</p>'\r\n\t);\r\n\r\n\tvar $list = $('#list'),\r\n\t\t$ponyEditor = $.mk('form').attr('id','pony-editor')\r\n\t\t\t.append(\r\n\t\t\t\t$.mk('label').append(\r\n\t\t\t\t\t$.mk('span').text('Name (4-70 chars.)'),\r\n\t\t\t\t\t$.mk('input').attr({\r\n\t\t\t\t\t\tname: 'label',\r\n\t\t\t\t\t\tplaceholder: 'Enter a name',\r\n\t\t\t\t\t\tpattern: PRINTABLE_ASCII_REGEX.replace('+', '{4,70}'),\r\n\t\t\t\t\t\trequired: true,\r\n\t\t\t\t\t\tmaxlength: 70\r\n\t\t\t\t\t})\r\n\t\t\t\t),\r\n\t\t\t\t$.mk('label').append(\r\n\t\t\t\t\t$.mk('span').text('Additional notes (255 chars. max, optional)'),\r\n\t\t\t\t\t$.mk('textarea').attr({\r\n\t\t\t\t\t\tname: 'notes',\r\n\t\t\t\t\t\tmaxlength: 255\r\n\t\t\t\t\t})\r\n\t\t\t\t),\r\n\t\t\t\t$.mk('label').append(\r\n\t\t\t\t\t$.mk('span').text('Link to cutie mark (optional)'),\r\n\t\t\t\t\t$.mk('input').attr({\r\n\t\t\t\t\t\tname: 'cm_favme',\r\n\t\t\t\t\t\tplaceholder: 'DeviantArt submission URL',\r\n\t\t\t\t\t})\r\n\t\t\t\t),\r\n\t\t\t\t$.mk('div').attr('class','notice').hide().html('<p></p>')\r\n\t\t\t),\r\n\t\tmkPonyEditor = function($this, title, data){\r\n\t\t\tvar $ponyLabel = $this.parent(),\r\n\t\t\t\t$div = $ponyLabel.parent(),\r\n\t\t\t\t$ponyNotes = $div.children('.notes');\r\n\r\n\t\t\t$.Dialog.request(title,$ponyEditor.clone(),'pony-editor','Save',function($form){\r\n\t\t\t\tvar $ErrorNotice = $form.children('.notice').children('p'),\r\n\t\t\t\t\thandleError = function(){\r\n\t\t\t\t\t\t$ErrorNotice.html(this.message).parent().removeClass('info').addClass('fail').show();\r\n\t\t\t\t\t\t$form.find('input, texarea').attr('disabled', false);\r\n\t\t\t\t\t\t$.Dialog.center();\r\n\t\t\t\t\t},\r\n\t\t\t\t\tediting = !!data;\r\n\t\t\t\tif (editing){\r\n\t\t\t\t\t$form.find('input[name=label]').val(data.label);\r\n\t\t\t\t\t$form.find('textarea').val(data.notes);\r\n\t\t\t\t\t$form.find('input[name=cm_favme]').val(data.cm_favme);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\t$.mk('label').append(\r\n\t\t\t\t\t\t$.mk('input').attr({\r\n\t\t\t\t\t\t\ttype: 'checkbox',\r\n\t\t\t\t\t\t\tname: 'template'\r\n\t\t\t\t\t\t}),\r\n\t\t\t\t\t\t\" Pre-fill with common color groups\"\r\n\t\t\t\t\t).insertBefore($ErrorNotice.parent());\r\n\t\t\t\t\t$.Dialog.center();\r\n\t\t\t\t}\r\n\t\t\t\t$form.on('submit',function(e){\r\n\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t$ErrorNotice.text('Saving changes...').parent().removeClass('fail').addClass('info').show();\r\n\t\t\t\t\t$.Dialog.center();\r\n\r\n\t\t\t\t\t$.post('/colorguide/'+(editing?'set/'+data.ponyID:'make'),$form.mkData(),$.mkAjaxHandler(function(){\r\n\t\t\t\t\t\tif (this.status){\r\n\t\t\t\t\t\t\tif (editing){\r\n\t\t\t\t\t\t\t\t$ponyLabel.children().first().text(this.label);\r\n\t\t\t\t\t\t\t\t$ponyNotes.html(this.notes);\r\n\t\t\t\t\t\t\t\t$.Dialog.close();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t$.Dialog.success(title, this.message, true);\r\n\t\t\t\t\t\t\t\tvar id = this.id, info = this.info;\r\n\t\t\t\t\t\t\t\t$list.one('page-switch',function(e){\r\n\t\t\t\t\t\t\t\t\tvar $pony = $('#p'+id);\r\n\t\t\t\t\t\t\t\t\tif ($pony.length)\r\n\t\t\t\t\t\t\t\t\t\t$body.scrollTop($pony.offset().top - ($pony.outerHeight()/2));\r\n\t\t\t\t\t\t\t\t\tif (info){\r\n\t\t\t\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\t\t\t\t$.Dialog.info(title, info);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t$.toPage(window.location.pathname.replace(/(\\d+)?$/,this.page),true,true);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse handleError.call(this);\r\n\t\t\t\t\t}));\r\n\t\t\t\t})\r\n\t\t\t});\r\n\t\t},\r\n\t\t$cgReordering = $.mk('form').attr('id','cg-reorder').append($.mk('div').attr('class','notice').hide().html('<p></p>'));\r\n\r\n\t$('#new-appearance-btn').on('click',function(){\r\n\t\tmkPonyEditor($(this),'Add new appearance');\r\n\t});\r\n\r\n\tvar $tagEditForm = $.mk('form').attr('id', 'edit-tag');\r\n\t$tagEditForm\r\n\t\t.append('<label><span>Tag name (4-30 chars.)</span><input type=\"text\" name=\"name\" required pattern=\"^.{4,30}$\" maxlength=\"30\"></label>');\r\n\tvar $_typeSelect = $.mk('div').addClass('type-selector');\r\n\t$.each(TAG_TYPES_ASSOC,function(type, label){\r\n\t\tvar $lbl = $.mk('label'),\r\n\t\t\t$chx = $.mk('input')\r\n\t\t\t\t.attr({\r\n\t\t\t\t\ttype: 'checkbox',\r\n\t\t\t\t\tname: 'type',\r\n\t\t\t\t\tvalue: type\r\n\t\t\t\t}).on('click keyup',function(){\r\n\t\t\t\t\tif (this.checked)\r\n\t\t\t\t\t\t$(this).parent().siblings().find('input').prop('checked', false);\r\n\t\t\t\t});\r\n\t\t$lbl.append($chx, $.mk('span').addClass('tag typ-'+type).text(label)).appendTo($_typeSelect);\r\n\t});\r\n\t$tagEditForm.append(\r\n\t\t$.mk('div').addClass('align-center').append('<span>Tag type (optional)</span><br>',$_typeSelect),\r\n\t\t$.mk('label').append('<span>Tag description (max 255 chars., optional)</span><br><textarea name=\"title\" maxlength=\"255\"></textarea>'),\r\n\t\t$.mk('div').attr('class','notice').hide().html('<p></p>')\r\n\t);\r\n\tfunction reorder($this){\r\n\t\t$this.children('.tag').sort(function(a, b){\r\n\t\t\tvar regex = /^.*typ-([a-z]+).*$/;\r\n\t\t\ta = [a.className.replace(regex,'$1'), a.innerHTML.trim()];\r\n\t\t\tb = [b.className.replace(regex,'$1'), b.innerHTML.trim()];\r\n\r\n\t\t\tif (a[0] === b[0])\r\n\t\t\t\treturn a[1].localeCompare(b[1]);\r\n\t\t\treturn a[0].localeCompare(b[0]);\r\n\t\t}).appendTo($this);\r\n\t}\r\n\r\n\tfunction createNewTag($tag, name){\r\n\t\tvar title = 'Create new tag',\r\n\t\t\t$li = $tag.closest('li'),\r\n\t\t\t$div = $tag.closest('div:not([class])'),\r\n\t\t\t$tagsDiv = $div.children('.tags'),\r\n\t\t\tponyID = $li.attr('id').replace(/\\D/g, ''),\r\n\t\t\tponyName = $div.children('strong').text().trim();\r\n\r\n\t\t$.Dialog.request(title,$tagEditForm.clone(true, true),'edit-tag','Create',function($form){\r\n\t\t\tvar $ErrorNotice = $form.children('.notice').children('p'),\r\n\t\t\t\thandleError = function(){\r\n\t\t\t\t\t$ErrorNotice.html(this.message).parent().removeClass('info').addClass('fail').show();\r\n\t\t\t\t\t$form.find('input, texarea').attr('disabled', false);\r\n\t\t\t\t\t$.Dialog.center();\r\n\t\t\t\t};\r\n\t\t\t$form.append(\r\n\t\t\t\t$.mk('label').append(\r\n\t\t\t\t\t$.mk('input').attr({type:'checkbox',name:'addto'}).val(ponyID).prop('checked', typeof name === 'string'),\r\n\t\t\t\t\tdocument.createTextNode(' Add this tag to the appearance \"'+ponyName+'\" after creation')\r\n\t\t\t\t)\r\n\t\t\t);\r\n\t\t\tif (typeof name === 'string') $form.find('input[name=name]').val(name);\r\n\t\t\t$.Dialog.center();\r\n\t\t\t$form.on('submit', function(e){\r\n\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t$ErrorNotice.text('Creating tag...').parent().removeClass('fail').addClass('info').show();\r\n\t\t\t\t$.Dialog.center();\r\n\r\n\t\t\t\t$.post('/colorguide/maketag',$form.mkData(),$.mkAjaxHandler(function(){\r\n\t\t\t\t\tif (this.status){\r\n\t\t\t\t\t\tif (this.tags){\r\n\t\t\t\t\t\t\t$tagsDiv.children('[data-hasqtip]').qtip('destroy', true);\r\n\t\t\t\t\t\t\t$tagsDiv.html(this.tags);\r\n\t\t\t\t\t\t\twindow.tooltips();\r\n\t\t\t\t\t\t\tctxmenus();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t$.Dialog.close();\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse handleError.call(this);\r\n\t\t\t\t}));\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tvar $cgEditor = $.mk('form').attr('id','cg-editor'),\r\n\t\t$colorPreview = $.mk('span').attr('class','clrp'),\r\n\t\t$colorInput =\r\n\t\t\t$.mk('input').attr({\r\n\t\t\t\t'class': 'clri',\r\n\t\t\t\tpattern: HEX_COLOR_PATTERN.toString().replace(/\\//g,''),\r\n\t\t\t\tautocomplete: 'off',\r\n\t\t\t\tspellcheck: 'false',\r\n\t\t\t}).on('keyup change input',function(){\r\n\t\t\t\tvar $this = $(this),\r\n\t\t\t\t\t$cp = $this.prev(),\r\n\t\t\t\t\tvalid = HEX_COLOR_PATTERN.test(this.value);\r\n\t\t\t\tif (valid)\r\n\t\t\t\t\t$cp.removeClass('invalid').css('background-color', this.value.replace(HEX_COLOR_PATTERN, '#$1'));\r\n\t\t\t\telse $cp.addClass('invalid');\r\n\r\n\t\t\t\t$this.next().attr('required', valid);\r\n\t\t\t}).on('paste blur',function(e){\r\n\t\t\t\tvar input = this,\r\n\t\t\t\t\t$input = $(input),\r\n\t\t\t\t\tshortHex = /^#?([A-Fa-f0-9]{3})$/,\r\n\t\t\t\t\tf = function(){\r\n\t\t\t\t\t\tvar val = input.value;\r\n\t\t\t\t\t\tif (shortHex.test(val)){\r\n\t\t\t\t\t\t\tvar match = val.match(shortHex)[1];\r\n\t\t\t\t\t\t\tval = '#'+match[0]+match[0]+match[1]+match[1]+match[2]+match[2];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (HEX_COLOR_PATTERN.test(val)){\r\n\t\t\t\t\t\t\t$input.val(val.replace(HEX_COLOR_PATTERN, '#$1').toUpperCase()).trigger('change');\r\n\t\t\t\t\t\t\tif (e.type !== 'blur')\r\n\t\t\t\t\t\t\t\t$input.next().focus();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t};\r\n\t\t\t\tif (e.type === 'paste') setTimeout(f, 10);\r\n\t\t\t\telse f();\r\n\t\t\t}),\r\n\t\t$colorLabel = $.mk('input').attr({ 'class': 'clrl', pattern: PRINTABLE_ASCII_REGEX.replace('+', '{3,30}') }),\r\n\t\t$colorActions = $.mk('div').attr('class','clra')\r\n\t\t\t.append($.mk('span').attr('class','typcn typcn-minus remove red').on('click',function(){\r\n\t\t\t\t$(this).closest('.clr').remove();\r\n\t\t\t\t$.Dialog.center();\r\n\t\t\t}))\r\n\t\t\t.append($.mk('span').attr('class','typcn typcn-arrow-move move blue')),\r\n\t\tmkClrDiv = function(color){\r\n\t\t\tvar $cp = $colorPreview.clone(),\r\n\t\t\t\t$ci = $colorInput.clone(true, true),\r\n\t\t\t\t$cl = $colorLabel.clone(),\r\n\t\t\t\t$ca = $colorActions.clone(true, true),\r\n\t\t\t\t$el = $.mk('div').attr('class','clr');\r\n\r\n\t\t\tif (typeof color === 'object'){\r\n\t\t\t\tif (color.colorid) $el.data('id', color.colorid);\r\n\t\t\t\tif (color.hex) $ci.val(color.hex);\r\n\t\t\t\tif (color.label) $cl.val(color.label);\r\n\t\t\t}\r\n\r\n\t\t\t$el.append($cp,$ci,$cl,$ca);\r\n\t\t\t$ci.trigger('change');\r\n\t\t\treturn $el;\r\n\t\t},\r\n\t\t$addBtn = $.mk('button').attr('class','typcn typcn-plus green').text('Add new color').on('click',function(e){\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\tvar $form = $(this).parents('#cg-editor'),\r\n\t\t\t\t$colors = $form.children('.clrs');\r\n\t\t\tif (!$colors.length)\r\n\t\t\t\t$form.append($colors = $.mk('div').attr('class', 'clrs'));\r\n\t\t\tvar $div = mkClrDiv();\r\n\t\t\t$colors.append($div);\r\n\t\t\t$div.find('.clri').focus();\r\n\t\t\t$.Dialog.center();\r\n\t\t});\r\n\t$cgEditor.append(\r\n\t\t$.mk('label').append(\r\n\t\t\t$.mk('span').text('Group name (2-30 chars.)'),\r\n\t\t\tmk('br'),\r\n\t\t\t$.mk('input').attr({\r\n\t\t\t\ttype: 'text',\r\n\t\t\t\tname: 'label',\r\n\t\t\t\tpattern: PRINTABLE_ASCII_REGEX.replace('+','{2,30}'),\r\n\t\t\t\trequired: true,\r\n\t\t\t})\r\n\t\t),\r\n\t\t$.mk('label').append(\r\n\t\t\t$.mk('input').attr({\r\n\t\t\t\ttype: 'checkbox',\r\n\t\t\t\tname: 'major',\r\n\t\t\t}).on('click',function(){\r\n\t\t\t\t$(this).parent().next()[this.checked?'show':'hide']().children('input').attr('disabled', !this.checked);\r\n\t\t\t\t$.Dialog.center();\r\n\t\t\t}),\r\n\t\t\t$.mk('span').text('This is a major change')\r\n\t\t),\r\n\t\t$.mk('label').append(\r\n\t\t\t$.mk('span').text('Change reason (1-255 chars.)'),\r\n\t\t\tmk('br'),\r\n\t\t\t$.mk('input').attr({\r\n\t\t\t\ttype: 'text',\r\n\t\t\t\tname: 'reason',\r\n\t\t\t\tpattern: PRINTABLE_ASCII_REGEX.replace('+','{1,255}'),\r\n\t\t\t\trequired: true,\r\n\t\t\t\tdisabled: true,\r\n\t\t\t})\r\n\t\t).hide(),\r\n\t\t$.mk('p').attr('class', 'align-center').text('The # symbol is optional, rows with invalid '+color+'s will be ignored. Each color must have a short (3-30 chars.) description of its intended use.'),\r\n\t\t$addBtn,\r\n\t\t$.mk('div').attr('class', 'clrs'),\r\n\t\t$.mk('div').attr('class','notice').hide().html('<p></p>')\r\n\t).on('render-color-inputs',function(_, data){\r\n\t\tvar $form = $(this),\r\n\t\t\t$colors = $form.children('.clrs').empty();\r\n\r\n\t\t$.each(data, function(_, color){\r\n\t\t\t$colors.append(mkClrDiv(color));\r\n\t\t});\r\n\r\n\t\tnew Sortable($colors.get(0), {\r\n\t\t    handle: \".move\",\r\n\t\t    ghostClass: \"moving\",\r\n\t\t    scroll: false,\r\n\t\t    animation: 150,\r\n\t\t});\r\n\r\n\t\t$.Dialog.center();\r\n\t});\r\n\r\n\tfunction CGEditorMaker(title, $group){\r\n\t\tvar dis = this;\r\n\t\tif (typeof $group !== 'undefined'){\r\n\t\t\tif ($group instanceof jQuery){\r\n\t\t\t\tvar groupID = $group.attr('id').substring(2),\r\n\t\t\t\t\tponyID = $group.parents('li').attr('id').substring(1);\r\n\t\t\t}\r\n\t\t\telse ponyID = $group;\r\n\t\t}\r\n\t\t$.Dialog.request(title,$cgEditor.clone(true, true),'cg-editor','Save',function($form){\r\n\t\t\tvar $ErrorNotice = $form.children('.notice').children('p'),\r\n\t\t\t\thandleError = function(){\r\n\t\t\t\t\t$ErrorNotice.html(this.message).parent().removeClass('info').addClass('fail').show();\r\n\t\t\t\t\t$form.find('input:not([name=reason]), texarea').attr('disabled', false);\r\n\t\t\t\t\t$.Dialog.center();\r\n\t\t\t\t},\r\n\t\t\t\t$label = $form.find('input[name=label]'),\r\n\t\t\t\t$major = $form.find('input[name=major]'),\r\n\t\t\t\t$reason = $form.find('input[name=reason]'),\r\n\t\t\t\tediting = typeof dis === 'object' && dis.label && dis.Colors;\r\n\r\n\t\t\tif (editing){\r\n\t\t\t\t$label.val(dis.label);\r\n\t\t\t\t$form.trigger('render-color-inputs',[dis.Colors]);\r\n\t\t\t}\r\n\t\t\t$form.on('submit',function(e){\r\n\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\tvar data = { label: $label.val(), Colors: [] };\r\n\t\t\t\tif (!editing) data.ponyid = ponyID;\r\n\t\t\t\t$form.find('.clr').each(function(){\r\n\t\t\t\t\tvar $row = $(this),\r\n\t\t\t\t\t\t$ci = $row.children('.clri');\r\n\r\n\t\t\t\t\tif (!HEX_COLOR_PATTERN.test($ci.val()))\r\n\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\tvar colorid = $row.data('id'),\r\n\t\t\t\t\t\tappend = { hex: $ci.val().replace(HEX_COLOR_PATTERN,'#$1').toUpperCase() };\r\n\t\t\t\t\tif (typeof colorid !== 'undefined') append.colorid = parseInt(colorid, 10);\r\n\r\n\t\t\t\t\tappend.label = $row.children('.clrl').val();\r\n\r\n\t\t\t\t\tdata.Colors.push(append);\r\n\t\t\t\t});\r\n\t\t\t\tif (data.Colors.length === 0)\r\n\t\t\t\t\treturn handleError.call({message:'You need to have at least 1 valid color'});\r\n\t\t\t\tdata.Colors = JSON.stringify(data.Colors);\r\n\r\n\t\t\t\tif ($major.is(':checked')){\r\n\t\t\t\t\tdata.major = true;\r\n\t\t\t\t\tdata.reason = $reason.val();\r\n\t\t\t\t}\r\n\r\n\t\t\t\t$ErrorNotice.text('Saving changes...').parent().removeClass('fail').addClass('info').show();\r\n\t\t\t\t$.Dialog.center();\r\n\r\n\t\t\t\t$.post('/colorguide/'+(editing?'set':'make')+'cg'+(editing?'/'+groupID:''), data, $.mkAjaxHandler(function(){\r\n\t\t\t\t\tif (this.status){\r\n\t\t\t\t\t\tif (this.cg || this.cgs){\r\n\t\t\t\t\t\t\tif (this.cg){\r\n\t\t\t\t\t\t\t\t$group.children('[data-hasqtip]').qtip('destroy', true);\r\n\t\t\t\t\t\t\t\t$group.html(this.cg);\r\n\r\n\t\t\t\t\t\t\t\tif (this.update)\r\n\t\t\t\t\t\t\t\t\t$group.parents('li').find('.update').html(this.update);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse if (this.cgs){\r\n\t\t\t\t\t\t\t\tvar $pony = $('#p'+ponyID);\r\n\t\t\t\t\t\t\t\tif (this.update)\r\n\t\t\t\t\t\t\t\t\t$pony.find('.update').html(this.update);\r\n\t\t\t\t\t\t\t\t$pony.find('ul.colors').html(this.cgs);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\twindow.tooltips();\r\n\t\t\t\t\t\t\tctxmenus();\r\n\t\t\t\t\t\t\tif (this.update)\r\n\t\t\t\t\t\t\t\twindow.updateTimes();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t$.Dialog.close();\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse handleError.call(this);\r\n\t\t\t\t}));\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tfunction ctxmenus(){\r\n\t\t$tags.children('span:not(.ctxmenu-bound)').ctxmenu([\r\n\t\t\t{text: 'Edit tag', icon: 'pencil', click: function(){\r\n\t\t\t\tvar $tag = $(this),\r\n\t\t\t\t\ttagName = $tag.text().trim(),\r\n\t\t\t\t\ttagID = $tag.attr('class').match(/id-(\\d+)(?:\\s|$)/)[1],\r\n\t\t\t\t\ttitle = 'Editing tag: '+tagName;\r\n\r\n\t\t\t\t$.Dialog.wait(title, 'Retrieveing tag details from server');\r\n\r\n\t\t\t\t$.post('/colorguide/gettag/'+tagID,$.mkAjaxHandler(function(){\r\n\t\t\t\t\tvar tag = this;\r\n\t\t\t\t\tif (this.status) $.Dialog.request(title,$tagEditForm.clone(true, true),'edit-tag','Save',function($form){\r\n\t\t\t\t\t\tvar $ErrorNotice = $form.children('.notice').children('p'),\r\n\t\t\t\t\t\t\thandleError = function(){\r\n\t\t\t\t\t\t\t\t$ErrorNotice.html(this.message).parent().removeClass('info').addClass('fail').show();\r\n\t\t\t\t\t\t\t\t$form.find('input, texarea').attr('disabled', false);\r\n\t\t\t\t\t\t\t\t$.Dialog.center();\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t$form.find('input[name=type][value='+tag.type+']').prop('checked', true);\r\n\t\t\t\t\t\t$form.find('input[type=text][name], textarea[name]').each(function(){\r\n\t\t\t\t\t\t\tvar $this = $(this);\r\n\t\t\t\t\t\t\t$this.val(tag[$this.attr('name')]);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t$form.on('submit', function(e){\r\n\t\t\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t\t\t$ErrorNotice.text('Saving changes...').parent().removeClass('fail').addClass('info').show();\r\n\t\t\t\t\t\t\t$.Dialog.center();\r\n\r\n\t\t\t\t\t\t\t$.post('/colorguide/settag/'+tagID, $form.mkData(), $.mkAjaxHandler(function(){\r\n\t\t\t\t\t\t\t\tif (this.status){\r\n\t\t\t\t\t\t\t\t\tvar $affected = $('.id-'+this.tid);\r\n\t\t\t\t\t\t\t\t\t$affected.qtip('destroy', true);\r\n\t\t\t\t\t\t\t\t\tif (this.title) $affected.attr('title', this.title);\r\n\t\t\t\t\t\t\t\t\telse $affected.removeAttr('title');\r\n\t\t\t\t\t\t\t\t\t$affected\r\n\t\t\t\t\t\t\t\t\t\t.attr('class', 'tag id-'+this.tid+(this.type?' typ-'+this.type:''))\r\n\t\t\t\t\t\t\t\t\t\t.text(this.name).data('ctxmenu-items').eq(0).text('Tag: '+this.name);\r\n\t\t\t\t\t\t\t\t\t$affected.parent().each(function(){\r\n\t\t\t\t\t\t\t\t\t\treorder($(this));\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\twindow.tooltips();\r\n\t\t\t\t\t\t\t\t\t$.Dialog.close();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse handleError.call(this);\r\n\t\t\t\t\t\t\t}));\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t\telse $.Dialog.fail(title, this.message);\r\n\t\t\t\t}));\r\n\t\t\t}},\r\n\t\t\t{text: 'Remove tag', icon: 'minus', click: function(){\r\n\t\t\t\tvar $tag = $(this),\r\n\t\t\t\t\ttagID = $tag.attr('class').match(/id-(\\d+)(?:\\s|$)/);\r\n\r\n\t\t\t\tif (!tagID) return false;\r\n\t\t\t\ttagID = tagID[1];\r\n\r\n\t\t\t\tvar ponyID = $tag.closest('li').attr('id').replace(/\\D/g, ''),\r\n\t\t\t\t\ttagName = $tag.text().trim(),\r\n\t\t\t\t\ttitle = 'Remove tag: '+tagName;\r\n\r\n\t\t\t\t$.Dialog.confirm(title,\"The tag \"+tagName+\" will be removed from this appearance.<br>Are you sure?\",['Remove it','Nope'],function(sure){\r\n\t\t\t\t\tif (!sure) return;\r\n\r\n\t\t\t\t\t$.Dialog.wait(title,'Removing tag');\r\n\r\n\t\t\t\t\t$.post('/colorguide/untag/'+ponyID,{ tag: tagID },$.mkAjaxHandler(function(){\r\n\t\t\t\t\t\tif (this.status){\r\n\t\t\t\t\t\t\t$tag.qtip('destroy', true);\r\n\t\t\t\t\t\t\t$tag.remove();\r\n\t\t\t\t\t\t\t$.Dialog.close();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse $.Dialog.fail(title, this.message);\r\n\t\t\t\t\t}));\r\n\t\t\t\t});\r\n\t\t\t}},\r\n\t\t\t{text: 'Delete tag', icon: 'trash', click: function(){\r\n\t\t\t\tvar $tag = $(this),\r\n\t\t\t\t\ttagName = $tag.text().trim(),\r\n\t\t\t\t\ttagID = $tag.attr('class').match(/id-(\\d+)(?:\\s|$)/)[1],\r\n\t\t\t\t\ttitle = 'Detele tag: '+tagName;\r\n\r\n\t\t\t\t$.Dialog.confirm(title,\"Deleting this tag will also remove it from every appearance where it's been used.<br>Are you sure?\",['Delete it','Nope'],function(sure){\r\n\t\t\t\t\tif (!sure) return;\r\n\r\n\t\t\t\t\t$.Dialog.wait(title,'Sending removal request');\r\n\r\n\t\t\t\t\t$.post('/colorguide/deltag/'+tagID,$.mkAjaxHandler(function(){\r\n\t\t\t\t\t\tif (this.status){\r\n\t\t\t\t\t\t\tvar $affected = $('.id-'+tagID);\r\n\t\t\t\t\t\t\t$affected.qtip('destroy', true);\r\n\t\t\t\t\t\t\t$affected.remove();\r\n\t\t\t\t\t\t\t$.Dialog.close();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse $.Dialog.fail(title, this.message);\r\n\t\t\t\t\t}));\r\n\t\t\t\t});\r\n\t\t\t}},\r\n\t\t\ttrue,\r\n\t\t\t{text: 'Create new tag', icon: 'plus', click: function(){\r\n\t\t\t\t$.ctxmenu.triggerItem($(this).parent(), 1);\r\n\t\t\t}},\r\n\t\t], function($el){ return 'Tag: '+$el.text().trim() });\r\n\r\n\t\tvar taglist = new Bloodhound({\r\n\t\t\tdatumTokenizer: Bloodhound.tokenizers.obj.whitespace('value'),\r\n\t\t\tqueryTokenizer: Bloodhound.tokenizers.whitespace,\r\n\t\t\tremote: {\r\n\t\t\t\turl: '/colorguide/gettags?s=%QUERY',\r\n\t\t\t\twildcard: '%QUERY'\r\n\t\t\t}\r\n\t\t}), insertKeys = [13, 188];\r\n\t\t$tags.children('.addtag').each(function(){\r\n\t\t\tvar $input = $(this),\r\n\t\t\t\tponyID = $input.parents('li').attr('id').substring(1);\r\n\t\t\t$input.typeahead(null, {\r\n\t\t\t\tname: 'tags',\r\n\t\t\t\tdisplay: 'name',\r\n\t\t\t\tsource: taglist,\r\n\t\t\t\ttemplates: {\r\n\t\t\t\t\tsuggestion: Handlebars.compile('<span class=\"tag id-{{tid}} {{type}}\">{{name}}</span>')\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t$input.on('keydown',function(e){\r\n\t\t\t\tif (insertKeys.indexOf(e.keyCode) !== -1){\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\tvar tag_name = $input.val().trim(),\r\n\t\t\t\t\t\t$tagsDiv = $input.parents('.tags'),\r\n\t\t\t\t\t\t$ponyTags = $tagsDiv.children('.tag'),\r\n\t\t\t\t\t\ttitle = 'Adding tag: '+tag_name;\r\n\r\n\t\t\t\t\tif ($ponyTags.filter(function(){ return this.innerHTML.trim() === tag_name }).length > 0)\r\n\t\t\t\t\t\treturn $.Dialog.fail(title, 'This appearance already has this tag');\r\n\r\n\t\t\t\t\t$.Dialog._focusedElement = $input.attr('disabled', true);\r\n\t\t\t\t\t$input.parent().addClass('loading');\r\n\r\n\t\t\t\t\t$.post('/colorguide/tag/'+ponyID,{ tag_name: tag_name }, $.mkAjaxHandler(function(){\r\n\t\t\t\t\t\t$input.removeAttr('disabled').parent().removeClass('loading');\r\n\t\t\t\t\t\tif (this.status){\r\n\t\t\t\t\t\t\t$tagsDiv.children('[data-hasqtip]').qtip('destroy', true);\r\n\t\t\t\t\t\t\t$tagsDiv.children('.tag').remove();\r\n\t\t\t\t\t\t\t$tagsDiv.append($(this.tags).filter('span'));\r\n\t\t\t\t\t\t\twindow.tooltips();\r\n\t\t\t\t\t\t\tctxmenus();\r\n\t\t\t\t\t\t\t$input.typeahead('val', '').focus();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse if (typeof this.cancreate === 'string'){\r\n\t\t\t\t\t\t\tvar new_name = this.cancreate;\r\n\t\t\t\t\t\t\ttitle = title.replace(tag_name, new_name);\r\n\t\t\t\t\t\t\treturn $.Dialog.confirm(title, this.message, function(sure){\r\n\t\t\t\t\t\t\t\tif (!sure) return;\r\n\t\t\t\t\t\t\t\tcreateNewTag($input, new_name);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse $.Dialog.fail(title, this.message);\r\n\t\t\t\t\t}));\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t$input.nextAll('.tt-menu').on('click', '.tag', function(){\r\n\t\t\t\t$input.trigger({\r\n\t\t\t\t\ttype: 'keydown',\r\n\t\t\t\t\tkeyCode: 13,\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\t$colorGroups = $('ul.colors:not(.static)').attr('data-color', color);\r\n\t\t$colorGroups.filter(':not(.ctxmenu-bound)').ctxmenu(\r\n\t\t\t[\r\n\t\t\t\t{text: \"Re-order \"+color+\" groups\", icon: 'arrow-unsorted', click: function(){\r\n\t\t\t\t\tvar $colors = $(this),\r\n\t\t\t\t\t\t$li = $colors.parents('li'),\r\n\t\t\t\t\t\tponyID = $li.attr('id').substring(1),\r\n\t\t\t\t\t\tponyName = $li.children().last().children('strong').text().trim(),\r\n\t\t\t\t\t\ttitle = 'Re-order '+color+' groups on appearance: '+ponyName;\r\n\r\n\t\t\t\t\t$.Dialog.wait(title, 'Retrieving color group list from server');\r\n\r\n\t\t\t\t\t$.post('/colorguide/getcgs/'+ponyID, $.mkAjaxHandler(function(){\r\n\t\t\t\t\t\tif (!this.status) $.Dialog.fail(this.message);\r\n\r\n\t\t\t\t\t\tvar $form = $cgReordering.clone(),\r\n\t\t\t\t\t\t\t$cgs = $.mk('ol');\r\n\r\n\t\t\t\t\t\t$.each(this.cgs,function(_, cg){\r\n\t\t\t\t\t\t\t$cgs.append($.mk('li').attr('data-id', cg.groupid).text(cg.label));\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t$.mk('div').attr('class','cgs').append('<p class=\"align-center\">Drag to re-arrange</p>',$cgs).prependTo($form);\r\n\t\t\t\t\t\t$.Dialog.center();\r\n\r\n\t\t\t\t\t\tnew Sortable($cgs.get(0), {\r\n\t\t\t\t\t\t    ghostClass: \"moving\",\r\n\t\t\t\t\t\t    scroll: false,\r\n\t\t\t\t\t\t    animation: 150,\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t$.Dialog.request(title, $form, 'cg-reorder', 'Save', function($form){\r\n\t\t\t\t\t\t\tvar $ErrorNotice = $form.children('.notice').children('p'),\r\n\t\t\t\t\t\t\t\thandleError = function(){\r\n\t\t\t\t\t\t\t\t\t$ErrorNotice.html(this.message).parent().removeClass('info').addClass('fail').show();\r\n\t\t\t\t\t\t\t\t\t$.Dialog.center();\r\n\t\t\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\t\t$form.on('submit', function(e){\r\n\t\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\t\tvar data = {cgs:[]},\r\n\t\t\t\t\t\t\t\t\t$cgs = $form.children('.cgs');\r\n\r\n\t\t\t\t\t\t\t\tif (!$cgs.length)\r\n\t\t\t\t\t\t\t\t\treturn handleError.call({message:'There are no color groups to re-order'});\r\n\t\t\t\t\t\t\t\t$cgs.find('ol').children().each(function(){\r\n\t\t\t\t\t\t\t\t\tdata.cgs.push($(this).attr('data-id'));\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\tdata.cgs = data.cgs.join(',');\r\n\r\n\t\t\t\t\t\t\t\t$ErrorNotice.text('Saving changes...').parent().removeClass('fail').addClass('info').show();\r\n\t\t\t\t\t\t\t\t$.Dialog.center();\r\n\r\n\t\t\t\t\t\t\t\t$.post('/colorguide/setcgs/'+ponyID,data,$.mkAjaxHandler(function(){\r\n\t\t\t\t\t\t\t\t\tif (this.status){\r\n\t\t\t\t\t\t\t\t\t\t$colors.html(this.cgs);\r\n\t\t\t\t\t\t\t\t\t\twindow.tooltips();\r\n\t\t\t\t\t\t\t\t\t\tctxmenus();\r\n\t\t\t\t\t\t\t\t\t\t$.Dialog.close();\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\telse handleError.call(this);\r\n\t\t\t\t\t\t\t\t}));\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}));\r\n\t\t\t\t}},\r\n\t\t\t\t{text: \"Create new group\", icon: 'folder-add', click: function(){\r\n\t\t\t\t\tCGEditorMaker('Create color group', $(this).parents('li').attr('id').substring(1));\r\n\t\t\t\t}},\r\n\t\t\t],\r\n\t\t\tColor+' groups'\r\n\t\t);\r\n\t\t$colorGroups.children('li').filter(':not(.ctxmenu-bound)').ctxmenu(\r\n\t\t\t[\r\n\t\t\t\t{text: \"Edit \"+color+\" group\", icon: 'pencil', click: function(){\r\n\t\t\t\t\tvar $this = $(this),\r\n\t\t\t\t\t\t$group = $this.closest('li'),\r\n\t\t\t\t\t\tgroupID = $group.attr('id').substring(2),\r\n\t\t\t\t\t\tgroupName = $this.children().first().text().replace(/:\\s?$/,''),\r\n\t\t\t\t\t\ttitle = 'Editing '+color+' group: '+groupName;\r\n\r\n\t\t\t\t\t$.Dialog.wait(title, 'Retrieving '+color+' group details from server');\r\n\r\n\t\t\t\t\t$.post('/colorguide/getcg/'+groupID,$.mkAjaxHandler(function(){\r\n\t\t\t\t\t\tif (this.status) CGEditorMaker.call(this, title, $group);\r\n\t\t\t\t\t\telse $.Dialog.fail(title, data.message);\r\n\t\t\t\t\t}));\r\n\t\t\t\t}},\r\n\t\t\t\t{text: \"Delete \"+color+\" group\", icon: 'trash', click: function(){\r\n\t\t\t\t\tvar $group = $(this).closest('li'),\r\n\t\t\t\t\t\tgroupID = $group.attr('id').substring(2),\r\n\t\t\t\t\t\tgroupName = $group.children().first().text().replace(/:\\s?$/,''),\r\n\t\t\t\t\t\ttitle = 'Delete '+color+' group: '+groupName;\r\n\t\t\t\t\t$.Dialog.confirm(title, 'By deleting this '+color+' group, all '+color+'s within will be removed too.<br>Are you sure?',function(sure){\r\n\t\t\t\t\t\tif (!sure) return;\r\n\r\n\t\t\t\t\t\t$.Dialog.wait(title, 'Sending removal request');\r\n\r\n\t\t\t\t\t\t$.post('/colorguide/delcg/'+groupID,$.mkAjaxHandler(function(){\r\n\t\t\t\t\t\t\tif (this.status){\r\n\t\t\t\t\t\t\t\t$group.children('[data-hasqtip]').qtip('destroy', true);\r\n\t\t\t\t\t\t\t\t$group.remove();\r\n\t\t\t\t\t\t\t\t$.Dialog.close();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse $.Dialog.fail(title, this.message);\r\n\t\t\t\t\t\t}));\r\n\t\t\t\t\t});\r\n\t\t\t\t}},\r\n\t\t\t\ttrue,\r\n\t\t\t\t{text: \"Re-order \"+color+\" groups\", icon: 'arrow-unsorted', click: function(){\r\n\t\t\t\t\t$.ctxmenu.triggerItem($(this).parent(), 1);\r\n\t\t\t\t}},\r\n\t\t\t\t{text: \"Create new group\", icon: 'folder-add', click: function(){\r\n\t\t\t\t\t$.ctxmenu.triggerItem($(this).parent(), 2);\r\n\t\t\t\t}},\r\n\t\t\t],\r\n\t\t\tfunction($el){ return Color+' group: '+$el.children().first().text().trim().replace(':','') }\r\n\t\t);\r\n\t\t$.ctxmenu.addItems(\r\n\t\t\t$colorGroups.children('li').children('span:not(:first-child)'),\r\n\t\t\ttrue,\r\n\t\t\t{text: \"Edit \"+color+\" group\", icon: 'pencil', click: function(){\r\n\t\t\t\t$.ctxmenu.triggerItem($(this).parent(), 1);\r\n\t\t\t}},\r\n\t\t\t{text: \"Delete \"+color+\" group\", icon: 'trash', click: function(){\r\n\t\t\t\t$.ctxmenu.triggerItem($(this).parent(), 2);\r\n\t\t\t}},\r\n\t\t\ttrue,\r\n\t\t\t{text: \"Re-order \"+color+\" groups\", icon: 'arrow-unsorted', click: function(){\r\n\t\t\t\t$.ctxmenu.triggerItem($(this).parent(), 3);\r\n\t\t\t}},\r\n\t\t\t{text: \"Create new group\", icon: 'folder-add', click: function(){\r\n\t\t\t\t$.ctxmenu.triggerItem($(this).parent(), 4);\r\n\t\t\t}}\r\n\t\t);\r\n\r\n\t\t$('.upload-wrap').each(function(){\r\n\t\t\tvar $this = $(this),\r\n\t\t\t\tponyID = $this.closest('li').attr('id').substring(1);\r\n\r\n\t\t\t$this.uploadZone({\r\n\t\t\t\trequestKey: 'sprite',\r\n\t\t\t\ttitle: 'Upload sprite',\r\n\t\t\t\taccept: 'image/png',\r\n\t\t\t\ttarget: '/colorguide/setsprite/'+ponyID,\r\n\t\t\t}).on('uz-uploadstart',function(){\r\n\t\t\t\t$.Dialog.close();\r\n\t\t\t}).ctxmenu([\r\n\t\t\t\t{text: 'Open image in new tab', icon: 'arrow-forward', 'default': true, attr: {\r\n\t\t\t\t\thref: $this.find('img').attr('src'),\r\n\t\t\t\t\ttarget: '_blank',\r\n\t\t\t\t}},\r\n\t\t\t\t{text: 'Copy image URL', icon: 'clipboard', click: function(){\r\n\t\t\t\t\t$.copy($.urlToAbsolute($this.find('img').attr('src')));\r\n\t\t\t\t}},\r\n\t\t\t\t{text: 'Upload new sprite', icon: 'upload', click: function(){\r\n\t\t\t\t\tvar title = 'Upload sprite image',\r\n\t\t\t\t\t\tponyID = $this.closest('li').attr('id').substring(1),\r\n\t\t\t\t\t\t$uploadInput = $this.find('input[type=\"file\"]');\r\n\t\t\t\t\t$.Dialog.request(title,$spriteUploadForm.clone(),'sprite-img','Download image',function($form){\r\n\t\t\t\t\t\tvar $image_url = $form.find('input[name=image_url]');\r\n\t\t\t\t\t\t$form.find('a').on('click',function(e){\r\n\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\te.stopPropagation();\r\n\r\n\t\t\t\t\t\t\t$uploadInput.trigger('click', [true]);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t$form.on('submit',function(e){\r\n\t\t\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t\t\tvar image_url = $image_url.val();\r\n\r\n\t\t\t\t\t\t\t$.Dialog.wait(title, 'Downloading external image to the server');\r\n\r\n\t\t\t\t\t\t\t$.post('/colorguide/setsprite/'+ponyID,{image_url: image_url}, $.mkAjaxHandler(function(){\r\n\t\t\t\t\t\t\t\tif (this.status) $uploadInput.trigger('set-image', [this.path]);\r\n\t\t\t\t\t\t\t\telse $.Dialog.fail(title,this.message);\r\n\t\t\t\t\t\t\t}));\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t}},\r\n\t\t\t], 'Sprite image').attr('title', isWebkit ? ' ' : '').on('click',function(e, forced){\r\n\t\t\t\tif (forced === true) return true;\r\n\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\t$this.data('ctxmenu-items').eq(1).children().get(0).click();\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\twindow.ctxmenus = function(){ctxmenus()};\r\n\r\n\tvar $tags;\r\n\t$list.on('page-switch',function(){\r\n\t\t$list.find('button.edit').on('click',function(){\r\n\t\t\tvar $this = $(this),\r\n\t\t\t\tponyID = $this.parents('li').attr('id').substring(1),\r\n\t\t\t\tponyName = $this.parent().text().trim(),\r\n\t\t\t\ttitle = 'Editing appearance: '+ponyName;\r\n\r\n\t\t\t$.Dialog.wait(title, 'Retrieving appearance details from server');\r\n\r\n\t\t\t$.post('/colorguide/get/'+ponyID,$.mkAjaxHandler(function(){\r\n\t\t\t\tvar data = this;\r\n\t\t\t\tif (data.status){\r\n\t\t\t\t\tdata.ponyID = ponyID;\r\n\t\t\t\t\tmkPonyEditor($this, title, data);\r\n\t\t\t\t}\r\n\t\t\t\telse $.Dialog.fail(title, this.message);\r\n\t\t\t}));\r\n\t\t}).next().on('click',function(){\r\n\t\t\tvar $this = $(this),\r\n\t\t\t\t$li = $this.closest('li'),\r\n\t\t\t\tponyID = $li.attr('id').substring(1),\r\n\t\t\t\tponyName = $this.parent().text().trim(),\r\n\t\t\t\ttitle = 'Deleting appearance: '+ponyName;\r\n\r\n\t\t\t$.Dialog.confirm(title,'Deleting this appearance will remove <strong>ALL</strong> of its color groups, the colors within them, and the sprite file, if any.<br>Delete anyway?',function(sure){\r\n\t\t\t\tif (!sure) return;\r\n\r\n\t\t\t\t$.Dialog.wait(title, 'Sending removal request');\r\n\r\n\t\t\t\t$.post('/colorguide/delete/'+ponyID,$.mkAjaxHandler(function(){\r\n\t\t\t\t\tif (this.status){\r\n\t\t\t\t\t\t$li.remove();\r\n\t\t\t\t\t\t$.Dialog.success(title, this.message);\r\n\r\n\t\t\t\t\t\tvar path = window.location.pathname;\r\n\t\t\t\t\t\tif ($list.children().length === 0)\r\n\t\t\t\t\t\t\tpath = path.replace(/(\\d+)$/,function(n){ return n > 1 ? n-1 : n });\r\n\t\t\t\t\t\t$.toPage(path,true,true);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse $.Dialog.fail(title, this.message);\r\n\t\t\t\t}));\r\n\t\t\t})\r\n\t\t});\r\n\r\n\t\t$tags = $('.tags').ctxmenu(\r\n\t\t\t[\r\n\t\t\t\t{text: 'Create new tag', icon: 'plus', click: function(){\r\n\t\t\t\t\tcreateNewTag($(this));\r\n\t\t\t\t}},\r\n\t\t\t],\r\n\t\t\t'Tags'\r\n\t\t);\r\n\r\n\t\tctxmenus();\r\n\t}).trigger('page-switch');\r\n});\r\n"],"sourceRoot":"/source/"}