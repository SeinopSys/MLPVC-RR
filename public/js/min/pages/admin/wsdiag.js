"use strict";!function(){var e=!1,r=[],t=$("#send-hello"),s=$("#wss-status"),l=$("#wss-heartbeat"),c=$("#wss-response-time"),d=$("#connection-list");!function n(){l.removeClass("beat");var i=(new Date).getTime();if($.WS.down||$.WS.conn.disconnected){if(!1!==e)return;return e=setInterval(n,1e3),s.removeClass("info success").addClass("fail").text($.WS.down?"Socket.IO server is down and/or client library failed to load":"Disconnected"),l.addClass("dead"),void t.disable()}if(!1!==e&&(clearInterval(e),e=!1,s.removeClass("info fail").addClass("success"),l.removeClass("dead"),t.enable()),d.is(":hover"))return setTimeout(n,500),void s.text("Paused while hovering entries");s.text("Connected"),$.WS.devquery("status",{},function(s){l.addClass("beat");var e=d.children(),a=[],o={};Object.keys(s.clients).forEach(function(e){var t=s.clients[e],n="ip-"+t.ip.replace(/[^a-f\d]/g,"-");a.push(n),o[n]||(o[n]=[]),o[n].push(t)}),0===a.length?d.empty():(e.filter(function(e,t){return!o[t.id]}).remove(),a.forEach(function(e){var t=o[e],n={},s={};t.forEach(function(e){e.page&&(n[e.page]={since:e.connectedSince}),e.username&&(s[e.username]=!0)}),s=Object.keys(s);var a=$(document.getElementById(e));0===a.length&&(a=$.mk("li",e),d.append(a)),a.empty().append("<h3>"+t[0].ip+"</h3>"),s.length&&a.append("<p><strong>Users:</strong></p>",$.mk("ul").append(s.map(function(e){return $.mk("li").html('<a href="/@'+e+'" target="_blank">'+e+"</a>")})));var i=Object.keys(n);i.length&&a.append("<p><strong>Pages:</strong></p>",$.mk("ul").append(i.map(function(e){return $.mk("li").append($.mk("a").attr({href:e,target:"_blank"}).text(e)," ("+n[e].since+")")})))}));var t=(new Date).getTime();r.push(t-i),r=r.slice(-20),c.text($.average(r).toFixed(2)+"ms"),setTimeout(n,1e3)})}(),t.on("click",function(){$.Dialog.wait("Test PHP to WS server connectivity","Sending hello");var n=$.randomString(),e=$.WS.getClientId(),s=!1;$w.on("ws-hello",function(e,t){t.priv===n&&($w.off("ws-hello"),s=!0,$.Dialog.success(!1,"Hello response received",!0))}),$.API.get("/admin/wsdiag/hello",{priv:n,clientid:e},$.mkAjaxHandler(function(){if(!this.status)return $.Dialog.fail(!1,this.message);s||$.Dialog.success(!1,"Hello sent successfully"),s||$.Dialog.wait(!1,"Waiting for reply (timeout 5s)"),setTimeout(function(){s||($w.off("ws-hello"),$.Dialog.fail(!1,"Hello response timed out"))},5e3)}))})}();
//# sourceMappingURL=/js/min/pages/admin/wsdiag.js.map
